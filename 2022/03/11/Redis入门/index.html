<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.4.0">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">

<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Monda:300,300italic,400,400italic,700,700italic%7CRoboto+Slab:300,300italic,400,400italic,700,700italic%7CPT+Mono:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext">

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.4/css/all.min.css" integrity="sha256-mUZM63G8m73Mcidfrv5E+Y61y7a12O5mW4ezU3bxqW4=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"zerostione.github.io","root":"/","images":"/images","scheme":"Pisces","darkmode":false,"version":"8.7.1","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":true,"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"}}</script><script src="/js/config.js"></script>
<meta name="description" content="Redis是一个使用ANSI C编写的开源、支持网络、基于内存、分布式、可选持久性的键值对存储数据库。从2015年6月开始，Redis(Remote Dictionary Server,远程字典服务)的开发由Redis Labs赞助。">
<meta property="og:type" content="article">
<meta property="og:title" content="Redis入门">
<meta property="og:url" content="https://zerostione.github.io/2022/03/11/Redis%E5%85%A5%E9%97%A8/index.html">
<meta property="og:site_name" content="Zero">
<meta property="og:description" content="Redis是一个使用ANSI C编写的开源、支持网络、基于内存、分布式、可选持久性的键值对存储数据库。从2015年6月开始，Redis(Remote Dictionary Server,远程字典服务)的开发由Redis Labs赞助。">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://zerostione.github.io/ImageUp//Image/Blog/Redis/p2.png">
<meta property="og:image" content="https://zerostione.github.io/ImageUp//Image/Blog/Redis/p8.png">
<meta property="og:image" content="https://zerostione.github.io/ImageUp//Image/Blog/Redis/p6.png">
<meta property="og:image" content="https://zerostione.github.io/ImageUp//Image/Blog/Redis/p5.png">
<meta property="og:image" content="https://zerostione.github.io/ImageUp//Image/Blog/Redis/p4.png">
<meta property="og:image" content="https://zerostione.github.io/ImageUp//Image/Blog/Redis/p9.png">
<meta property="og:image" content="https://zerostione.github.io/ImageUp//Image/Blog/Redis/p3.png">
<meta property="og:image" content="https://zerostione.github.io/ImageUp//Image/Blog/Redis/p1.png">
<meta property="og:image" content="https://zerostione.github.io/ImageUp//Image/Blog/Redis/p11.png">
<meta property="og:image" content="https://zerostione.github.io/ImageUp//Image/Blog/Redis/p12.png">
<meta property="og:image" content="https://zerostione.github.io/ImageUp//Image/Blog/Redis/p13.png">
<meta property="og:image" content="https://zerostione.github.io/ImageUp//Image/Blog/Redis/p14.png">
<meta property="og:image" content="https://zerostione.github.io/ImageUp//Image/Blog/Redis/p15.png">
<meta property="og:image" content="https://zerostione.github.io/ImageUp//Image/Blog/Redis/p16.png">
<meta property="og:image" content="https://zerostione.github.io/ImageUp//Image/Blog/Redis/p17.png">
<meta property="og:image" content="https://zerostione.github.io/ImageUp//Image/Blog/Redis/p18.png">
<meta property="og:image" content="https://zerostione.github.io/ImageUp//Image/Blog/Redis/p19.png">
<meta property="og:image" content="https://zerostione.github.io/ImageUp//Image/Blog/Redis/p20.png">
<meta property="og:image" content="https://zerostione.github.io/ImageUp//Image/Blog/Redis/p21.png">
<meta property="og:image" content="https://zerostione.github.io/ImageUp//Image/Blog/Redis/p22.png">
<meta property="og:image" content="https://zerostione.github.io/ImageUp//Image/Blog/Redis/p23.png">
<meta property="og:image" content="https://zerostione.github.io/ImageUp//Image/Blog/Redis/p26.png">
<meta property="og:image" content="https://zerostione.github.io/ImageUp//Image/Blog/Redis/p27.png">
<meta property="og:image" content="https://zerostione.github.io/ImageUp//Image/Blog/Redis/p3.jpg">
<meta property="og:image" content="https://zerostione.github.io/ImageUp//Image/Blog/Redis/p28.png">
<meta property="og:image" content="https://zerostione.github.io/ImageUp//Image/Blog/Redis/p31.png">
<meta property="og:image" content="https://zerostione.github.io/ImageUp//Image/Blog/Redis/p32.png">
<meta property="og:image" content="https://zerostione.github.io/ImageUp//Image/Blog/Redis/p4.jpg">
<meta property="og:image" content="https://zerostione.github.io/ImageUp//Image/Blog/Redis/p34.png">
<meta property="og:image" content="https://zerostione.github.io/ImageUp//Image/Blog/Redis/p6.jpg">
<meta property="article:published_time" content="2022-03-11T05:34:40.000Z">
<meta property="article:modified_time" content="2022-05-02T04:58:56.203Z">
<meta property="article:author" content="Zero">
<meta property="article:tag" content="Redis">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://zerostione.github.io/ImageUp//Image/Blog/Redis/p2.png">


<link rel="canonical" href="https://zerostione.github.io/2022/03/11/Redis%E5%85%A5%E9%97%A8/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"https://zerostione.github.io/2022/03/11/Redis%E5%85%A5%E9%97%A8/","path":"2022/03/11/Redis入门/","title":"Redis入门"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>Redis入门 | Zero</title>
  




  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">Zero</h1>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">发现未知，探索未知</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu">
        <li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li>
        <li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a></li>
        <li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a></li>
        <li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a></li>
        <li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a></li>
        <li class="menu-item menu-item-schedule"><a href="/schedule/" rel="section"><i class="fa fa-calendar fa-fw"></i>日程表</a></li>
  </ul>
</nav>




</div>
        
  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#NoSQL"><span class="nav-number">1.</span> <span class="nav-text">NoSQL</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%88%86%E7%B1%BB"><span class="nav-number">1.1.</span> <span class="nav-text">分类</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Redis"><span class="nav-number">2.</span> <span class="nav-text">Redis</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%A6%82%E8%BF%B0"><span class="nav-number">2.1.</span> <span class="nav-text">概述</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%89%E8%A3%85"><span class="nav-number">2.2.</span> <span class="nav-text">安装</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%80%A7%E8%83%BD%E6%B5%8B%E8%AF%95"><span class="nav-number">2.3.</span> <span class="nav-text">性能测试</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%91%BD%E4%BB%A4"><span class="nav-number">2.4.</span> <span class="nav-text">命令</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B"><span class="nav-number">2.5.</span> <span class="nav-text">数据类型</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#String"><span class="nav-number">2.5.1.</span> <span class="nav-text">String</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#List"><span class="nav-number">2.5.2.</span> <span class="nav-text">List</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Set"><span class="nav-number">2.5.3.</span> <span class="nav-text">Set</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Hash"><span class="nav-number">2.5.4.</span> <span class="nav-text">Hash</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Zset"><span class="nav-number">2.5.5.</span> <span class="nav-text">Zset</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BA%8B%E5%8A%A1"><span class="nav-number">2.6.</span> <span class="nav-text">事务</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%B9%90%E8%A7%82%E9%94%81"><span class="nav-number">2.6.1.</span> <span class="nav-text">乐观锁</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Jedis"><span class="nav-number">2.7.</span> <span class="nav-text">Jedis</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Lettuce"><span class="nav-number">2.8.</span> <span class="nav-text">Lettuce</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Conf"><span class="nav-number">2.9.</span> <span class="nav-text">Conf</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%8C%81%E4%B9%85%E5%8C%96"><span class="nav-number">2.10.</span> <span class="nav-text">持久化</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#RDB"><span class="nav-number">2.10.1.</span> <span class="nav-text">RDB</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#AOF"><span class="nav-number">2.10.2.</span> <span class="nav-text">AOF</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%AE%A2%E9%98%85"><span class="nav-number">2.11.</span> <span class="nav-text">订阅</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6"><span class="nav-number">2.12.</span> <span class="nav-text">主从复制</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%93%A8%E5%85%B5%E6%A8%A1%E5%BC%8F"><span class="nav-number">2.13.</span> <span class="nav-text">哨兵模式</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Redis%E7%BC%93%E5%AD%98"><span class="nav-number">2.14.</span> <span class="nav-text">Redis缓存</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%BC%93%E5%AD%98%E9%9B%AA%E5%B4%A9"><span class="nav-number">2.14.1.</span> <span class="nav-text">缓存雪崩</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%BC%93%E5%AD%98%E5%87%BB%E7%A9%BF"><span class="nav-number">2.14.2.</span> <span class="nav-text">缓存击穿</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%BC%93%E5%AD%98%E7%A9%BF%E9%80%8F"><span class="nav-number">2.14.3.</span> <span class="nav-text">缓存穿透</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%BC%93%E5%AD%98%E9%A2%84%E7%83%AD"><span class="nav-number">2.14.4.</span> <span class="nav-text">缓存预热</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%BC%93%E5%AD%98%E9%99%8D%E7%BA%A7"><span class="nav-number">2.14.5.</span> <span class="nav-text">缓存降级</span></a></li></ol></li></ol></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Zero"
      src="https://zerostione.github.io/ImageUp//Image/Blog/Use/ue.jpg">
  <p class="site-author-name" itemprop="name">Zero</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">29</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">4</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">21</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>



        </div>
      </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    
  <div class="back-to-top" role="button" aria-label="返回顶部">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://zerostione.github.io/2022/03/11/Redis%E5%85%A5%E9%97%A8/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://zerostione.github.io/ImageUp//Image/Blog/Use/ue.jpg">
      <meta itemprop="name" content="Zero">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Zero">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          Redis入门
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2022-03-11 13:34:40" itemprop="dateCreated datePublished" datetime="2022-03-11T13:34:40+08:00">2022-03-11</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2022-05-02 12:58:56" itemprop="dateModified" datetime="2022-05-02T12:58:56+08:00">2022-05-02</time>
      </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
        <p><strong>Redis</strong>是一个使用ANSI C编写的开源、支持网络、基于内存、分布式、可选持久性的键值对存储数据库。从2015年6月开始，Redis(Remote Dictionary Server,远程字典服务)的开发由Redis Labs赞助。</p>
<img src="https://zerostione.github.io/ImageUp//Image/Blog/Redis/p2.png" style="zoom: 80%;" />

<span id="more"></span>



<h2 id="NoSQL"><a href="#NoSQL" class="headerlink" title="NoSQL"></a>NoSQL</h2><img src="https://zerostione.github.io/ImageUp//Image/Blog/Redis/p8.png" style="zoom:80%;" />

<p>NoSQL（Non-SQL,Not only SQL），是对不同于传统的关系数据库的数据库管理系统的统称。</p>
<p>允许部分资料使用SQL系统存储，而其他资料允许使用NOSQL系统存储。其数据存储可以不需要固定的表格模式以及元数据（metadata），也经常会避免使用SQL的JOIN操作，一般有水平可扩展性的特征。</p>
<p>NOSQL一词最早出现于1998年，是Carlo Strozzi开发的一个轻量、开源、不提供SQL功能的关系数据库。</p>
<p>2009年在亚特兰大举行的<code>no:sql(east)</code>讨论会是一个里程碑，其口号是<code>select fun, profit from real_world where relational=false;</code>。因此对NOSQL普遍解释是<code>非关联型的，强调键-值存储和面向文档数据库的优点，而不是单纯的反对RDBMS</code>。</p>
<img src="https://zerostione.github.io/ImageUp//Image/Blog/Redis/p6.png" style="zoom: 80%;" />

<blockquote>
<p>常见的NoSQL数据库是MongoDB，Apache Cassandra和Redis。</p>
</blockquote>
<hr>
<img src="https://zerostione.github.io/ImageUp//Image/Blog/Redis/p5.png" style="zoom: 67%;" />

<blockquote>
<p>关系型数据库的典型实现主要被调整用于执行规模小而读写频繁，或者大批量读而极少写访问的事务，而非数据敏感的应用，如为巨量文档创建索引、高流量网站的网页服务，以及发送流式媒体。</p>
<p>NOSQL的结构通常提供弱一致性的保证，如最终一致性，或交易仅限于单个的数据项。不过，有些系统，提供完整的ACID保证在某些情况下，增加了补充中间件层（如CloudTPS）。有两个成熟的系统有提供快照隔离的列存储：像是Google基于过滤器系统的BigTable，和滑铁卢大学开发的HBase。这些系统，自主开发，使用类似的概念来实现多行（multi-row）分布式ACID交易的快照隔离（snapshot isolation）保证为基础列存储，无需额外的资料管理开销，中间件系统部署或维护，减少了中间件层。</p>
<p>少数NOSQL系统部署了分布式结构，通常使用分布式散列表（DHT）将数据以冗余方式保存在多台服务器上。依此，扩充系统时候添加服务器更容易，并且扩大了对服务器失效的承受能程度。</p>
</blockquote>
<hr>
<h3 id="分类"><a href="#分类" class="headerlink" title="分类"></a>分类</h3><img src="https://zerostione.github.io/ImageUp//Image/Blog/Redis/p4.png" style="zoom: 67%;" />

<ul>
<li><p>文档存储</p>
<ul>
<li>BaseX</li>
<li>CouchDB</li>
<li>ElasticSearch</li>
<li>eXist</li>
<li>iBoxDB</li>
<li>Jackrabbit</li>
<li>Lotus Notes</li>
<li>MarkLogic Server</li>
<li>MongoDB</li>
<li>No2DB</li>
<li>OrientDB</li>
<li>RethinkDB</li>
<li>SimpleDB</li>
<li>Terrastore</li>
</ul>
</li>
<li><p>图数据库</p>
<ul>
<li>AllegroGraph</li>
<li>Sparksee</li>
<li>Neo4j</li>
<li>FlockDB</li>
<li>JanusGraph</li>
</ul>
</li>
<li><p>键-值（key‐value）储存</p>
<ul>
<li><p>最终一致性的键-值储存</p>
<ul>
<li>Cassandra</li>
<li>Dynamo</li>
<li>Hibari</li>
<li>Project Voldemort</li>
<li>Riak</li>
</ul>
</li>
<li><p>架构性键-值储存</p>
<ul>
<li>GT.M</li>
<li>InterSystem Globals</li>
</ul>
</li>
</ul>
</li>
<li><p>主机式服务</p>
<ul>
<li>Key/value硬盘存储<ul>
<li>BigTable</li>
<li>MemcacheDB</li>
<li>LevelDB</li>
<li>Tokyo Cabinet</li>
<li>Tuple space</li>
<li>TreapDB</li>
</ul>
</li>
<li>Key/value RAM存储<ul>
<li>Oracle Coherence</li>
<li>memcached</li>
<li>Citrusleaf database</li>
<li>Velocity (memory cache)</li>
<li>Redis</li>
<li>Tuple space</li>
</ul>
</li>
<li>Key-value基于Paxos算法的存储<ul>
<li>Keyspace (data store)</li>
</ul>
</li>
</ul>
</li>
<li><p>多数据库</p>
<ul>
<li>OpenQM</li>
<li>Rocket U2</li>
<li>Revelation Software’s OpenInsight</li>
<li>Extensible Storage Engine（ESE/NT）</li>
</ul>
</li>
<li><p>时序型数据库</p>
<ul>
<li>Graphite</li>
<li>InfluxDB</li>
<li>Informix TimeSeries</li>
<li>OpenTSDB</li>
<li>RRDtool</li>
<li>IoTDB</li>
</ul>
</li>
<li><p>对象数据库</p>
<ul>
<li>Versant Object Database</li>
<li>db4o</li>
<li>GemStone/S</li>
<li>InterSystems Caché</li>
<li>Objectivity/DB</li>
<li>ZODB</li>
<li>ObjectStore</li>
</ul>
</li>
<li><p>列存储</p>
<ul>
<li>Cassandra</li>
<li>HBase</li>
<li>Hypertable</li>
</ul>
</li>
</ul>
<img src="https://zerostione.github.io/ImageUp//Image/Blog/Redis/p9.png" style="zoom: 80%;" />

<hr>
<h2 id="Redis"><a href="#Redis" class="headerlink" title="Redis"></a>Redis</h2><img src="https://zerostione.github.io/ImageUp//Image/Blog/Redis/p3.png" style="zoom: 67%;" />

<p><a target="_blank" rel="noopener" href="http://redis.cn/">Redis</a></p>
<p><a target="_blank" rel="noopener" href="https://www.runoob.com/redis/redis-tutorial.html">Redis教程</a></p>
<h3 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h3><blockquote>
<ul>
<li><p>数据模型</p>
<p>Redis的外围由一个键、值映射的字典构成。与其他非关系型数据库主要不同在于：Redis中值的类型不仅限于字符串，还支持如下抽象数据类型：</p>
<ul>
<li>字符串列表</li>
<li>无序不重复的字符串集合</li>
<li>有序不重复的字符串集合</li>
<li>键、值都为字符串的哈希表</li>
</ul>
<p> 值的类型决定了值本身支持的操作。Redis支持不同无序、有序的列表，无序、有序的集合间的交集、并集等高级服务器端原子操作。</p>
</li>
<li><p>持久化<br>Redis通常将全部的数据存储在内存中。</p>
<p>目前通过两种方式实现持久化：</p>
<ul>
<li>使用快照，一种半持久耐用模式。不时的将数据集以异步方式从内存以RDB格式写入硬盘。</li>
<li>AOF格式(1.1版本开始,更安全)替代，一种只能追加的日志类型。将数据集修改操作记录起来。Redis能够在后台对只可追加的记录进行修改，从而避免日志的无限增长。</li>
</ul>
</li>
<li><p>同步<br>Redis支持主从同步。数据可以从主服务器向任意数量的从服务器上同步，从服务器可以是关联其他从服务器的主服务器。这使得Redis可执行单层树复制。从盘可以有意无意的对数据进行写操作。由于完全实现了发布/订阅机制，使得从数据库在任何地方同步树时，可订阅一个频道并接收主服务器完整的消息发布记录。同步对读取操作的可扩展性和数据冗余很有帮助。</p>
</li>
<li><p>性能<br>当数据依赖不再需要，Redis这种基于内存的性质，与在执行一个事务时将每个变化都写入硬盘的数据库系统相比就显得执行效率非常高。写与读操作速度没有明显差别。</p>
</li>
</ul>
</blockquote>
<hr>
<h3 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h3><img src="https://zerostione.github.io/ImageUp//Image/Blog/Redis/p1.png" style="zoom: 67%;" />

<p><strong>Windows</strong></p>
<p>1.下载</p>
<p><a target="_blank" rel="noopener" href="https://github.com/dmajkic/redis/releases">redis·GitHub</a></p>
<p><a target="_blank" rel="noopener" href="https://github.com/microsoftarchive/redis">microsoftarchive/redis</a></p>
<p><a target="_blank" rel="noopener" href="https://github.com/tporadowski/redis">Native port of Redis for Windows</a></p>
<p>2.启动</p>
<ul>
<li>点击redis-server.exe</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">启动失败</span></span><br><span class="line">redis-server.exe redis.windows.conf</span><br></pre></td></tr></table></figure>

<ul>
<li>客户端:redis-cli.exe</li>
</ul>
<hr>
<h3 id="性能测试"><a href="#性能测试" class="headerlink" title="性能测试"></a>性能测试</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">redis-benchmark [option] [option value]</span><br><span class="line">redis-benchmark -h localhost -p 6379 -c 100 -n 100000 -a password</span><br></pre></td></tr></table></figure>

<p>Redis性能测试工具可选参数</p>
<table>
<thead>
<tr>
<th align="left">序号</th>
<th align="center">选项</th>
<th align="center">描述</th>
<th align="center">默认值</th>
</tr>
</thead>
<tbody><tr>
<td align="left">1</td>
<td align="center"><strong>-h</strong></td>
<td align="center">指定服务器主机名</td>
<td align="center">127.0.0.1</td>
</tr>
<tr>
<td align="left">2</td>
<td align="center"><strong>-p</strong></td>
<td align="center">指定服务器端口</td>
<td align="center">6379</td>
</tr>
<tr>
<td align="left">3</td>
<td align="center"><strong>-s</strong></td>
<td align="center">指定服务器 socket</td>
<td align="center"></td>
</tr>
<tr>
<td align="left">4</td>
<td align="center"><strong>-c</strong></td>
<td align="center">指定并发连接数</td>
<td align="center">50</td>
</tr>
<tr>
<td align="left">5</td>
<td align="center"><strong>-n</strong></td>
<td align="center">指定请求数</td>
<td align="center">10000</td>
</tr>
<tr>
<td align="left">6</td>
<td align="center"><strong>-d</strong></td>
<td align="center">以字节的形式指定 SET/GET 值的数据大小</td>
<td align="center">2</td>
</tr>
<tr>
<td align="left">7</td>
<td align="center"><strong>-k</strong></td>
<td align="center">1=keep alive 0=reconnect</td>
<td align="center">1</td>
</tr>
<tr>
<td align="left">8</td>
<td align="center"><strong>-r</strong></td>
<td align="center">SET/GET/INCR 使用随机 key, SADD 使用随机值</td>
<td align="center"></td>
</tr>
<tr>
<td align="left">9</td>
<td align="center"><strong>-P</strong></td>
<td align="center">通过管道传输 <numreq> 请求</td>
<td align="center">1</td>
</tr>
<tr>
<td align="left">10</td>
<td align="center"><strong>-q</strong></td>
<td align="center">强制退出 redis。仅显示 query/sec 值</td>
<td align="center"></td>
</tr>
<tr>
<td align="left">11</td>
<td align="center"><strong>–csv</strong></td>
<td align="center">以 CSV 格式输出</td>
<td align="center"></td>
</tr>
<tr>
<td align="left">12</td>
<td align="center"><strong>-l</strong></td>
<td align="center">生成循环，永久执行测试</td>
<td align="center"></td>
</tr>
<tr>
<td align="left">13</td>
<td align="center"><strong>-t</strong></td>
<td align="center">仅运行以逗号分隔的测试命令列表。</td>
<td align="center"></td>
</tr>
<tr>
<td align="left">14</td>
<td align="center"><strong>-I</strong></td>
<td align="center">Idle 模式。仅打开 N 个 idle 连接并等待。</td>
<td align="center"></td>
</tr>
</tbody></table>
<hr>
<h3 id="命令"><a href="#命令" class="headerlink" title="命令"></a>命令</h3><blockquote>
<p>1.Redis每个数据库对外都是一个从0开始的递增数字命名，Redis默认支持16个数据库（可以通过配置文件支持更多，无上限），通过配置databases修改。客户端与Redis建立连接后会默认选择0号数据库，可以使用SELECT命令更换数据库。</p>
</blockquote>
<p><a target="_blank" rel="noopener" href="https://redis.io/commands/">command</a></p>
<p>1.启动Redis</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">redis-server redis.conf</span><br></pre></td></tr></table></figure>

<p>2.连接Redis</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">redis-cli -h 127.0.0.1 -p 6379 [-a password]</span><br></pre></td></tr></table></figure>

<p>3.关闭Redis</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">redis-cli [-a password] shutdown</span><br></pre></td></tr></table></figure>

<hr>
<p>1.测试连通性</p>
<figure class="highlight accesslog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">127.0.0.1:6379</span>&gt; ping</span><br><span class="line">PONG</span><br></pre></td></tr></table></figure>

<p>2.选择数据库db_index</p>
<figure class="highlight accesslog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">127.0.0.1:6379</span>&gt; select <span class="number">3</span></span><br><span class="line">OK</span><br></pre></td></tr></table></figure>

<p>3.删除当前选定数据库的所有键</p>
<figure class="highlight accesslog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">127.0.0.1:6379</span><span class="string">[1]</span>&gt; flushdb</span><br><span class="line">OK</span><br></pre></td></tr></table></figure>

<p>4.删除所有现有数据库的所有键</p>
<figure class="highlight accesslog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">127.0.0.1:6379</span><span class="string">[1]</span>&gt; flushall</span><br><span class="line">OK</span><br></pre></td></tr></table></figure>

<hr>
<p><strong>Redis Key</strong></p>
<p>1.获取该数据库所有键</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">127</span>.<span class="number">0</span>.<span class="number">0</span>.<span class="number">1</span>:<span class="number">6379</span>[<span class="number">1</span>]&gt; keys *</span><br><span class="line"><span class="attribute">1</span>) <span class="string">&quot;test&quot;</span></span><br></pre></td></tr></table></figure>

<p>2.返回当前数据库中的键总数</p>
<figure class="highlight accesslog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">127.0.0.1:6379</span><span class="string">[1]</span>&gt; dbsize</span><br><span class="line">(integer) <span class="number">1</span></span><br></pre></td></tr></table></figure>

<p>3.查询键是否存在</p>
<figure class="highlight accesslog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">127.0.0.1:6379</span><span class="string">[1]</span>&gt; set name admin</span><br><span class="line">OK</span><br><span class="line"><span class="number">127.0.0.1:6379</span><span class="string">[1]</span>&gt; exists name</span><br><span class="line">(integer) <span class="number">1</span></span><br><span class="line"><span class="number">127.0.0.1:6379</span><span class="string">[1]</span>&gt; exists username</span><br><span class="line">(integer) <span class="number">0</span></span><br><span class="line"><span class="number">127.0.0.1:6379</span><span class="string">[1]</span>&gt; exists username name #查询多个返回存在的个数</span><br><span class="line">(integer) <span class="number">1</span></span><br></pre></td></tr></table></figure>

<p>4.删除键</p>
<figure class="highlight accesslog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">127.0.0.1:6379</span>&gt; del name     #删除多个返回删除成功的个数</span><br><span class="line">(integer) <span class="number">1</span></span><br></pre></td></tr></table></figure>

<p>5.查询键类型</p>
<figure class="highlight accesslog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">127.0.0.1:6379</span><span class="string">[2]</span>&gt; type name</span><br><span class="line">string </span><br></pre></td></tr></table></figure>

<p>6.移动键</p>
<figure class="highlight accesslog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">127.0.0.1:6379</span><span class="string">[1]</span>&gt; move name <span class="number">2</span></span><br><span class="line">(integer) <span class="number">1</span></span><br><span class="line"><span class="number">127.0.0.1:6379</span><span class="string">[1]</span>&gt; keys *</span><br><span class="line">(empty array)</span><br><span class="line"><span class="number">127.0.0.1:6379</span><span class="string">[1]</span>&gt; select <span class="number">2</span></span><br><span class="line">OK</span><br><span class="line"><span class="number">127.0.0.1:6379</span><span class="string">[2]</span>&gt; keys *</span><br><span class="line"><span class="number">1</span>) <span class="string">&quot;name&quot;</span></span><br></pre></td></tr></table></figure>

<p>7.查询key的生命周期（秒）</p>
<blockquote>
<p>秒：ttl key<br>毫秒：pttl key</p>
<p>-1：键永远不过期</p>
<p>-2：键不存在</p>
</blockquote>
<figure class="highlight accesslog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">127.0.0.1:6379</span><span class="string">[2]</span>&gt; ttl name</span><br><span class="line">(integer) -<span class="number">1</span></span><br></pre></td></tr></table></figure>

<p>8.设置过期时间</p>
<blockquote>
<p>秒：expire key seconds<br>毫秒：pexpire key milliseconds</p>
<p>1:设置成功</p>
<p>0:当key不存在或者不能为key设置过期时间时</p>
</blockquote>
<figure class="highlight accesslog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">127.0.0.1:6379</span>&gt; expire name <span class="number">60</span></span><br><span class="line">(integer) <span class="number">1</span></span><br><span class="line"><span class="number">127.0.0.1:6379</span>&gt; ttl name</span><br><span class="line">(integer) <span class="number">45</span></span><br></pre></td></tr></table></figure>

<p>9.设置永不过期</p>
<blockquote>
<p>persist key</p>
<p>1:当key设置了过期时间，同时使用persist成功返回1。</p>
<p>0:key不存在或本身永久有效。</p>
</blockquote>
<figure class="highlight accesslog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">127.0.0.1:6379</span>&gt; expire name <span class="number">60</span></span><br><span class="line">(integer) <span class="number">1</span></span><br><span class="line"><span class="number">127.0.0.1:6379</span>&gt; persist name</span><br><span class="line">(integer) <span class="number">1</span></span><br></pre></td></tr></table></figure>

<p>10.更改键名称</p>
<blockquote>
<p>rename key newkey</p>
</blockquote>
<figure class="highlight accesslog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">127.0.0.1:6379</span>&gt; rename name username</span><br><span class="line">OK</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th align="center">命令</th>
<th align="center">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="center">AUTH password</td>
<td align="center">验证密码是否正确</td>
</tr>
<tr>
<td align="center">ECHO message</td>
<td align="center">打印字符串</td>
</tr>
<tr>
<td align="center">PING</td>
<td align="center">查看服务是否运行</td>
</tr>
<tr>
<td align="center">QUIT</td>
<td align="center">关闭当前连接</td>
</tr>
<tr>
<td align="center">SELECT index</td>
<td align="center">切换到指定的数据库</td>
</tr>
</tbody></table>
<h3 id="数据类型"><a href="#数据类型" class="headerlink" title="数据类型"></a>数据类型</h3><p><a target="_blank" rel="noopener" href="https://redis.io/docs/manual/data-types/">Redis data types</a></p>
<p><a target="_blank" rel="noopener" href="https://redis.com/redis-enterprise/data-structures/">Data Structures</a></p>
<img src="https://zerostione.github.io/ImageUp//Image/Blog/Redis/p11.png" style="zoom: 50%;" />

<img src="https://zerostione.github.io/ImageUp//Image/Blog/Redis/p12.png" style="zoom: 80%;" />

<blockquote>
<p>Redis 是一个开源（BSD许可）的，内存中的数据结构存储系统，它可以用作数据库、缓存和消息中间件。 它支持多种类型的数据结构，如 字符串（strings）， 散列（hashes）， 列表（lists）， 集合（sets）， 有序集合（sorted sets） 与范围查询， bitmaps， hyperloglogs 和 地理空间（geospatial） 索引半径查询。 Redis 内置了 复制（replication），LUA脚本（Lua scripting）， LRU驱动事件（LRU eviction），事务（transactions） 和不同级别的 磁盘持久化（persistence）， 并通过 Redis哨兵（Sentinel）和自动 分区（Cluster）提供高可用性（high availability）</p>
</blockquote>
<table>
<thead>
<tr>
<th align="center">数据类型</th>
<th align="center">简介</th>
</tr>
</thead>
<tbody><tr>
<td align="center">String(字符串)</td>
<td align="center">String 是 redis 最基本的类型，string 类型的值最大能存储 512MB，一个 key 对应一个 value。string 类型是二进制安全的，即 redis 的 string 可以包含任何数据，如jpg图片或者序列化的对象。</td>
</tr>
<tr>
<td align="center">Hash(哈希)</td>
<td align="center">Hash 是一个键值(key=&gt;value)对集合。Redis hash 是一个 string 类型的 field 和 value 的映射表，hash 适合用于存储对象。</td>
</tr>
<tr>
<td align="center">List(列表)</td>
<td align="center">List 是简单的字符串列表，允许重复的成员，按插入顺序排序。可添加一个元素到列表的头部（左边）或者尾部（右边）。</td>
</tr>
<tr>
<td align="center">Set(集合)</td>
<td align="center">Set 是 string 类型的无序集合，不允许重复的成员。集合通过哈希表实现，即添加，删除，查找的复杂度均为 O(1)。</td>
</tr>
<tr>
<td align="center">Zset(sorted set：有序集合)</td>
<td align="center">Zset 是 string 类型元素的集合,不允许重复的成员。每个元素都关联一个double类型分数。redis通过分数为集合中的成员进行从小到大的排序。zset的成员是唯一的,但分数(score)可以重复。</td>
</tr>
</tbody></table>
<hr>
<h4 id="String"><a href="#String" class="headerlink" title="String"></a>String</h4><img src="https://zerostione.github.io/ImageUp//Image/Blog/Redis/p13.png" style="zoom: 80%;" />

<blockquote>
<p>One of the most versatile of Redis’ building blocks, Redis Strings is a binary-safe data structure. It can store any kind of data–a string, integer, floating point value, JPEG image, serialized Ruby object, or anything else you want it to carry. Operate on a whole string or parts, and increment or decrement integers and floats.</p>
</blockquote>
<table>
<thead>
<tr>
<th align="center">常用命令</th>
<th align="center">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="center">SET key value</td>
<td align="center">设置指定 key 的值</td>
</tr>
<tr>
<td align="center">GET key</td>
<td align="center">获取指定 key 的值</td>
</tr>
<tr>
<td align="center">GETRANGE key start end</td>
<td align="center">返回 key 中字符串值的子字符</td>
</tr>
<tr>
<td align="center">GETSET key value</td>
<td align="center">将给定 key 的值设为 value ，并返回 key 的旧值(old value)</td>
</tr>
<tr>
<td align="center">GETBIT key offset</td>
<td align="center">对 key 所储存的字符串值，获取指定偏移量上的位(bit)</td>
</tr>
<tr>
<td align="center">MGET key1 key2..</td>
<td align="center">获取所有(一个或多个)给定 key 的值</td>
</tr>
<tr>
<td align="center">SETBIT key offset value</td>
<td align="center">对 key 所储存的字符串值，设置或清除指定偏移量上的位(bit)。位的设置或清除取决于 value 参数，当 value 是 0 时清除偏移量上的位，当 value 是 1 时设置偏移量上的位。当 key 不存在时，自动生成一个新的字符串值</td>
</tr>
<tr>
<td align="center">SETEX key seconds value</td>
<td align="center">(set with expire)将键 key 的值设置为 value ， 并将键 key 的生存时间设置为 seconds 秒钟</td>
</tr>
<tr>
<td align="center">SETNX key value</td>
<td align="center">(set if not exist)只有在 key 不存在时设置 key 的值</td>
</tr>
<tr>
<td align="center">SETRANGE key offset value</td>
<td align="center">用 value 参数覆写给定 key 所储存的字符串值，从偏移量 offset 开始</td>
</tr>
<tr>
<td align="center">STRLEN key</td>
<td align="center">返回 key 所储存的字符串值的长度</td>
</tr>
<tr>
<td align="center">MSET key value key value …</td>
<td align="center">同时设置一个或多个 key-value 对</td>
</tr>
<tr>
<td align="center">MSETNX key value key value …</td>
<td align="center">同时设置一个或多个 key-value 对，当且仅当所有给定 key 都不存在</td>
</tr>
<tr>
<td align="center">PSETEX key milliseconds value</td>
<td align="center">以毫秒为单位设置 key 的生存时间</td>
</tr>
<tr>
<td align="center">INCR key</td>
<td align="center">将 key 中储存的数字值增一</td>
</tr>
<tr>
<td align="center">INCRBY key increment</td>
<td align="center">将 key 所储存的值加上给定的增量值（increment）</td>
</tr>
<tr>
<td align="center">INCRBYFLOAT key increment</td>
<td align="center">将 key 所储存的值加上给定的浮点增量值（increment）</td>
</tr>
<tr>
<td align="center">DECR key</td>
<td align="center">将 key 中储存的数字值减一</td>
</tr>
<tr>
<td align="center">DECRBY key decrement</td>
<td align="center">key 所储存的值减去给定的减量值（decrement）</td>
</tr>
<tr>
<td align="center">APPEND key value</td>
<td align="center">如果 key 已经存在并且是一个字符串， APPEND 命令将指定的 value 追加到该 key 原来值（value）的末尾</td>
</tr>
</tbody></table>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">127.0.0.1:6379&gt;</span> keys *</span><br><span class="line">(empty array)</span><br><span class="line"><span class="meta">127.0.0.1:6379&gt;</span> set k1 v1</span><br><span class="line">OK</span><br><span class="line"><span class="meta">127.0.0.1:6379&gt;</span> get k1</span><br><span class="line"><span class="string">&quot;v1&quot;</span></span><br><span class="line"><span class="meta">127.0.0.1:6379&gt;</span> set msg HelloRedis</span><br><span class="line">OK</span><br><span class="line"><span class="meta">127.0.0.1:6379&gt;</span> getrange msg <span class="number">4</span> <span class="number">7</span></span><br><span class="line"><span class="string">&quot;oRed&quot;</span></span><br><span class="line"><span class="meta">127.0.0.1:6379&gt;</span> setrange msg <span class="number">5</span> Jedis</span><br><span class="line">(integer) <span class="number">10</span></span><br><span class="line"><span class="meta">127.0.0.1:6379&gt;</span> get msg</span><br><span class="line"><span class="string">&quot;HelloJedis&quot;</span></span><br><span class="line"><span class="meta">127.0.0.1:6379&gt;</span> getset msg HelloWorld</span><br><span class="line"><span class="string">&quot;HelloJedis&quot;</span></span><br><span class="line"><span class="meta">127.0.0.1:6379&gt;</span> getrange msg <span class="number">0</span> -<span class="number">1</span></span><br><span class="line"><span class="string">&quot;HelloWorld&quot;</span></span><br><span class="line"><span class="meta">127.0.0.1:6379&gt;</span> setbit bit <span class="number">10</span> <span class="number">1</span></span><br><span class="line">(integer) <span class="number">0</span></span><br><span class="line"><span class="meta">127.0.0.1:6379&gt;</span> getbit bit <span class="number">10</span></span><br><span class="line">(integer) <span class="number">1</span></span><br><span class="line"><span class="meta">127.0.0.1:6379&gt;</span> getbit bit <span class="number">9</span></span><br><span class="line">(integer) <span class="number">0</span></span><br><span class="line"><span class="meta">127.0.0.1:6379&gt;</span> setbit bit <span class="number">10</span> <span class="number">0</span></span><br><span class="line">(integer) <span class="number">1</span></span><br><span class="line"><span class="meta">127.0.0.1:6379&gt;</span> getbit bit <span class="number">10</span></span><br><span class="line">(integer) <span class="number">0</span></span><br><span class="line"><span class="meta">127.0.0.1:6379&gt;</span> mget msg k1</span><br><span class="line"><span class="number">1</span>) <span class="string">&quot;HelloWorld&quot;</span></span><br><span class="line"><span class="number">2</span>) <span class="string">&quot;v1&quot;</span></span><br><span class="line"><span class="meta">127.0.0.1:6379&gt;</span> setex username <span class="number">60</span> Coco</span><br><span class="line">OK</span><br><span class="line"><span class="meta">127.0.0.1:6379&gt;</span> ttl username</span><br><span class="line">(integer) <span class="number">53</span></span><br><span class="line"><span class="meta">127.0.0.1:6379&gt;</span> setnx name admin</span><br><span class="line">(integer) <span class="number">1</span></span><br><span class="line"><span class="meta">127.0.0.1:6379&gt;</span> setrange name <span class="number">1</span> john</span><br><span class="line">(integer) <span class="number">5</span></span><br><span class="line"><span class="meta">127.0.0.1:6379&gt;</span> get name</span><br><span class="line"><span class="string">&quot;ajohn</span></span><br><span class="line"><span class="string">127.0.0.1:6379&gt; strlen name</span></span><br><span class="line"><span class="string">(integer) 5</span></span><br><span class="line"><span class="string">127.0.0.1:6379&gt; mset key1 value1 key2 value2</span></span><br><span class="line"><span class="string">OK</span></span><br><span class="line"><span class="string">127.0.0.1:6379&gt; mget key1 key2</span></span><br><span class="line"><span class="string">1) &quot;</span>value1<span class="string">&quot;</span></span><br><span class="line"><span class="string">2) &quot;</span>value2<span class="string">&quot;</span></span><br><span class="line"><span class="string">127.0.0.1:6379&gt; msetnx team1 Killer team2 player</span></span><br><span class="line"><span class="string">(integer) 1</span></span><br><span class="line"><span class="string">127.0.0.1:6379&gt; mget team1 team2</span></span><br><span class="line"><span class="string">1) &quot;</span>Killer<span class="string">&quot;</span></span><br><span class="line"><span class="string">2) &quot;</span>player<span class="string">&quot;</span></span><br><span class="line"><span class="string">127.0.0.1:6379&gt; psetex team3 60000 noob </span></span><br><span class="line"><span class="string">OK</span></span><br><span class="line"><span class="string">127.0.0.1:6379&gt; pttl team3</span></span><br><span class="line"><span class="string">(integer) 58267</span></span><br><span class="line"><span class="string">127.0.0.1:6379&gt; set num1 45</span></span><br><span class="line"><span class="string">OK</span></span><br><span class="line"><span class="string">127.0.0.1:6379&gt; get num1</span></span><br><span class="line"><span class="string">&quot;</span><span class="number">45</span><span class="string">&quot;</span></span><br><span class="line"><span class="string">127.0.0.1:6379&gt; incr num1</span></span><br><span class="line"><span class="string">(integer) 46</span></span><br><span class="line"><span class="string">127.0.0.1:6379&gt; incr num1</span></span><br><span class="line"><span class="string">(integer) 47</span></span><br><span class="line"><span class="string">127.0.0.1:6379&gt; incrby num1 59</span></span><br><span class="line"><span class="string">(integer) 106</span></span><br><span class="line"><span class="string">127.0.0.1:6379&gt; decr num1</span></span><br><span class="line"><span class="string">(integer) 105</span></span><br><span class="line"><span class="string">127.0.0.1:6379&gt; decrby num1 65</span></span><br><span class="line"><span class="string">(integer) 40</span></span><br><span class="line"><span class="string">127.0.0.1:6379&gt; append num1 isnum1</span></span><br><span class="line"><span class="string">(integer) 8</span></span><br><span class="line"><span class="string">127.0.0.1:6379&gt; get num1</span></span><br><span class="line"><span class="string">&quot;</span>40isnum1<span class="string">&quot;</span></span><br><span class="line"><span class="string">127.0.0.1:6379&gt; set num2 16.45</span></span><br><span class="line"><span class="string">OK</span></span><br><span class="line"><span class="string">127.0.0.1:6379&gt; incrbyfloat num2 1.97</span></span><br><span class="line"><span class="string">&quot;</span><span class="number">18.42</span><span class="string">&quot;</span></span><br></pre></td></tr></table></figure>

<hr>
<h4 id="List"><a href="#List" class="headerlink" title="List"></a>List</h4><img src="https://zerostione.github.io/ImageUp//Image/Blog/Redis/p14.png" style="zoom: 80%;" />

<blockquote>
<p>Redis Lists holds collections of string elements sorted according to their order of insertion. Push or pop items from both ends, trim based on offsets, read individual or multiple items, or find or remove items by value and position. You can also make blocking calls for asynchronous message transfers.</p>
</blockquote>
<table>
<thead>
<tr>
<th align="center">命令</th>
<th align="center">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="center">BLPOP key1 [key2] timeout</td>
<td align="center">移出并获取列表的第一个元素， 如果列表没有元素会阻塞列表直到等待超时或发现可弹出元素为止</td>
</tr>
<tr>
<td align="center">BRPOP key1 [key2] timeout</td>
<td align="center">移出并获取列表的最后一个元素， 如果列表没有元素会阻塞列表直到等待超时或发现可弹出元素为止</td>
</tr>
<tr>
<td align="center">BRPOPLPUSH source destination timeout</td>
<td align="center">从列表中取出最后一个元素，并插入到另外一个列表的头部，如果列表没有元素会阻塞列表直到等待超时或发现可弹出元素为止</td>
</tr>
<tr>
<td align="center">LINDEX key index</td>
<td align="center">通过索引获取列表中的元素</td>
</tr>
<tr>
<td align="center">LINSERT key BEFORE|AFTER pivot value</td>
<td align="center">在列表的元素前或者后插入元素</td>
</tr>
<tr>
<td align="center">LLEN key</td>
<td align="center">获取列表长度</td>
</tr>
<tr>
<td align="center">LPOP key</td>
<td align="center">移出并获取列表的第一个元素</td>
</tr>
<tr>
<td align="center">LPUSH key value1 [value2]</td>
<td align="center">将一个或多个值插入到列表头部</td>
</tr>
<tr>
<td align="center">LPUSHX key value</td>
<td align="center">将一个值插入到已存在的列表头部</td>
</tr>
<tr>
<td align="center">LRANGE key start stop</td>
<td align="center">获取列表指定范围内的元素</td>
</tr>
<tr>
<td align="center">LREM key count value</td>
<td align="center">根据参数 count 的值，移除列表中与参数 value 相等的元素。count &gt; 0:从表头开始向表尾搜索，移除与 value 相等的元素，数量为 count 。count &lt; 0:从表尾开始向表头搜索，移除与 value 相等的元素，数量为 count 的绝对值。count = 0:移除表中所有与 value 相等的值。</td>
</tr>
<tr>
<td align="center">LSET key index value</td>
<td align="center">将列表 key 下标为 index 的元素的值设置为 value</td>
</tr>
<tr>
<td align="center">LTRIM key start stop</td>
<td align="center">让列表只保留指定区间内的元素，不在指定区间之内的元素都将被删除</td>
</tr>
<tr>
<td align="center">RPOP key</td>
<td align="center">移除列表的最后一个元素，返回值为移除的元素</td>
</tr>
<tr>
<td align="center">RPOPLPUSH source destination</td>
<td align="center">将列表 source 中的最后一个元素(尾元素)弹出并返回,将 source 弹出的元素插入到列表 destination ，作为 destination 列表的的头元素</td>
</tr>
<tr>
<td align="center">RPUSH key value1 [value2]</td>
<td align="center">在列表尾部添加一个或多个值</td>
</tr>
<tr>
<td align="center">RPUSHX key value</td>
<td align="center">将值 value 插入到列表 key 的表尾，当且仅当 key 存在并且是一个列表</td>
</tr>
</tbody></table>
<figure class="highlight tcl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span>&gt; lpush team Mike</span><br><span class="line">(integer) <span class="number">1</span></span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span>&gt; lpush team John</span><br><span class="line">(integer) <span class="number">2</span></span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span>&gt; lpush team Peter</span><br><span class="line">(integer) <span class="number">3</span></span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span>&gt; llen team</span><br><span class="line">(integer) <span class="number">3</span></span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span>&gt; <span class="keyword">lrange</span> team <span class="number">0</span> <span class="number">2</span></span><br><span class="line"><span class="number">1</span>) <span class="string">&quot;Peter&quot;</span></span><br><span class="line"><span class="number">2</span>) <span class="string">&quot;John&quot;</span></span><br><span class="line"><span class="number">3</span>) <span class="string">&quot;Mike&quot;</span></span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span>&gt; <span class="keyword">lrange</span> team <span class="number">0</span> <span class="number">-1</span></span><br><span class="line"><span class="number">1</span>) <span class="string">&quot;Peter&quot;</span></span><br><span class="line"><span class="number">2</span>) <span class="string">&quot;John&quot;</span></span><br><span class="line"><span class="number">3</span>) <span class="string">&quot;Mike&quot;</span></span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span>&gt; blpop team <span class="number">60</span></span><br><span class="line"><span class="number">1</span>) <span class="string">&quot;team&quot;</span></span><br><span class="line"><span class="number">2</span>) <span class="string">&quot;Peter&quot;</span></span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span>&gt; brpop team <span class="number">60</span></span><br><span class="line"><span class="number">1</span>) <span class="string">&quot;team&quot;</span></span><br><span class="line"><span class="number">2</span>) <span class="string">&quot;Mike&quot;</span></span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span>&gt;  <span class="keyword">lrange</span> team <span class="number">0</span> <span class="number">-1</span></span><br><span class="line"><span class="number">1</span>) <span class="string">&quot;John&quot;</span></span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span>&gt; lpush team tim</span><br><span class="line">(integer) <span class="number">2</span></span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span>&gt; lpush team Deft</span><br><span class="line">(integer) <span class="number">3</span></span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span>&gt;  <span class="keyword">lrange</span> team <span class="number">0</span> <span class="number">-1</span></span><br><span class="line"><span class="number">1</span>) <span class="string">&quot;Deft&quot;</span></span><br><span class="line"><span class="number">2</span>) <span class="string">&quot;tim&quot;</span></span><br><span class="line"><span class="number">3</span>) <span class="string">&quot;John&quot;</span></span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span>&gt; brpoplpush team team1 <span class="number">60</span></span><br><span class="line"><span class="string">&quot;John&quot;</span></span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span>&gt;  <span class="keyword">lrange</span> team1 <span class="number">0</span> <span class="number">-1</span></span><br><span class="line"><span class="number">1</span>) <span class="string">&quot;John&quot;</span></span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span>&gt; <span class="keyword">linsert</span> team before tim Alex</span><br><span class="line">(integer) <span class="number">3</span></span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span>&gt;  <span class="keyword">lrange</span> team <span class="number">0</span> <span class="number">-1</span> </span><br><span class="line"><span class="number">1</span>) <span class="string">&quot;Deft&quot;</span></span><br><span class="line"><span class="number">2</span>) <span class="string">&quot;Alex&quot;</span></span><br><span class="line"><span class="number">3</span>) <span class="string">&quot;tim&quot;</span></span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span>&gt; lpop team</span><br><span class="line"><span class="string">&quot;Deft&quot;</span></span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span>&gt;  <span class="keyword">lrange</span> team <span class="number">0</span> <span class="number">-1</span> </span><br><span class="line"><span class="number">1</span>) <span class="string">&quot;Alex&quot;</span></span><br><span class="line"><span class="number">2</span>) <span class="string">&quot;tim&quot;</span></span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span>&gt; lpushx team vk</span><br><span class="line">(integer) <span class="number">3</span></span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span>&gt;  <span class="keyword">lrange</span> team <span class="number">0</span> <span class="number">-1</span> </span><br><span class="line"><span class="number">1</span>) <span class="string">&quot;vk&quot;</span></span><br><span class="line"><span class="number">2</span>) <span class="string">&quot;Alex&quot;</span></span><br><span class="line"><span class="number">3</span>) <span class="string">&quot;tim&quot;</span></span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span>&gt;  <span class="keyword">lrange</span> team <span class="number">0</span> <span class="number">-1</span> </span><br><span class="line"><span class="number">1</span>) <span class="string">&quot;vk&quot;</span></span><br><span class="line"><span class="number">2</span>) <span class="string">&quot;Alex&quot;</span></span><br><span class="line"><span class="number">3</span>) <span class="string">&quot;tim&quot;</span></span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span>&gt; lrem team <span class="number">1</span> tim</span><br><span class="line">(integer) <span class="number">1</span></span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span>&gt;  <span class="keyword">lrange</span> team <span class="number">0</span> <span class="number">-1</span></span><br><span class="line"><span class="number">1</span>) <span class="string">&quot;vk&quot;</span></span><br><span class="line"><span class="number">2</span>) <span class="string">&quot;Alex&quot;</span></span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span>&gt; <span class="keyword">lset</span> team <span class="number">1</span> Elex</span><br><span class="line">OK</span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span>&gt;  <span class="keyword">lrange</span> team <span class="number">0</span> <span class="number">-1</span></span><br><span class="line"><span class="number">1</span>) <span class="string">&quot;vk&quot;</span></span><br><span class="line"><span class="number">2</span>) <span class="string">&quot;Elex&quot;</span></span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span>&gt; lpush team Joker</span><br><span class="line">(integer) <span class="number">3</span></span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span>&gt; lpush team Hoya</span><br><span class="line">(integer) <span class="number">4</span></span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span>&gt; lpush team Flu</span><br><span class="line">(integer) <span class="number">5</span></span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span>&gt;  <span class="keyword">lrange</span> team <span class="number">0</span> <span class="number">-1</span></span><br><span class="line"><span class="number">1</span>) <span class="string">&quot;Flu&quot;</span></span><br><span class="line"><span class="number">2</span>) <span class="string">&quot;Hoya&quot;</span></span><br><span class="line"><span class="number">3</span>) <span class="string">&quot;Joker&quot;</span></span><br><span class="line"><span class="number">4</span>) <span class="string">&quot;vk&quot;</span></span><br><span class="line"><span class="number">5</span>) <span class="string">&quot;Elex&quot;</span></span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span>&gt; ltrim team <span class="number">1</span> <span class="number">3</span></span><br><span class="line">OK</span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span>&gt;  <span class="keyword">lrange</span> team <span class="number">0</span> <span class="number">-1</span></span><br><span class="line"><span class="number">1</span>) <span class="string">&quot;Hoya&quot;</span></span><br><span class="line"><span class="number">2</span>) <span class="string">&quot;Joker&quot;</span></span><br><span class="line"><span class="number">3</span>) <span class="string">&quot;vk&quot;</span></span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span>&gt; rpoplpush team team1</span><br><span class="line"><span class="string">&quot;vk&quot;</span></span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span>&gt;  <span class="keyword">lrange</span> team <span class="number">0</span> <span class="number">-1</span></span><br><span class="line"><span class="number">1</span>) <span class="string">&quot;Hoya&quot;</span></span><br><span class="line"><span class="number">2</span>) <span class="string">&quot;Joker&quot;</span></span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span>&gt;  <span class="keyword">lrange</span> team1 <span class="number">0</span> <span class="number">-1</span></span><br><span class="line"><span class="number">1</span>) <span class="string">&quot;vk&quot;</span></span><br><span class="line"><span class="number">2</span>) <span class="string">&quot;John&quot;</span></span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span>&gt; rpush team One Ioer</span><br><span class="line">(integer) <span class="number">4</span></span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span>&gt;  <span class="keyword">lrange</span> team <span class="number">0</span> <span class="number">-1</span></span><br><span class="line"><span class="number">1</span>) <span class="string">&quot;Hoya&quot;</span></span><br><span class="line"><span class="number">2</span>) <span class="string">&quot;Joker&quot;</span></span><br><span class="line"><span class="number">3</span>) <span class="string">&quot;One&quot;</span></span><br><span class="line"><span class="number">4</span>) <span class="string">&quot;Ioer&quot;</span></span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span>&gt; rpushx team Truth</span><br><span class="line">(integer) <span class="number">5</span></span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span>&gt;  <span class="keyword">lrange</span> team <span class="number">0</span> <span class="number">-1</span></span><br><span class="line"><span class="number">1</span>) <span class="string">&quot;Hoya&quot;</span></span><br><span class="line"><span class="number">2</span>) <span class="string">&quot;Joker&quot;</span></span><br><span class="line"><span class="number">3</span>) <span class="string">&quot;One&quot;</span></span><br><span class="line"><span class="number">4</span>) <span class="string">&quot;Ioer&quot;</span></span><br><span class="line"><span class="number">5</span>) <span class="string">&quot;Truth&quot;</span></span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span>&gt; rpushx team2 Truth</span><br><span class="line">(integer) <span class="number">0</span></span><br></pre></td></tr></table></figure>

<hr>
<h4 id="Set"><a href="#Set" class="headerlink" title="Set"></a>Set</h4><img src="https://zerostione.github.io/ImageUp//Image/Blog/Redis/p15.png" style="zoom: 80%;" />

<blockquote>
<p>Redis Sets data structure stores a unique set of members. With Sets, you can add, fetch, or remove members, check membership, or retrieve a random member. You can also perform set operations such as intersection, union, and set difference and compute set cardinality.</p>
</blockquote>
<table>
<thead>
<tr>
<th align="center">命令</th>
<th align="center">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="center">SADD key member1 [member2]</td>
<td align="center">向集合添加一个或多个成员</td>
</tr>
<tr>
<td align="center">SCARD key</td>
<td align="center">获取集合的成员数</td>
</tr>
<tr>
<td align="center">SDIFF key1 [key2]</td>
<td align="center">返回第一个集合与其他集合之间的差异。</td>
</tr>
<tr>
<td align="center">SDIFFSTORE destination key1 [key2]</td>
<td align="center">返回给定所有集合的差集并存储在 destination 中</td>
</tr>
<tr>
<td align="center">SINTER key1 [key2]</td>
<td align="center">返回给定所有集合的交集</td>
</tr>
<tr>
<td align="center">SINTERSTORE destination key1 [key2]</td>
<td align="center">返回给定所有集合的交集并存储在 destination 中</td>
</tr>
<tr>
<td align="center">SISMEMBER key member</td>
<td align="center">判断 member 元素是否是集合 key 的成员</td>
</tr>
<tr>
<td align="center">SMEMBERS key</td>
<td align="center">返回集合中的所有成员</td>
</tr>
<tr>
<td align="center">SMOVE source destination member</td>
<td align="center">将 member 元素从 source 集合移动到 destination 集合</td>
</tr>
<tr>
<td align="center">SPOP key</td>
<td align="center">移除并返回集合中的一个随机元素</td>
</tr>
<tr>
<td align="center">SRANDMEMBER key [coun]</td>
<td align="center">只有key返回集合中的一个随机元素。如果 count 为正数，且小于集合基数，那么命令返回一个包含 count 个元素的数组，数组中的元素各不相同。如果 count 大于等于集合基数，那么返回整个集合。如果 count 为负数，那么命令返回一个数组，数组中的元素可能会重复出现多次，而数组的长度为 count 的绝对值。</td>
</tr>
<tr>
<td align="center">SREM key member1 [member2]</td>
<td align="center">移除集合中一个或多个成员</td>
</tr>
<tr>
<td align="center">SUNION key1 [key2]</td>
<td align="center">返回所有给定集合的并集</td>
</tr>
<tr>
<td align="center">SUNIONSTORE destination key1 [key2]</td>
<td align="center">所有给定集合的并集存储在 destination 集合中</td>
</tr>
<tr>
<td align="center">SSCAN key cursor [MATCH pattern] [COUNT count]</td>
<td align="center">迭代集合中的元素，cursor:游标，pattern:匹配的模式，count:指定从数据集里返回多少元素，默认值为 10</td>
</tr>
</tbody></table>
<figure class="highlight accesslog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">127.0.0.1:6379</span>&gt; sadd team Alice</span><br><span class="line">(integer) <span class="number">1</span></span><br><span class="line"><span class="number">127.0.0.1:6379</span>&gt; sadd team Bob</span><br><span class="line">(integer) <span class="number">1</span></span><br><span class="line"><span class="number">127.0.0.1:6379</span>&gt; sadd team Cookie</span><br><span class="line">(integer) <span class="number">1</span></span><br><span class="line"><span class="number">127.0.0.1:6379</span>&gt; scard team</span><br><span class="line">(integer) <span class="number">3</span></span><br><span class="line"><span class="number">127.0.0.1:6379</span>&gt; sadd team1 Alice</span><br><span class="line">(integer) <span class="number">1</span></span><br><span class="line"><span class="number">127.0.0.1:6379</span>&gt; sadd team1 Bob</span><br><span class="line">(integer) <span class="number">1</span></span><br><span class="line"><span class="number">127.0.0.1:6379</span>&gt; sdiff team team1</span><br><span class="line"><span class="number">1</span>) <span class="string">&quot;Cookie&quot;</span></span><br><span class="line"><span class="number">127.0.0.1:6379</span>&gt; sdiffstore team2 team team1</span><br><span class="line">(integer) <span class="number">1</span></span><br><span class="line"><span class="number">127.0.0.1:6379</span>&gt; smembers team2</span><br><span class="line"><span class="number">1</span>) <span class="string">&quot;Cookie&quot;</span></span><br><span class="line"><span class="number">127.0.0.1:6379</span>&gt; sinter team team1</span><br><span class="line"><span class="number">1</span>) <span class="string">&quot;Bob&quot;</span></span><br><span class="line"><span class="number">2</span>) <span class="string">&quot;Alice&quot;</span></span><br><span class="line"><span class="number">127.0.0.1:6379</span>&gt; sinterstore team4 team team1</span><br><span class="line">(integer) <span class="number">2</span></span><br><span class="line"><span class="number">127.0.0.1:6379</span>&gt; smembers team4</span><br><span class="line"><span class="number">1</span>) <span class="string">&quot;Alice&quot;</span></span><br><span class="line"><span class="number">2</span>) <span class="string">&quot;Bob&quot;</span></span><br><span class="line"><span class="number">127.0.0.1:6379</span>&gt; sismember team Alice</span><br><span class="line">(integer) <span class="number">1</span></span><br><span class="line"><span class="number">127.0.0.1:6379</span>&gt; sismember team alice</span><br><span class="line">(integer) <span class="number">0</span></span><br><span class="line"><span class="number">127.0.0.1:6379</span>&gt; smembers team1</span><br><span class="line"><span class="number">1</span>) <span class="string">&quot;Bob&quot;</span></span><br><span class="line"><span class="number">2</span>) <span class="string">&quot;Alice&quot;</span></span><br><span class="line"><span class="number">127.0.0.1:6379</span>&gt; smembers team2</span><br><span class="line"><span class="number">1</span>) <span class="string">&quot;Cookie&quot;</span></span><br><span class="line"><span class="number">127.0.0.1:6379</span>&gt; smove team2 team1 <span class="string">&quot;Cookie&quot;</span></span><br><span class="line">(integer) <span class="number">1</span></span><br><span class="line"><span class="number">127.0.0.1:6379</span>&gt; smembers team1</span><br><span class="line"><span class="number">1</span>) <span class="string">&quot;Cookie&quot;</span></span><br><span class="line"><span class="number">2</span>) <span class="string">&quot;Bob&quot;</span></span><br><span class="line"><span class="number">3</span>) <span class="string">&quot;Alice&quot;</span></span><br><span class="line"><span class="number">127.0.0.1:6379</span>&gt; smembers team2</span><br><span class="line">(empty array)</span><br><span class="line"><span class="number">127.0.0.1:6379</span>&gt; spop team</span><br><span class="line"><span class="string">&quot;Cookie&quot;</span></span><br><span class="line"><span class="number">127.0.0.1:6379</span>&gt; spop team</span><br><span class="line"><span class="string">&quot;Alice&quot;</span></span><br><span class="line"><span class="number">127.0.0.1:6379</span>&gt; smembers team</span><br><span class="line"><span class="number">1</span>) <span class="string">&quot;Bob&quot;</span></span><br><span class="line"><span class="number">127.0.0.1:6379</span>&gt; sadd team Xia</span><br><span class="line">(integer) <span class="number">1</span></span><br><span class="line"><span class="number">127.0.0.1:6379</span>&gt; sadd team Zod</span><br><span class="line">(integer) <span class="number">1</span></span><br><span class="line"><span class="number">127.0.0.1:6379</span>&gt; sadd team Nick</span><br><span class="line">(integer) <span class="number">1</span></span><br><span class="line"><span class="number">127.0.0.1:6379</span>&gt; sadd team Hu</span><br><span class="line">(integer) <span class="number">1</span></span><br><span class="line"><span class="number">127.0.0.1:6379</span>&gt; smembers team</span><br><span class="line"><span class="number">1</span>) <span class="string">&quot;Xia&quot;</span></span><br><span class="line"><span class="number">2</span>) <span class="string">&quot;Zod&quot;</span></span><br><span class="line"><span class="number">3</span>) <span class="string">&quot;Nick&quot;</span></span><br><span class="line"><span class="number">4</span>) <span class="string">&quot;Bob&quot;</span></span><br><span class="line"><span class="number">5</span>) <span class="string">&quot;Hu&quot;</span></span><br><span class="line"><span class="number">127.0.0.1:6379</span>&gt; srandmember team <span class="number">3</span></span><br><span class="line"><span class="number">1</span>) <span class="string">&quot;Xia&quot;</span></span><br><span class="line"><span class="number">2</span>) <span class="string">&quot;Hu&quot;</span></span><br><span class="line"><span class="number">3</span>) <span class="string">&quot;Bob&quot;</span></span><br><span class="line"><span class="number">127.0.0.1:6379</span>&gt; srandmember team <span class="number">3</span></span><br><span class="line"><span class="number">1</span>) <span class="string">&quot;Zod&quot;</span></span><br><span class="line"><span class="number">2</span>) <span class="string">&quot;Bob&quot;</span></span><br><span class="line"><span class="number">3</span>) <span class="string">&quot;Nick&quot;</span></span><br><span class="line"><span class="number">127.0.0.1:6379</span>&gt; srandmember team <span class="number">6</span></span><br><span class="line"><span class="number">1</span>) <span class="string">&quot;Xia&quot;</span></span><br><span class="line"><span class="number">2</span>) <span class="string">&quot;Zod&quot;</span></span><br><span class="line"><span class="number">3</span>) <span class="string">&quot;Nick&quot;</span></span><br><span class="line"><span class="number">4</span>) <span class="string">&quot;Bob&quot;</span></span><br><span class="line"><span class="number">5</span>) <span class="string">&quot;Hu&quot;</span></span><br><span class="line"><span class="number">127.0.0.1:6379</span>&gt; srandmember team -<span class="number">4</span></span><br><span class="line"><span class="number">1</span>) <span class="string">&quot;Zod&quot;</span></span><br><span class="line"><span class="number">2</span>) <span class="string">&quot;Nick&quot;</span></span><br><span class="line"><span class="number">3</span>) <span class="string">&quot;Nick&quot;</span></span><br><span class="line"><span class="number">4</span>) <span class="string">&quot;Bob&quot;</span></span><br><span class="line"><span class="number">127.0.0.1:6379</span>&gt; srem team Zod Xia</span><br><span class="line">(integer) <span class="number">2</span></span><br><span class="line"><span class="number">127.0.0.1:6379</span>&gt; smembers team</span><br><span class="line"><span class="number">1</span>) <span class="string">&quot;Hu&quot;</span></span><br><span class="line"><span class="number">2</span>) <span class="string">&quot;Bob&quot;</span></span><br><span class="line"><span class="number">3</span>) <span class="string">&quot;Nick&quot;</span></span><br><span class="line"><span class="number">127.0.0.1:6379</span>&gt; sunion team team1</span><br><span class="line"><span class="number">1</span>) <span class="string">&quot;Hu&quot;</span></span><br><span class="line"><span class="number">2</span>) <span class="string">&quot;Nick&quot;</span></span><br><span class="line"><span class="number">3</span>) <span class="string">&quot;Bob&quot;</span></span><br><span class="line"><span class="number">4</span>) <span class="string">&quot;Cookie&quot;</span></span><br><span class="line"><span class="number">5</span>) <span class="string">&quot;Alice&quot;</span></span><br><span class="line"><span class="number">127.0.0.1:6379</span>&gt; sunionstore team3 team team1 </span><br><span class="line">(integer) <span class="number">5</span></span><br><span class="line"><span class="number">127.0.0.1:6379</span>&gt; smembers team3</span><br><span class="line"><span class="number">1</span>) <span class="string">&quot;Hu&quot;</span></span><br><span class="line"><span class="number">2</span>) <span class="string">&quot;Nick&quot;</span></span><br><span class="line"><span class="number">3</span>) <span class="string">&quot;Bob&quot;</span></span><br><span class="line"><span class="number">4</span>) <span class="string">&quot;Cookie&quot;</span></span><br><span class="line"><span class="number">5</span>) <span class="string">&quot;Alice&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="number">127.0.0.1:6379</span>&gt; sadd nums n1</span><br><span class="line">(integer) <span class="number">1</span></span><br><span class="line">.......</span><br><span class="line"><span class="number">127.0.0.1:6379</span>&gt; sadd nums n10</span><br><span class="line">(integer) <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="number">127.0.0.1:6379</span>&gt; sscan nums <span class="number">0</span>  match n* count <span class="number">3</span></span><br><span class="line"><span class="number">1</span>) <span class="string">&quot;4&quot;</span></span><br><span class="line"><span class="number">2</span>) <span class="number">1</span>) <span class="string">&quot;n7&quot;</span></span><br><span class="line">   <span class="number">2</span>) <span class="string">&quot;n8&quot;</span></span><br><span class="line">   <span class="number">3</span>) <span class="string">&quot;n5&quot;</span></span><br><span class="line"><span class="number">127.0.0.1:6379</span>&gt; sscan nums <span class="number">4</span>  match n* count <span class="number">3</span></span><br><span class="line"><span class="number">1</span>) <span class="string">&quot;6&quot;</span></span><br><span class="line"><span class="number">2</span>) <span class="number">1</span>) <span class="string">&quot;n3&quot;</span></span><br><span class="line">   <span class="number">2</span>) <span class="string">&quot;n4&quot;</span></span><br><span class="line">   <span class="number">3</span>) <span class="string">&quot;n9&quot;</span></span><br><span class="line"><span class="number">127.0.0.1:6379</span>&gt; sscan nums <span class="number">6</span>  match n* count <span class="number">3</span></span><br><span class="line"><span class="number">1</span>) <span class="string">&quot;5&quot;</span></span><br><span class="line"><span class="number">2</span>) <span class="number">1</span>) <span class="string">&quot;n10&quot;</span></span><br><span class="line">   <span class="number">2</span>) <span class="string">&quot;n1&quot;</span></span><br><span class="line">   <span class="number">3</span>) <span class="string">&quot;n2&quot;</span></span><br><span class="line"><span class="number">127.0.0.1:6379</span>&gt; sscan nums <span class="number">5</span>  match n* count <span class="number">3</span></span><br><span class="line"><span class="number">1</span>) <span class="string">&quot;0&quot;</span></span><br><span class="line"><span class="number">2</span>) <span class="number">1</span>) <span class="string">&quot;n6&quot;</span></span><br></pre></td></tr></table></figure>

<hr>
<h4 id="Hash"><a href="#Hash" class="headerlink" title="Hash"></a>Hash</h4><img src="https://zerostione.github.io/ImageUp//Image/Blog/Redis/p16.png" style="zoom: 80%;" />

<blockquote>
<p>Similar to documents in a document store or rows in a relational database, the Redis Hashes structure stores a set of field-value pairs. It provides the ability to add, fetch, or remove individual items and fetch the entire hash, or use one or more fields in the hash as a counter.</p>
</blockquote>
<table>
<thead>
<tr>
<th align="center">命令</th>
<th align="center">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="center">HDEL key field1 [field2]</td>
<td align="center">删除一个或多个哈希表字段</td>
</tr>
<tr>
<td align="center">HEXISTS key field</td>
<td align="center">查看哈希表 key 中，指定的字段是否存在</td>
</tr>
<tr>
<td align="center">HGET key field</td>
<td align="center">获取存储在哈希表中指定字段的值</td>
</tr>
<tr>
<td align="center">HGETALL key</td>
<td align="center">获取在哈希表中指定 key 的所有字段和值</td>
</tr>
<tr>
<td align="center">HINCRBY key field increment</td>
<td align="center">为哈希表 key 中的指定字段的整数值加上增量 increment</td>
</tr>
<tr>
<td align="center">HINCRBYFLOAT key field increment</td>
<td align="center">为哈希表 key 中的指定字段的浮点数值加上增量 increment</td>
</tr>
<tr>
<td align="center">HKEYS key</td>
<td align="center">获取所有哈希表中的字段</td>
</tr>
<tr>
<td align="center">HLEN key</td>
<td align="center">获取哈希表中字段的数量</td>
</tr>
<tr>
<td align="center">HMGET key field1 [field2]</td>
<td align="center">获取所有给定字段的值</td>
</tr>
<tr>
<td align="center">HMSET key field1 value1 [field2 value2 ]</td>
<td align="center">同时将多个 field-value (域-值)对设置到哈希表 key 中</td>
</tr>
<tr>
<td align="center">HSET key field value</td>
<td align="center">将哈希表 key 中的字段 field 的值设为 value</td>
</tr>
<tr>
<td align="center">HSETNX key field value</td>
<td align="center">只有在字段 field 不存在时，设置哈希表字段的值</td>
</tr>
<tr>
<td align="center">HVALS key</td>
<td align="center">获取哈希表中所有值</td>
</tr>
<tr>
<td align="center">HSCAN key cursor [MATCH pattern] [COUNT count]</td>
<td align="center">迭代哈希表中的键值对，返回的每个元素都是一个元组，每一个元组元素由一个字段(field) 和值（value）组成</td>
</tr>
</tbody></table>
<figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6379</span>&gt; hmset <span class="keyword">user</span> <span class="title">username</span> <span class="string">&quot;Alice&quot;</span> password <span class="string">&quot;12345678&quot;</span> phone <span class="string">&quot;18589702341&quot;</span> age <span class="number">25</span> likes <span class="number">29</span></span><br><span class="line">OK</span><br><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6379</span>&gt; hgetall <span class="keyword">user</span></span><br><span class="line"> <span class="title">1</span>) <span class="string">&quot;username&quot;</span></span><br><span class="line"> <span class="number">2</span>) <span class="string">&quot;Alice&quot;</span></span><br><span class="line"> <span class="number">3</span>) <span class="string">&quot;password&quot;</span></span><br><span class="line"> <span class="number">4</span>) <span class="string">&quot;12345678&quot;</span></span><br><span class="line"> <span class="number">5</span>) <span class="string">&quot;phone&quot;</span></span><br><span class="line"> <span class="number">6</span>) <span class="string">&quot;18589702341&quot;</span></span><br><span class="line"> <span class="number">7</span>) <span class="string">&quot;age&quot;</span></span><br><span class="line"> <span class="number">8</span>) <span class="string">&quot;25&quot;</span></span><br><span class="line"> <span class="number">9</span>) <span class="string">&quot;likes&quot;</span></span><br><span class="line"><span class="number">10</span>) <span class="string">&quot;29&quot;</span></span><br><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6379</span>&gt; hkeys <span class="keyword">user</span></span><br><span class="line"><span class="title">1</span>) <span class="string">&quot;username&quot;</span></span><br><span class="line"><span class="number">2</span>) <span class="string">&quot;password&quot;</span></span><br><span class="line"><span class="number">3</span>) <span class="string">&quot;phone&quot;</span></span><br><span class="line"><span class="number">4</span>) <span class="string">&quot;age&quot;</span></span><br><span class="line"><span class="number">5</span>) <span class="string">&quot;likes&quot;</span></span><br><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6379</span>&gt; hlen <span class="keyword">user</span></span><br><span class="line"><span class="title">(integer</span>) <span class="number">5</span></span><br><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6379</span>&gt; hdel <span class="keyword">user</span> <span class="title">likes</span></span><br><span class="line">(integer) <span class="number">1</span></span><br><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6379</span>&gt; hkeys <span class="keyword">user</span></span><br><span class="line"><span class="title">1</span>) <span class="string">&quot;username&quot;</span></span><br><span class="line"><span class="number">2</span>) <span class="string">&quot;password&quot;</span></span><br><span class="line"><span class="number">3</span>) <span class="string">&quot;phone&quot;</span></span><br><span class="line"><span class="number">4</span>) <span class="string">&quot;age&quot;</span></span><br><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6379</span>&gt; hexists <span class="keyword">user</span> <span class="title">phone</span></span><br><span class="line">(integer) <span class="number">1</span></span><br><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6379</span>&gt; hexists <span class="keyword">user</span> <span class="title">likes</span></span><br><span class="line">(integer) <span class="number">0</span></span><br><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6379</span>&gt; hget <span class="keyword">user</span> <span class="title">username</span></span><br><span class="line"><span class="string">&quot;Alice&quot;</span></span><br><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6379</span>&gt; hincrby <span class="keyword">user</span> <span class="title">age</span> <span class="number">20</span></span><br><span class="line">(integer) <span class="number">45</span></span><br><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6379</span>&gt; hmset <span class="keyword">user</span> <span class="title">weight</span> <span class="number">50.81</span></span><br><span class="line">OK</span><br><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6379</span>&gt; hkeys <span class="keyword">user</span></span><br><span class="line"><span class="title">1</span>) <span class="string">&quot;username&quot;</span></span><br><span class="line"><span class="number">2</span>) <span class="string">&quot;password&quot;</span></span><br><span class="line"><span class="number">3</span>) <span class="string">&quot;phone&quot;</span></span><br><span class="line"><span class="number">4</span>) <span class="string">&quot;age&quot;</span></span><br><span class="line"><span class="number">5</span>) <span class="string">&quot;weight&quot;</span></span><br><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6379</span>&gt; hincrbyfloat <span class="keyword">user</span> <span class="title">weight</span> <span class="number">12.23</span></span><br><span class="line"><span class="string">&quot;63.04&quot;</span></span><br><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6379</span>&gt; hmget <span class="keyword">user</span> <span class="title">username</span> password</span><br><span class="line"><span class="number">1</span>) <span class="string">&quot;Alice&quot;</span></span><br><span class="line"><span class="number">2</span>) <span class="string">&quot;12345678&quot;</span></span><br><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6379</span>&gt; hset <span class="keyword">user</span> <span class="title">username</span> Bob</span><br><span class="line">(integer) <span class="number">0</span></span><br><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6379</span>&gt; hvals <span class="keyword">user</span></span><br><span class="line"><span class="title">1</span>) <span class="string">&quot;Bob&quot;</span></span><br><span class="line"><span class="number">2</span>) <span class="string">&quot;12345678&quot;</span></span><br><span class="line"><span class="number">3</span>) <span class="string">&quot;18589702341&quot;</span></span><br><span class="line"><span class="number">4</span>) <span class="string">&quot;45&quot;</span></span><br><span class="line"><span class="number">5</span>) <span class="string">&quot;63.04&quot;</span></span><br><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6379</span>&gt; hsetnx <span class="keyword">user</span> <span class="title">sex</span> man</span><br><span class="line">(integer) <span class="number">1</span></span><br><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6379</span>&gt; hvals <span class="keyword">user</span></span><br><span class="line"><span class="title">1</span>) <span class="string">&quot;Bob&quot;</span></span><br><span class="line"><span class="number">2</span>) <span class="string">&quot;12345678&quot;</span></span><br><span class="line"><span class="number">3</span>) <span class="string">&quot;18589702341&quot;</span></span><br><span class="line"><span class="number">4</span>) <span class="string">&quot;45&quot;</span></span><br><span class="line"><span class="number">5</span>) <span class="string">&quot;63.04&quot;</span></span><br><span class="line"><span class="number">6</span>) <span class="string">&quot;man&quot;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6379</span>&gt; hscan <span class="keyword">user</span> <span class="title">0</span> MATCH <span class="string">&quot;p*&quot;</span> COUNT <span class="number">1</span></span><br><span class="line"><span class="number">1</span>) <span class="string">&quot;0&quot;</span></span><br><span class="line"><span class="number">2</span>) <span class="number">1</span>) <span class="string">&quot;password&quot;</span></span><br><span class="line">   <span class="number">2</span>) <span class="string">&quot;12345678&quot;</span></span><br><span class="line">   <span class="number">3</span>) <span class="string">&quot;phone&quot;</span></span><br><span class="line">   <span class="number">4</span>) <span class="string">&quot;18589702341&quot;</span></span><br><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6379</span>&gt; object encoding <span class="keyword">user</span></span><br><span class="line"><span class="title">&quot;ziplist</span><span class="string">&quot;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p><a target="_blank" rel="noopener" href="https://redis.io/commands/scan/#the-count-option">COUNT参数</a>失效：</p>
<p>When iterating Sets encoded as intsets (small sets composed of just integers), or Hashes and Sorted Sets encoded as ziplists (small hashes and sets composed of small individual values), usually all the elements are returned in the first <code>SCAN</code> call regardless of the COUNT value.</p>
</blockquote>
<hr>
<h4 id="Zset"><a href="#Zset" class="headerlink" title="Zset"></a>Zset</h4><img src="https://zerostione.github.io/ImageUp//Image/Blog/Redis/p17.png" style="zoom: 80%;" />

<blockquote>
<p>Redis Sorted Sets contain a unique set of members ordered by floating-point scores. As with Sets, you can add, fetch, or remove individual members and perform set operations such as union, intersection, set difference, and compute cardinality. Furthermore, you can also query the set based on score or member value, aggregate, filter, and order results.</p>
</blockquote>
<table>
<thead>
<tr>
<th align="center">命令</th>
<th align="center">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="center">ZADD key score1 member1 [score2 member2]</td>
<td align="center">向有序集合添加一个或多个成员，或者更新已存在成员的分数</td>
</tr>
<tr>
<td align="center">ZCARD key</td>
<td align="center">获取有序集合的成员数</td>
</tr>
<tr>
<td align="center">ZCOUNT key min max</td>
<td align="center">计算在有序集合中指定区间分数的成员数</td>
</tr>
<tr>
<td align="center">ZINCRBY key increment member</td>
<td align="center">有序集合中对指定成员的分数加上增量 increment</td>
</tr>
<tr>
<td align="center">ZINTERSTORE destination numkeys key [key …]</td>
<td align="center">计算给定的一个或多个有序集的交集并将结果集存储在新的有序集合 destination 中，key 的数量必须以 numkeys 参数指定默认情况下，结果集中某个成员的分数值是所有给定集下该成员分数值之和。</td>
</tr>
<tr>
<td align="center">ZLEXCOUNT key min max</td>
<td align="center">在有序集合中计算指定字典区间内成员数量，min:有序集合中分数排名较小的成员，max:在有序集合中分数排名较大的成员，成员名称前需要加<code>[</code>符号作为开头, <code>[</code>符号与成员之间不能有空格，可以使用 <code>-</code> 和 <code>+</code> 表示得分最小值和最大值，<code>min</code> 和 <code>max</code> 不能反, <code>max</code> 放前面 <code>min</code>放后面会导致返回结果为0，计算成员之间的成员数量时,参数 <code>min</code> 和 <code>max</code> 的位置也计算在内。</td>
</tr>
<tr>
<td align="center">ZRANGE key start stop [WITHSCORES]</td>
<td align="center">通过索引区间返回有序集合指定区间内的成员</td>
</tr>
<tr>
<td align="center">ZRANGEBYLEX key min max [LIMIT offset count]</td>
<td align="center">返回给定的有序集合键 <code>key</code> 中， 值介于 <code>min</code> 和 <code>max</code> 之间的成员。如果有序集合里面的成员带有不同的分值， 那么命令返回的结果是未指定的（unspecified）。<code>LIMIT offset count</code> 参数用于获取指定范围内的匹配元素。offset:返回结果起始位置</td>
</tr>
<tr>
<td align="center">ZRANGEBYSCORE key min max [WITHSCORES] [LIMIT]</td>
<td align="center">通过分数返回有序集合指定区间内的成员，<code>max</code> 和 <code>min</code>参数前可以加 <code>( </code> 符号作为开头表示小于, <code>(</code> 符号与成员之间不能有空格，可以使用 <code>+inf</code> 和 <code>-inf</code> 表示得分最大值和最小值，<code>max</code> 和 <code>min</code> 不能反, <code>max</code> 放后面 <code>min</code>放前面会导致返回结果为空，计算成员之间的成员数量不加 <code>(</code> 符号时,参数 <code>min</code> 和 <code>max</code> 的位置也计算在内。</td>
</tr>
<tr>
<td align="center">ZRANK key member</td>
<td align="center">返回有序集合中指定成员的索引</td>
</tr>
<tr>
<td align="center">ZREM key member [member …]</td>
<td align="center">移除有序集合中的一个或多个成员</td>
</tr>
<tr>
<td align="center">ZREMRANGEBYLEX key min max</td>
<td align="center">移除有序集合中给定的字典区间的所有成员</td>
</tr>
<tr>
<td align="center">ZREMRANGEBYRANK key start stop</td>
<td align="center">移除有序集合中给定的排名区间的所有成员</td>
</tr>
<tr>
<td align="center">ZREMRANGEBYSCORE key min max</td>
<td align="center">移除有序集合中给定的分数区间的所有成员</td>
</tr>
<tr>
<td align="center">ZREVRANGE key start stop [WITHSCORES]</td>
<td align="center">返回有序集中指定区间内的成员，通过索引，分数从高到低</td>
</tr>
<tr>
<td align="center">ZREVRANGEBYSCORE key max min [WITHSCORES]</td>
<td align="center">返回有序集中指定分数区间内的成员，分数从高到低排序</td>
</tr>
<tr>
<td align="center">ZREVRANK key member</td>
<td align="center">返回有序集合中指定成员的排名，有序集成员按分数值递减(从大到小)排序</td>
</tr>
<tr>
<td align="center">ZSCORE key member</td>
<td align="center">返回有序集中，成员的分数值</td>
</tr>
<tr>
<td align="center">ZUNIONSTORE destination numkeys key [key …]</td>
<td align="center">计算给定的一个或多个有序集的并集，并存储在新的 key 中</td>
</tr>
<tr>
<td align="center">ZSCAN key cursor [MATCH pattern] [COUNT count]</td>
<td align="center">迭代有序集合中的元素（包括元素成员和元素分值）</td>
</tr>
</tbody></table>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">127.0.0.1:6379&gt;</span> zadd database <span class="number">1</span> Oracle</span><br><span class="line">(integer) <span class="number">1</span></span><br><span class="line"><span class="meta">127.0.0.1:6379&gt;</span> zadd database <span class="number">2</span> MySQL</span><br><span class="line">(integer) <span class="number">1</span></span><br><span class="line"><span class="meta">127.0.0.1:6379&gt;</span> zadd database <span class="number">3</span> MongoDB</span><br><span class="line">(integer) <span class="number">1</span></span><br><span class="line"><span class="meta">127.0.0.1:6379&gt;</span> zadd database <span class="number">3</span> <span class="string">&quot;MS SQL Server&quot;</span></span><br><span class="line">(integer) <span class="number">1</span></span><br><span class="line"><span class="meta">127.0.0.1:6379&gt;</span> zadd database <span class="number">4</span> MySQL</span><br><span class="line">(integer) <span class="number">0</span></span><br><span class="line"><span class="meta">127.0.0.1:6379&gt;</span> zcard database</span><br><span class="line">(integer) <span class="number">4</span></span><br><span class="line"><span class="meta">127.0.0.1:6379&gt;</span> zcount database <span class="number">1</span> <span class="number">3</span></span><br><span class="line">(integer) <span class="number">3</span></span><br><span class="line"><span class="meta">127.0.0.1:6379&gt;</span> zincrby database <span class="number">8</span> Oracle</span><br><span class="line"><span class="string">&quot;9&quot;</span></span><br><span class="line"><span class="meta">127.0.0.1:6379&gt;</span> zcount database <span class="number">1</span> <span class="number">3</span></span><br><span class="line">(integer) <span class="number">2</span></span><br><span class="line"><span class="meta">127.0.0.1:6379&gt;</span> zadd udb <span class="number">3</span> MongoDB <span class="number">4</span> <span class="string">&quot;MS SQL Server&quot;</span></span><br><span class="line">(integer) <span class="number">2</span></span><br><span class="line"><span class="meta">127.0.0.1:6379&gt;</span> zinterstore db <span class="number">2</span> database udb</span><br><span class="line">(integer) <span class="number">2</span></span><br><span class="line"><span class="meta">127.0.0.1:6379&gt;</span> zrange db <span class="number">0</span> -<span class="number">1</span> WITHSCORES</span><br><span class="line"><span class="number">1</span>) <span class="string">&quot;MongoDB&quot;</span></span><br><span class="line"><span class="number">2</span>) <span class="string">&quot;6&quot;</span></span><br><span class="line"><span class="number">3</span>) <span class="string">&quot;MS SQL Server&quot;</span></span><br><span class="line"><span class="number">4</span>) <span class="string">&quot;7&quot;</span></span><br><span class="line"><span class="meta">127.0.0.1:6379&gt;</span> zlexcount database - +</span><br><span class="line">(integer) <span class="number">4</span></span><br><span class="line"><span class="meta">127.0.0.1:6379&gt;</span> zlexcount database [MongoDB [MySQL</span><br><span class="line">(integer) <span class="number">2</span></span><br><span class="line"><span class="meta">127.0.0.1:6379&gt;</span> zlexcount database [<span class="string">&quot;MS SQL Server&quot;</span> [MySQL</span><br><span class="line">(integer) <span class="number">3</span></span><br><span class="line"><span class="meta">127.0.0.1:6379&gt;</span> zadd database  <span class="number">6</span> memcached</span><br><span class="line">(integer) <span class="number">1</span></span><br><span class="line"><span class="meta">127.0.0.1:6379&gt;</span> zrange database <span class="number">0</span> -<span class="number">1</span> WITHSCORES</span><br><span class="line"> <span class="number">1</span>) <span class="string">&quot;MS SQL Server&quot;</span></span><br><span class="line"> <span class="number">2</span>) <span class="string">&quot;3&quot;</span></span><br><span class="line"> <span class="number">3</span>) <span class="string">&quot;MongoDB&quot;</span></span><br><span class="line"> <span class="number">4</span>) <span class="string">&quot;3&quot;</span></span><br><span class="line"> <span class="number">5</span>) <span class="string">&quot;MySQL&quot;</span></span><br><span class="line"> <span class="number">6</span>) <span class="string">&quot;4&quot;</span></span><br><span class="line"> <span class="number">7</span>) <span class="string">&quot;memcached&quot;</span></span><br><span class="line"> <span class="number">8</span>) <span class="string">&quot;6&quot;</span></span><br><span class="line"> <span class="number">9</span>) <span class="string">&quot;Oracle&quot;</span></span><br><span class="line"><span class="number">10</span>) <span class="string">&quot;9&quot;</span></span><br><span class="line"><span class="meta">127.0.0.1:6379&gt;</span> zrange database <span class="number">0</span> <span class="number">2</span> WITHSCORES</span><br><span class="line"><span class="number">1</span>) <span class="string">&quot;MS SQL Server&quot;</span></span><br><span class="line"><span class="number">2</span>) <span class="string">&quot;3&quot;</span></span><br><span class="line"><span class="number">3</span>) <span class="string">&quot;MongoDB&quot;</span></span><br><span class="line"><span class="number">4</span>) <span class="string">&quot;3&quot;</span></span><br><span class="line"><span class="number">5</span>) <span class="string">&quot;MySQL&quot;</span></span><br><span class="line"><span class="number">6</span>) <span class="string">&quot;4&quot;</span></span><br><span class="line"><span class="meta">127.0.0.1:6379&gt;</span> zrangebyscore database <span class="number">3</span> <span class="number">4</span>  </span><br><span class="line"><span class="number">1</span>) <span class="string">&quot;MS SQL Server&quot;</span></span><br><span class="line"><span class="number">2</span>) <span class="string">&quot;MongoDB&quot;</span></span><br><span class="line"><span class="number">3</span>) <span class="string">&quot;MySQL&quot;</span></span><br><span class="line"><span class="meta">127.0.0.1:6379&gt;</span> zrangebyscore database <span class="number">3</span> (<span class="number">4</span>  </span><br><span class="line"><span class="number">1</span>) <span class="string">&quot;MS SQL Server&quot;</span></span><br><span class="line"><span class="number">2</span>) <span class="string">&quot;MongoDB&quot;</span></span><br><span class="line"><span class="meta">127.0.0.1:6379&gt;</span> zrangebyscore database <span class="number">3</span> <span class="number">4</span> WITHSCORES  </span><br><span class="line"><span class="number">1</span>) <span class="string">&quot;MS SQL Server&quot;</span></span><br><span class="line"><span class="number">2</span>) <span class="string">&quot;3&quot;</span></span><br><span class="line"><span class="number">3</span>) <span class="string">&quot;MongoDB&quot;</span></span><br><span class="line"><span class="number">4</span>) <span class="string">&quot;3&quot;</span></span><br><span class="line"><span class="number">5</span>) <span class="string">&quot;MySQL&quot;</span></span><br><span class="line"><span class="number">6</span>) <span class="string">&quot;4&quot;</span></span><br><span class="line"><span class="meta">127.0.0.1:6379&gt;</span> zrangebyscore database <span class="number">3</span> <span class="number">4</span> LIMIT <span class="number">1</span> <span class="number">2</span></span><br><span class="line"><span class="number">1</span>) <span class="string">&quot;MongoDB&quot;</span></span><br><span class="line"><span class="number">2</span>) <span class="string">&quot;MySQL&quot;</span></span><br><span class="line"><span class="meta">127.0.0.1:6379&gt;</span> zrank database MySQL</span><br><span class="line">(integer) <span class="number">2</span></span><br><span class="line"><span class="meta">127.0.0.1:6379&gt;</span> zrem database Oracle</span><br><span class="line">(integer) <span class="number">1</span></span><br><span class="line"><span class="meta">127.0.0.1:6379&gt;</span> zrange database <span class="number">0</span> -<span class="number">1</span></span><br><span class="line"><span class="number">1</span>) <span class="string">&quot;MS SQL Server&quot;</span></span><br><span class="line"><span class="number">2</span>) <span class="string">&quot;MongoDB&quot;</span></span><br><span class="line"><span class="number">3</span>) <span class="string">&quot;MySQL&quot;</span></span><br><span class="line"><span class="number">4</span>) <span class="string">&quot;memcached&quot;</span></span><br><span class="line"><span class="meta">127.0.0.1:6379&gt;</span> zremrangebyscore database <span class="number">3</span> <span class="number">4</span></span><br><span class="line">(integer) <span class="number">3</span></span><br><span class="line"><span class="meta">127.0.0.1:6379&gt;</span> zrange database <span class="number">0</span> -<span class="number">1</span></span><br><span class="line"><span class="number">1</span>) <span class="string">&quot;memcached&quot;</span></span><br><span class="line"><span class="meta">127.0.0.1:6379&gt;</span> zadd database <span class="number">1</span> MySQL <span class="number">2</span> Oracle <span class="number">3</span> Redis <span class="number">4</span> MongoDB</span><br><span class="line">(integer) <span class="number">4</span></span><br><span class="line"><span class="meta">127.0.0.1:6379&gt;</span> zrevrange database <span class="number">0</span> <span class="number">4</span></span><br><span class="line"><span class="number">1</span>) <span class="string">&quot;memcached&quot;</span></span><br><span class="line"><span class="number">2</span>) <span class="string">&quot;MongoDB&quot;</span></span><br><span class="line"><span class="number">3</span>) <span class="string">&quot;Redis&quot;</span></span><br><span class="line"><span class="number">4</span>) <span class="string">&quot;Oracle&quot;</span></span><br><span class="line"><span class="number">5</span>) <span class="string">&quot;MySQL&quot;</span></span><br><span class="line"><span class="meta">127.0.0.1:6379&gt;</span> zrevrangebyscore database <span class="number">4</span> <span class="number">1</span> WITHSCORES</span><br><span class="line"><span class="number">1</span>) <span class="string">&quot;MongoDB&quot;</span></span><br><span class="line"><span class="number">2</span>) <span class="string">&quot;4&quot;</span></span><br><span class="line"><span class="number">3</span>) <span class="string">&quot;Redis&quot;</span></span><br><span class="line"><span class="number">4</span>) <span class="string">&quot;3&quot;</span></span><br><span class="line"><span class="number">5</span>) <span class="string">&quot;Oracle&quot;</span></span><br><span class="line"><span class="number">6</span>) <span class="string">&quot;2&quot;</span></span><br><span class="line"><span class="number">7</span>) <span class="string">&quot;MySQL&quot;</span></span><br><span class="line"><span class="number">8</span>) <span class="string">&quot;1&quot;</span></span><br><span class="line"><span class="meta">127.0.0.1:6379&gt;</span> zrevrank database Redis</span><br><span class="line">(integer) <span class="number">2</span></span><br><span class="line"><span class="meta">127.0.0.1:6379&gt;</span> zscore database Redis</span><br><span class="line"><span class="string">&quot;3&quot;</span></span><br><span class="line"><span class="meta">127.0.0.1:6379&gt;</span> zunionstore dbzset <span class="number">2</span> database myzset</span><br><span class="line">(integer) <span class="number">7</span></span><br><span class="line"><span class="meta">127.0.0.1:6379&gt;</span> zrange dbzset <span class="number">0</span> -<span class="number">1</span></span><br><span class="line"><span class="number">1</span>) <span class="string">&quot;f&quot;</span></span><br><span class="line"><span class="number">2</span>) <span class="string">&quot;g&quot;</span></span><br><span class="line"><span class="number">3</span>) <span class="string">&quot;MySQL&quot;</span></span><br><span class="line"><span class="number">4</span>) <span class="string">&quot;Oracle&quot;</span></span><br><span class="line"><span class="number">5</span>) <span class="string">&quot;Redis&quot;</span></span><br><span class="line"><span class="number">6</span>) <span class="string">&quot;MongoDB&quot;</span></span><br><span class="line"><span class="number">7</span>) <span class="string">&quot;memcached&quot;</span></span><br><span class="line"><span class="meta">127.0.0.1:6379&gt;</span> zscan dbzset <span class="number">0</span> MATCH M*</span><br><span class="line"><span class="number">1</span>) <span class="string">&quot;0&quot;</span></span><br><span class="line"><span class="number">2</span>) <span class="number">1</span>) <span class="string">&quot;MySQL&quot;</span></span><br><span class="line">   <span class="number">2</span>) <span class="string">&quot;1&quot;</span></span><br><span class="line">   <span class="number">3</span>) <span class="string">&quot;MongoDB&quot;</span></span><br><span class="line">   <span class="number">4</span>) <span class="string">&quot;4&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">127.0.0.1:6379&gt;</span> ZADD myzset <span class="number">0</span> a <span class="number">0</span> b <span class="number">0</span> c <span class="number">0</span> d <span class="number">0</span> e <span class="number">0</span> f <span class="number">0</span> g</span><br><span class="line">(integer) <span class="number">7</span></span><br><span class="line"><span class="meta">127.0.0.1:6379&gt;</span> ZRANGEBYLEX myzset - +</span><br><span class="line"><span class="number">1</span>) <span class="string">&quot;a&quot;</span></span><br><span class="line"><span class="number">2</span>) <span class="string">&quot;b&quot;</span></span><br><span class="line"><span class="number">3</span>) <span class="string">&quot;c&quot;</span></span><br><span class="line"><span class="number">4</span>) <span class="string">&quot;d&quot;</span></span><br><span class="line"><span class="number">5</span>) <span class="string">&quot;e&quot;</span></span><br><span class="line"><span class="number">6</span>) <span class="string">&quot;f&quot;</span></span><br><span class="line"><span class="number">7</span>) <span class="string">&quot;g&quot;</span></span><br><span class="line"><span class="meta">127.0.0.1:6379&gt;</span> ZRANGEBYLEX myzset - (g</span><br><span class="line"><span class="number">1</span>) <span class="string">&quot;a&quot;</span></span><br><span class="line"><span class="number">2</span>) <span class="string">&quot;b&quot;</span></span><br><span class="line"><span class="number">3</span>) <span class="string">&quot;c&quot;</span></span><br><span class="line"><span class="number">4</span>) <span class="string">&quot;d&quot;</span></span><br><span class="line"><span class="number">5</span>) <span class="string">&quot;e&quot;</span></span><br><span class="line"><span class="number">6</span>) <span class="string">&quot;f&quot;</span></span><br><span class="line"><span class="meta">127.0.0.1:6379&gt;</span> ZRANGEBYLEX myzset [c (g</span><br><span class="line"><span class="number">1</span>) <span class="string">&quot;c&quot;</span></span><br><span class="line"><span class="number">2</span>) <span class="string">&quot;d&quot;</span></span><br><span class="line"><span class="number">3</span>) <span class="string">&quot;e&quot;</span></span><br><span class="line"><span class="number">4</span>) <span class="string">&quot;f&quot;</span></span><br><span class="line"><span class="meta">127.0.0.1:6379&gt;</span> ZRANGEBYLEX myzset (c (g</span><br><span class="line"><span class="number">1</span>) <span class="string">&quot;d&quot;</span></span><br><span class="line"><span class="number">2</span>) <span class="string">&quot;e&quot;</span></span><br><span class="line"><span class="number">3</span>) <span class="string">&quot;f&quot;</span></span><br><span class="line"><span class="meta">127.0.0.1:6379&gt;</span> ZRANGEBYLEX myzset - + LIMIT <span class="number">0</span> <span class="number">4</span></span><br><span class="line"><span class="number">1</span>) <span class="string">&quot;a&quot;</span></span><br><span class="line"><span class="number">2</span>) <span class="string">&quot;b&quot;</span></span><br><span class="line"><span class="number">3</span>) <span class="string">&quot;c&quot;</span></span><br><span class="line"><span class="number">4</span>) <span class="string">&quot;d&quot;</span></span><br><span class="line"><span class="meta">127.0.0.1:6379&gt;</span> ZRANGEBYLEX myzset - + LIMIT <span class="number">2</span> <span class="number">4</span></span><br><span class="line"><span class="number">1</span>) <span class="string">&quot;c&quot;</span></span><br><span class="line"><span class="number">2</span>) <span class="string">&quot;d&quot;</span></span><br><span class="line"><span class="number">3</span>) <span class="string">&quot;e&quot;</span></span><br><span class="line"><span class="number">4</span>) <span class="string">&quot;f&quot;</span></span><br><span class="line"><span class="meta">127.0.0.1:6379&gt;</span> zremrangebylex myset (a (d</span><br><span class="line">(integer) <span class="number">0</span></span><br><span class="line"><span class="meta">127.0.0.1:6379&gt;</span> zrange myset <span class="number">0</span> -<span class="number">1</span></span><br><span class="line">(empty array)</span><br><span class="line"><span class="meta">127.0.0.1:6379&gt;</span> zremrangebylex myzset (a (d</span><br><span class="line">(integer) <span class="number">2</span></span><br><span class="line"><span class="meta">127.0.0.1:6379&gt;</span> zrange myzset <span class="number">0</span> -<span class="number">1</span></span><br><span class="line"><span class="number">1</span>) <span class="string">&quot;a&quot;</span></span><br><span class="line"><span class="number">2</span>) <span class="string">&quot;d&quot;</span></span><br><span class="line"><span class="number">3</span>) <span class="string">&quot;e&quot;</span></span><br><span class="line"><span class="number">4</span>) <span class="string">&quot;f&quot;</span></span><br><span class="line"><span class="number">5</span>) <span class="string">&quot;g&quot;</span></span><br><span class="line"><span class="meta">127.0.0.1:6379&gt;</span> zremrangebyrank myzset <span class="number">0</span> <span class="number">2</span></span><br><span class="line">(integer) <span class="number">3</span></span><br><span class="line"><span class="meta">127.0.0.1:6379&gt;</span> zrange myzset <span class="number">0</span> -<span class="number">1</span></span><br><span class="line"><span class="number">1</span>) <span class="string">&quot;f&quot;</span></span><br><span class="line"><span class="number">2</span>) <span class="string">&quot;g&quot;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>1.有序集合的所有成员都具有相同的分值时， 有序集合的元素会根据成员的字典序（lexicographical ordering）来进行排序。</p>
<p><code>min</code> 和 <code>max</code> 参数必须包含 <code>(</code> 或者 <code>[</code> ， 其中 <code>(</code> 表示开区间（指定的值不会被包含在范围之内）， 而 <code>[</code> 则表示闭区间（指定的值会被包含在范围之内）。特殊值 <code>+</code> 和 <code>-</code> 在 <code>min</code> 参数以及 <code>max</code> 参数中具有特殊的意义， 其中 <code>+</code> 表示正无限， 而 <code>-</code> 表示负无限。 因此， 向一个所有成员的分值都相同的有序集合发送命令 <code>ZRANGEBYLEX &lt;zset&gt; - +</code> ， 命令将返回有序集合中的所有元素。</p>
</blockquote>
<hr>
<hr>
<p>BitMap</p>
<blockquote>
<p>可以将 Redis 中的 BitMap 想象为以 Bit 为单位的组，数组的每个单位只能存储0和1，数组的下标在BitMaps 中叫做偏移量，这样做的优势是节省大量内存空间，BitMap 底层是基于 Redis 的字符串类型实现的。</p>
</blockquote>
<img src="https://zerostione.github.io/ImageUp//Image/Blog/Redis/p18.png" style="zoom: 80%;" />

<blockquote>
<p>Redis Bitmaps is a compact data structure to store binary logic and states. It provides commands to fetch and set a bit value at a given position, and perform AND, OR, XOR, and NOT operations between multiple bitmap keys.</p>
</blockquote>
<table>
<thead>
<tr>
<th align="center">命令</th>
<th align="center">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="center">SETBIT key offset value</td>
<td align="center">对 key 字符串设置或清除指定偏移量上的位(bit)。位的设置或清除取决于 value 参数，可以是 0 或1 。当 key 不存在时，自动生成一个新的字符串值。字符串会进行伸展(grown)以确保它可以将 value 保存在指定的偏移量上。当字符串值进行伸展时，空白位置以 0 填充。offset 参数必须大于或等于 0 ，小于 <code>2^32</code>。</td>
</tr>
<tr>
<td align="center">GETBIT key offset</td>
<td align="center">对 key 字符串获取指定偏移量上的位(bit)。当 offset 比字符串值的长度大，或者 key 不存在时，返回 0 。</td>
</tr>
<tr>
<td align="center">BITCOUNT key [ start] [end]</td>
<td align="center">key字符串中被设置为 1 的比特位的数量。一般情况下，给定的整个字符串都会被进行计数，通过指定额外的 start 或 end 参数，可以让计数只在指定的字节或者位（默认为位）进行。不存在的 key 被当成是空字符串来处理，即一个不存在的 key 进行 BITCOUNT 结果为 0 。</td>
</tr>
<tr>
<td align="center">BITFIELD key [GET encoding offset] [SET encoding offset value] [INCRBY encoding offset increment] [OVERFLOW WRAP | SAT | FAIL]</td>
<td align="center"><code>BITFIELD</code>将一个 Redis 字符串视为一个由二进制位组成的数组， 并对这个数组中储存的长度不同的整数进行访问 （被储存的整数无需进行对齐）</td>
</tr>
<tr>
<td align="center">BITOP operation destkey key [key …]</td>
<td align="center">对一个或多个保存二进制位的字符串 <code>key</code> 进行位元操作，并将结果保存到 <code>destkey</code> 上</td>
</tr>
<tr>
<td align="center">BITPOS key bit [start] [end]</td>
<td align="center">返回位图中第一个值为 <code>bit</code> 的二进制位的位置start和end参数以Byte为单位。</td>
</tr>
<tr>
<td align="center">BITFIELD_RO key GET encoding offset</td>
<td align="center">BITFIELD 命令的只读变体。 类似于原始的 BITFIELD，但只接受 GET 子命令，可以安全地用于只读副本。</td>
</tr>
</tbody></table>
<figure class="highlight accesslog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">127.0.0.1:6379</span>&gt; setbit bit <span class="number">2</span> <span class="number">1</span></span><br><span class="line">(integer) <span class="number">0</span></span><br><span class="line"><span class="number">127.0.0.1:6379</span>&gt; getbit bit <span class="number">2</span></span><br><span class="line">(integer) <span class="number">1</span></span><br><span class="line"><span class="number">127.0.0.1:6379</span>&gt; getbit bit <span class="number">1</span></span><br><span class="line">(integer) <span class="number">0</span></span><br><span class="line"><span class="number">127.0.0.1:6379</span>&gt; getbit bit <span class="number">5</span></span><br><span class="line">(integer) <span class="number">0</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="number">127.0.0.1:6379</span>&gt; setbit bit <span class="number">4</span> <span class="number">1</span></span><br><span class="line">(integer) <span class="number">0</span></span><br><span class="line"><span class="number">127.0.0.1:6379</span>&gt; setbit bit <span class="number">8</span> <span class="number">1</span></span><br><span class="line">(integer) <span class="number">0</span></span><br><span class="line"><span class="number">127.0.0.1:6379</span>&gt; bitcount bit</span><br><span class="line">(integer) <span class="number">2</span></span><br><span class="line"><span class="number">127.0.0.1:6379</span>&gt; bitcount bit <span class="number">0</span> <span class="number">0</span></span><br><span class="line">(integer) <span class="number">1</span></span><br><span class="line"><span class="number">127.0.0.1:6379</span>&gt; bitcount bit <span class="number">0</span> <span class="number">1</span></span><br><span class="line">(integer) <span class="number">2</span></span><br><span class="line"></span><br><span class="line"><span class="number">127.0.0.1:6379</span>&gt; setbit mybits <span class="number">9</span> <span class="number">1</span></span><br><span class="line">(integer) <span class="number">0</span></span><br><span class="line"><span class="number">127.0.0.1:6379</span>&gt; bitpos mybits <span class="number">1</span></span><br><span class="line">(integer) <span class="number">9</span></span><br><span class="line"><span class="number">127.0.0.1:6379</span>&gt; bitpos mybits <span class="number">0</span></span><br><span class="line">(integer) <span class="number">0</span></span><br><span class="line"><span class="number">127.0.0.1:6379</span>&gt; bitpos mybits <span class="number">1</span> <span class="number">0</span> <span class="number">0</span> </span><br><span class="line">(integer) -<span class="number">1</span></span><br><span class="line"><span class="number">127.0.0.1:6379</span>&gt; bitpos mybits <span class="number">1</span> <span class="number">0</span> <span class="number">1</span></span><br><span class="line">(integer) <span class="number">9</span></span><br><span class="line"></span><br><span class="line"><span class="number">127.0.0.1:6379</span>&gt; setbit bits:<span class="number">1</span> <span class="number">0</span> <span class="number">1</span></span><br><span class="line">(integer) <span class="number">0</span></span><br><span class="line"><span class="number">127.0.0.1:6379</span>&gt; setbit bits:<span class="number">1</span> <span class="number">3</span> <span class="number">1</span></span><br><span class="line">(integer) <span class="number">0</span></span><br><span class="line"><span class="number">127.0.0.1:6379</span>&gt; setbit bits:<span class="number">2</span> <span class="number">1</span> <span class="number">1</span></span><br><span class="line">(integer) <span class="number">0</span></span><br><span class="line"><span class="number">127.0.0.1:6379</span>&gt; setbit bits:<span class="number">2</span> <span class="number">2</span> <span class="number">1</span></span><br><span class="line">(integer) <span class="number">0</span></span><br><span class="line"><span class="number">127.0.0.1:6379</span>&gt;  bitop OR or-result bits:<span class="number">1</span> bits:<span class="number">2</span></span><br><span class="line">(integer) <span class="number">1</span></span><br><span class="line"><span class="number">127.0.0.1:6379</span>&gt; getbit or-result <span class="number">0</span></span><br><span class="line">(integer) <span class="number">1</span></span><br><span class="line"><span class="number">127.0.0.1:6379</span>&gt; getbit or-result <span class="number">1</span></span><br><span class="line">(integer) <span class="number">1</span></span><br><span class="line"><span class="number">127.0.0.1:6379</span>&gt; getbit or-result <span class="number">2</span></span><br><span class="line">(integer) <span class="number">1</span></span><br><span class="line"><span class="number">127.0.0.1:6379</span>&gt; getbit or-result <span class="number">3</span></span><br><span class="line">(integer) <span class="number">1</span></span><br><span class="line"><span class="number">127.0.0.1:6379</span>&gt; getbit or-result <span class="number">4</span></span><br><span class="line">(integer) <span class="number">0</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>1.SETBIT操作中使用大的<code>offset</code>，内存分配可能造成 Redis 服务器被阻塞。</p>
<p>2.Redis7.0.0添加 <code>BYTE|BIT</code> 参数。</p>
<p>3.<code>operation</code> 可以是 <code>AND</code> 、 <code>OR</code> 、 <code>NOT</code> 、 <code>XOR</code> 这四种操作中的任意一种：</p>
<ul>
<li><p><code>BITOP AND destkey key [key ...]</code> ，对一个或多个 <code>key</code> 求逻辑并，并将结果保存到 <code>destkey</code> </p>
</li>
<li><p><code>BITOP OR destkey key [key ...]</code> ，对一个或多个 <code>key</code> 求逻辑或，并将结果保存到 <code>destkey</code> </p>
</li>
<li><p><code>BITOP XOR destkey key [key ...]</code> ，对一个或多个 <code>key</code> 求逻辑异或，并将结果保存到 <code>destkey</code> </p>
</li>
<li><p><code>BITOP NOT destkey key</code> ，对给定 <code>key</code> 求逻辑非，并将结果保存到 <code>destkey</code> </p>
</li>
</ul>
<p>除了 <code>NOT</code> 操作之外，其他操作都可以接受一个或多个 <code>key</code> 作为输入。</p>
<p>当 BITOP处理不同长度的字符串时，较短的那个字符串所缺少的部分会被看作 <code>0</code> 。</p>
</blockquote>
<hr>
<p>Hyperloglog</p>
<blockquote>
<p>1.Redis HyperLogLog 是用来做基数统计的算法。</p>
<p>2.数据集 {1, 3, 5, 7, 5, 7, 8}， 那么这个数据集的基数集为 {1, 3, 5 ,7, 8}, 基数(不重复元素)为5。 基数估计就是在误差可接受的范围内，快速计算基数。</p>
</blockquote>
<img src="https://zerostione.github.io/ImageUp//Image/Blog/Redis/p19.png" style="zoom: 80%;" />

<blockquote>
<p>Redis HyperLogLog is a probabilistic data structure used to count unique values (set cardinality) at a constant memory size. You can add and count a large number of unique items with memory efficiency, and merge two or more HyperLogLog data structures into one.</p>
</blockquote>
<table>
<thead>
<tr>
<th align="center">命令</th>
<th align="center">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="center">PFADD key element [element …]</td>
<td align="center">添加指定元素到 HyperLogLog 中</td>
</tr>
<tr>
<td align="center">PFCOUNT key [key …]</td>
<td align="center">返回给定 HyperLogLog 的基数估算值</td>
</tr>
<tr>
<td align="center">PFMERGE destkey sourcekey [sourcekey …]</td>
<td align="center">将多个 HyperLogLog 合并为一个 HyperLogLog</td>
</tr>
</tbody></table>
<figure class="highlight accesslog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">127.0.0.1:6379</span>&gt; pfadd TechStack SpringBoot</span><br><span class="line">(integer) <span class="number">1</span></span><br><span class="line"><span class="number">127.0.0.1:6379</span>&gt; pfadd TechStack SpringMVC</span><br><span class="line">(integer) <span class="number">1</span></span><br><span class="line"><span class="number">127.0.0.1:6379</span>&gt; pfadd TechStack MyBatis</span><br><span class="line">(integer) <span class="number">1</span></span><br><span class="line"><span class="number">127.0.0.1:6379</span>&gt; pfadd TechStack Nginx</span><br><span class="line">(integer) <span class="number">1</span></span><br><span class="line"><span class="number">127.0.0.1:6379</span>&gt; pfadd TechStack Redis</span><br><span class="line">(integer) <span class="number">1</span></span><br><span class="line"><span class="number">127.0.0.1:6379</span>&gt; pfadd TechStack MySQL</span><br><span class="line">(integer) <span class="number">1</span></span><br><span class="line"><span class="number">127.0.0.1:6379</span>&gt; pfcount TechStack</span><br><span class="line">(integer) <span class="number">6</span></span><br><span class="line"><span class="number">127.0.0.1:6379</span>&gt; pfadd NewTechStack MongoDB</span><br><span class="line">(integer) <span class="number">1</span></span><br><span class="line"><span class="number">127.0.0.1:6379</span>&gt; pfadd NewTechStack Docker</span><br><span class="line">(integer) <span class="number">1</span></span><br><span class="line"><span class="number">127.0.0.1:6379</span>&gt; pfmerge tes TechStack NewTechStack</span><br><span class="line">OK</span><br><span class="line"><span class="number">127.0.0.1:6379</span>&gt; pfcount tes</span><br><span class="line">(integer) <span class="number">8</span></span><br></pre></td></tr></table></figure>

<hr>
<p>Geospatial index</p>
<img src="https://zerostione.github.io/ImageUp//Image/Blog/Redis/p20.png" style="zoom: 80%;" />

<blockquote>
<p>Geospatial indexes provide an extremely efficient and simple way to manage and use geospatial data in Redis. You can add unique items with latitude and longitude, compute the distance between objects, and find members within a given radius range from a location.</p>
</blockquote>
<table>
<thead>
<tr>
<th align="center">命令</th>
<th align="center">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="center">GEOADD key longitude latitude member [longitude latitude member …]</td>
<td align="center">将给定的空间元素（纬度、经度、名字）添加到指定的键里面。这些数据会以有序集合的形式被储存在键里面， GEOADD 命令以标准的 x,y 格式接受参数， 即必须先输入经度再输入纬度</td>
</tr>
<tr>
<td align="center">GEOPOS key member [member …]</td>
<td align="center">从键里面返回所有给定位置元素的位置（经度和纬度）</td>
</tr>
<tr>
<td align="center">GEODIST key member1 member2 [unit]</td>
<td align="center">返回两个给定位置之间的距离。如果两个位置之间的其中一个不存在，返回空值</td>
</tr>
<tr>
<td align="center">GEORADIUS key longitude latitude radius m|km|ft|mi [WITHCOORD] [WITHDIST] [WITHHASH] [ASC|DESC] [COUNT count]</td>
<td align="center">以给定的经纬度为中心， 返回键包含的位置元素当中， 与中心的距离不超过给定最大距离的所有位置元素</td>
</tr>
<tr>
<td align="center">GEORADIUSBYMEMBER key member radius m|km|ft|mi [WITHCOORD] [WITHDIST] [WITHHASH] [ASC|DESC] [COUNT count]</td>
<td align="center">找出位于指定范围内的元素， 中心点是给定的位置元素</td>
</tr>
<tr>
<td align="center">GEOHASH key member [member …]</td>
<td align="center">返回一个或多个位置元素的 Geohash 表示。</td>
</tr>
</tbody></table>
<figure class="highlight accesslog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">127.0.0.1:6379</span>&gt; GEOADD Sicily <span class="number">13</span>.<span class="number">361389</span> <span class="number">38</span>.<span class="number">115556</span> <span class="string">&quot;Palermo&quot;</span> <span class="number">15</span>.<span class="number">087269</span> <span class="number">37</span>.<span class="number">502669</span> <span class="string">&quot;Catania&quot;</span></span><br><span class="line">(integer) <span class="number">2</span></span><br><span class="line"><span class="number">127.0.0.1:6379</span>&gt; GEODIST Sicily Palermo Catania</span><br><span class="line"><span class="string">&quot;166274.1516&quot;</span></span><br><span class="line"><span class="number">127.0.0.1:6379</span>&gt; GEOPOS Sicily Palermo</span><br><span class="line"><span class="number">1</span>) <span class="number">1</span>) <span class="string">&quot;13.36138933897018433&quot;</span></span><br><span class="line">   <span class="number">2</span>) <span class="string">&quot;38.11555639549629859&quot;</span></span><br><span class="line"><span class="number">127.0.0.1:6379</span>&gt; GEOPOS Sicily Palermo Catania</span><br><span class="line"><span class="number">1</span>) <span class="number">1</span>) <span class="string">&quot;13.36138933897018433&quot;</span></span><br><span class="line">   <span class="number">2</span>) <span class="string">&quot;38.11555639549629859&quot;</span></span><br><span class="line"><span class="number">2</span>) <span class="number">1</span>) <span class="string">&quot;15.08726745843887329&quot;</span></span><br><span class="line">   <span class="number">2</span>) <span class="string">&quot;37.50266842333162032&quot;</span></span><br><span class="line"><span class="number">127.0.0.1:6379</span>&gt; GEODIST Sicily Palermo Catania km</span><br><span class="line"><span class="string">&quot;166.2742&quot;</span></span><br><span class="line"><span class="number">127.0.0.1:6379</span>&gt; GEORADIUS Sicily <span class="number">15</span> <span class="number">37</span> <span class="number">200</span> km WITHDIST</span><br><span class="line"><span class="number">1</span>) <span class="number">1</span>) <span class="string">&quot;Palermo&quot;</span></span><br><span class="line">   <span class="number">2</span>) <span class="string">&quot;190.4424&quot;</span></span><br><span class="line"><span class="number">2</span>) <span class="number">1</span>) <span class="string">&quot;Catania&quot;</span></span><br><span class="line">   <span class="number">2</span>) <span class="string">&quot;56.4413&quot;</span></span><br><span class="line"><span class="number">127.0.0.1:6379</span>&gt; GEORADIUS Sicily <span class="number">15</span> <span class="number">37</span> <span class="number">200</span> km WITHCOORD</span><br><span class="line"><span class="number">1</span>) <span class="number">1</span>) <span class="string">&quot;Palermo&quot;</span></span><br><span class="line">   <span class="number">2</span>) <span class="number">1</span>) <span class="string">&quot;13.36138933897018433&quot;</span></span><br><span class="line">      <span class="number">2</span>) <span class="string">&quot;38.11555639549629859&quot;</span></span><br><span class="line"><span class="number">2</span>) <span class="number">1</span>) <span class="string">&quot;Catania&quot;</span></span><br><span class="line">   <span class="number">2</span>) <span class="number">1</span>) <span class="string">&quot;15.08726745843887329&quot;</span></span><br><span class="line">      <span class="number">2</span>) <span class="string">&quot;37.50266842333162032&quot;</span></span><br><span class="line"><span class="number">127.0.0.1:6379</span>&gt; GEORADIUS Sicily <span class="number">15</span> <span class="number">37</span> <span class="number">200</span> km WITHDIST WITHCOORD</span><br><span class="line"><span class="number">1</span>) <span class="number">1</span>) <span class="string">&quot;Palermo&quot;</span></span><br><span class="line">   <span class="number">2</span>) <span class="string">&quot;190.4424&quot;</span></span><br><span class="line">   <span class="number">3</span>) <span class="number">1</span>) <span class="string">&quot;13.36138933897018433&quot;</span></span><br><span class="line">      <span class="number">2</span>) <span class="string">&quot;38.11555639549629859&quot;</span></span><br><span class="line"><span class="number">2</span>) <span class="number">1</span>) <span class="string">&quot;Catania&quot;</span></span><br><span class="line">   <span class="number">2</span>) <span class="string">&quot;56.4413&quot;</span></span><br><span class="line">   <span class="number">3</span>) <span class="number">1</span>) <span class="string">&quot;15.08726745843887329&quot;</span></span><br><span class="line">      <span class="number">2</span>) <span class="string">&quot;37.50266842333162032&quot;</span></span><br><span class="line"><span class="number">127.0.0.1:6379</span>&gt; GEOADD Sicily <span class="number">13</span>.<span class="number">583333</span> <span class="number">37</span>.<span class="number">316667</span> <span class="string">&quot;Agrigento&quot;</span></span><br><span class="line">(integer) <span class="number">1</span></span><br><span class="line"><span class="number">127.0.0.1:6379</span>&gt;  GEORADIUSBYMEMBER Sicily Agrigento <span class="number">100</span> km</span><br><span class="line"><span class="number">1</span>) <span class="string">&quot;Agrigento&quot;</span></span><br><span class="line"><span class="number">2</span>) <span class="string">&quot;Palermo&quot;</span></span><br><span class="line"><span class="number">127.0.0.1:6379</span>&gt; geohash Sicily Agrigento Palermo</span><br><span class="line"><span class="number">1</span>) <span class="string">&quot;sq9sm1716e0&quot;</span></span><br><span class="line"><span class="number">2</span>) <span class="string">&quot;sqc8b49rny0&quot;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>1.<code>GEOADD</code> 能够记录的坐标是有限的： 非常接近两极的区域是无法被索引的。 </p>
<p>精确的坐标限制由 EPSG:900913 / EPSG:3785 / OSGEO:41001 等坐标系统定义：</p>
<ul>
<li>有效的经度介于 -180 度至 180 度之间。</li>
<li>有效的纬度介于 -85.05112878 度至 85.05112878 度之间。</li>
</ul>
<p>当输入一个超出范围的经度或者纬度时， <code>GEOADD</code> 命令将返回一个错误。</p>
<p>2.<code>GEODIST</code>指定单位的参数 <code>unit</code> 必须是以下单位：</p>
<ul>
<li><code>m</code> :米。</li>
<li><code>km</code>:千米。</li>
<li><code>mi</code> 表示单位为英里。</li>
<li><code>ft</code> 表示单位为英尺。</li>
</ul>
<p>如果没有显式地指定单位参数， 那么 <code>GEODIST</code> 默认使用米作为单位。<code>GEODIST</code> 命令在计算距离时会假设地球为完美的球形， 在极限情况下，该假设最大会造成 0.5% 的误差。</p>
<p>3.<code>GEORADIUS</code>以下可选项时命令会返回额外信息：</p>
<ul>
<li><code>WITHDIST</code>:在返回位置元素的同时， 将位置元素与中心之间的距离也一并返回。 距离的单位和用户给定的范围单位保持一致。</li>
<li><code>WITHCOORD</code>:将位置元素的经度和维度也一并返回。</li>
<li><code>WITHHASH</code>:以 52 位有符号整数的形式， 返回位置元素经过原始 geohash 编码的有序集合分值(底层应用和调试)。</li>
</ul>
<p>命令默认返回未排序的位置元素。 以下两个参数可以指定被返回位置元素的排序方式：</p>
<ul>
<li><code>ASC</code>:根据中心的位置， 按照从近到远的方式返回位置元素。</li>
<li><code>DESC</code>:根据中心的位置， 按照从远到近的方式返回位置元素。</li>
</ul>
<p>在默认情况下， <code>GEORADIUS</code> 命令会返回所有匹配的位置元素。</p>
<p>虽然使用 <code>COUNT &lt;count&gt;</code> 选项去获取前 N 个匹配元素， 但命令内部可能会需要对所有被匹配的元素进行处理， 所以对一个非常大的区域进行搜索时， 即使只使用 <code>COUNT</code> 选项去获取少量元素，命令的执行速度也可能会非常慢。 但是从另一方面来说， 使用 <code>COUNT</code> 选项去减少需要返回的元素数量， 对于减少带宽来说仍然非常有用。</p>
</blockquote>
<hr>
<p>Stream</p>
<blockquote>
<p>1.Redis Stream 主要用于消息队列（MQ，Message Queue），Redis 本身有 Redis 发布订阅 (pub/sub) 来实现消息队列的功能，但消息无法持久化，如果出现网络断开、Redis 宕机等，消息就会被丢弃，即发布订阅 (pub/sub) 可以分发消息，但无法记录历史消息。</p>
<p>2.Redis Stream 提供了消息的持久化和主备复制功能，可以让任何客户端访问任何时刻的数据，并且能记住每一个客户端的访问位置，保证消息不丢失。</p>
<p>3.消费者组最早是由Kafka引入的。Redis用完全不同术语实现相似的概念，但目标是相同的：允许一组客户端相互配合来消费同一个Stream的不同部分的消息。</p>
</blockquote>
<img src="https://zerostione.github.io/ImageUp//Image/Blog/Redis/p21.png" style="zoom: 80%;" />

<blockquote>
<p>Redis Streams is an incredibly powerful data structure for managing high-velocity data streams (like a message queue). With out-of-the-box partitioning, replication, and persistence, it can capture and process millions of data points per second at sub-millisecond latency. Redis Streams is based on an efficient radix-tree implementation, which makes the range and lookup queries extremely fast. It connects producers and consumers with asynchronous calls and supports consumer groups.</p>
</blockquote>
<img src="https://zerostione.github.io/ImageUp//Image/Blog/Redis/p22.png" style="zoom: 80%;" />



<table>
<thead>
<tr>
<th align="center">命令</th>
<th align="center">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="center">XADD key ID field value [field value …]</td>
<td align="center">向队列添加消息，如果指定的队列不存在，则创建一个队列。key:队列名称，如果不存在就创建。ID:消息id，* 表示由 redis 生成，自定义需要保证递增性。 field value:记录</td>
</tr>
<tr>
<td align="center">XTRIM key MAXLEN | MINID [ = | ~] threshold [LIMIT count]</td>
<td align="center">对流进行修剪，限制长度</td>
</tr>
<tr>
<td align="center">XDEL key ID [ID …]</td>
<td align="center">删除消息</td>
</tr>
<tr>
<td align="center">XLEN key</td>
<td align="center">获取流包含的元素数量，即消息长度</td>
</tr>
<tr>
<td align="center">XRANGE key start end [COUNT count]</td>
<td align="center">获取消息列表，自动过滤已经删除的消息</td>
</tr>
<tr>
<td align="center">XREVRANGE key end start [COUNT count]</td>
<td align="center">获取消息列表，自动过滤已经删除的消息</td>
</tr>
<tr>
<td align="center">XREAD [COUNT count] [BLOCK milliseconds] STREAMS key [key …] id [id …]</td>
<td align="center">以阻塞或非阻塞方式获取消息列表</td>
</tr>
<tr>
<td align="center">XGROUP [CREATE key groupname id-or-$] [SETID key groupname id-or-$] [DESTROY key groupname] [DELCONSUMER key groupname consumername]</td>
<td align="center">创建消费者组</td>
</tr>
<tr>
<td align="center">XREADGROUP GROUP group consumer [COUNT count] [BLOCK milliseconds] [NOACK] STREAMS key [key …] ID [ID …]</td>
<td align="center">读取消费组中的消息</td>
</tr>
</tbody></table>
<hr>
<h3 id="事务"><a href="#事务" class="headerlink" title="事务"></a>事务</h3><blockquote>
<p>1.Redis 事务(Redis Transactions)可以一次执行多个命令，以命令 MULTI、EXEC、DISCARD 和 WATCH 为中心， 并且有两个重要的保证：</p>
<ul>
<li>事务中的所有命令都会序列化、按顺序地执行。</li>
<li>事务在执行的过程中，不会被其他客户端发送来的命令请求所打断。</li>
</ul>
<p>2.单个 Redis 命令的执行是原子性的，但 Redis 事务上并没有维持原子性的机制，所以 Redis 事务的执行并非原子性的。</p>
<p>3.事务可以理解为一个打包的批量执行脚本，但批量指令并非原子化的操作，中间某条指令的失败不会导致前面已做指令的回滚，也不会造成后续的指令中止执行。</p>
<p>4.一个事务从开始到执行经历三个阶段：</p>
<ul>
<li>开始事务</li>
<li>命令入队</li>
<li>执行事务</li>
</ul>
<p>5.Redis不支持回滚（roll back）。</p>
</blockquote>
<table>
<thead>
<tr>
<th align="center">命令</th>
<th align="center">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="center">DISCARD</td>
<td align="center">取消事务，放弃执行事务块内的所有命令</td>
</tr>
<tr>
<td align="center">EXEC</td>
<td align="center">执行所有事务块内的命令</td>
</tr>
<tr>
<td align="center">MULTI</td>
<td align="center">标记一个事务块的开始。</td>
</tr>
<tr>
<td align="center">UNWATCH</td>
<td align="center">取消 WATCH 命令对所有 key 的监视。</td>
</tr>
<tr>
<td align="center">WATCH key [key …]</td>
<td align="center">监视一个(或多个) key ，如果在事务执行之前这个(或这些) key 被其他命令所改动，那么事务将被打断</td>
</tr>
</tbody></table>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">127</span>.<span class="number">0</span>.<span class="number">0</span>.<span class="number">1</span>:<span class="number">6379</span>&gt; clear</span><br><span class="line"><span class="attribute">127</span>.<span class="number">0</span>.<span class="number">0</span>.<span class="number">1</span>:<span class="number">6379</span>&gt; multi</span><br><span class="line"><span class="attribute">OK</span></span><br><span class="line"><span class="attribute">127</span>.<span class="number">0</span>.<span class="number">0</span>.<span class="number">1</span>:<span class="number">6379</span>(TX)&gt; set k<span class="number">1</span> v<span class="number">1</span></span><br><span class="line"><span class="attribute">QUEUED</span></span><br><span class="line"><span class="attribute">127</span>.<span class="number">0</span>.<span class="number">0</span>.<span class="number">1</span>:<span class="number">6379</span>(TX)&gt; set k<span class="number">2</span> v<span class="number">2</span></span><br><span class="line"><span class="attribute">QUEUED</span></span><br><span class="line"><span class="attribute">127</span>.<span class="number">0</span>.<span class="number">0</span>.<span class="number">1</span>:<span class="number">6379</span>(TX)&gt; get k<span class="number">2</span></span><br><span class="line"><span class="attribute">QUEUED</span></span><br><span class="line"><span class="attribute">127</span>.<span class="number">0</span>.<span class="number">0</span>.<span class="number">1</span>:<span class="number">6379</span>(TX)&gt; exec</span><br><span class="line"><span class="attribute">1</span>) OK</span><br><span class="line"><span class="attribute">2</span>) OK</span><br><span class="line"><span class="attribute">3</span>) <span class="string">&quot;v2&quot;</span></span><br><span class="line"><span class="attribute">127</span>.<span class="number">0</span>.<span class="number">0</span>.<span class="number">1</span>:<span class="number">6379</span>&gt; keys *</span><br><span class="line"><span class="attribute">1</span>) <span class="string">&quot;k1&quot;</span></span><br><span class="line"><span class="attribute">2</span>) <span class="string">&quot;k2&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="attribute">127</span>.<span class="number">0</span>.<span class="number">0</span>.<span class="number">1</span>:<span class="number">6379</span>&gt; multi</span><br><span class="line"><span class="attribute">OK</span></span><br><span class="line"><span class="attribute">127</span>.<span class="number">0</span>.<span class="number">0</span>.<span class="number">1</span>:<span class="number">6379</span>(TX)&gt; set k<span class="number">3</span> v<span class="number">3</span></span><br><span class="line"><span class="attribute">QUEUED</span></span><br><span class="line"><span class="attribute">127</span>.<span class="number">0</span>.<span class="number">0</span>.<span class="number">1</span>:<span class="number">6379</span>(TX)&gt; get k<span class="number">3</span></span><br><span class="line"><span class="attribute">QUEUED</span></span><br><span class="line"><span class="attribute">127</span>.<span class="number">0</span>.<span class="number">0</span>.<span class="number">1</span>:<span class="number">6379</span>(TX)&gt; discard</span><br><span class="line"><span class="attribute">OK</span></span><br><span class="line"><span class="attribute">127</span>.<span class="number">0</span>.<span class="number">0</span>.<span class="number">1</span>:<span class="number">6379</span>&gt; keys *</span><br><span class="line"><span class="attribute">1</span>) <span class="string">&quot;k1&quot;</span></span><br><span class="line"><span class="attribute">2</span>) <span class="string">&quot;k2&quot;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<blockquote>
<p>事务错误：</p>
<ul>
<li>事务在执行EXEC之前，入队的命令可能会出错。如命令可能会产生语法错误（参数名错误），或者内存不足等问题( Redis 2.6.5 开始，服务器会对命令入队失败的情况进行记录，并在客户端调用EXEC命令时，拒绝执行并自动放弃这个事务)。</li>
<li>命令可能在EXEC调用之后失败。如事务中命令可能处理了错误类型的键，将列表命令用在字符串键上不会进行特别处理，即使事务中有某个/某些命令在执行时产生了错误，事务中的其他命令仍然会继续执行)。</li>
</ul>
</blockquote>
<figure class="highlight accesslog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">127.0.0.1:6379</span>&gt; multi</span><br><span class="line">OK</span><br><span class="line"><span class="number">127.0.0.1:6379</span>(TX)&gt; set k3 v3</span><br><span class="line">QUEUED</span><br><span class="line"><span class="number">127.0.0.1:6379</span>(TX)&gt; set k4 v4</span><br><span class="line">QUEUED</span><br><span class="line"><span class="number">127.0.0.1:6379</span>(TX)&gt; getset k3</span><br><span class="line">(error) ERR wrong number of arguments for &#x27;getset&#x27; command</span><br><span class="line"><span class="number">127.0.0.1:6379</span>(TX)&gt; set k5 v5</span><br><span class="line">QUEUED</span><br><span class="line"><span class="number">127.0.0.1:6379</span>(TX)&gt; exec</span><br><span class="line">(error) EXECABORT Transaction discarded because of previous errors.</span><br><span class="line"><span class="number">127.0.0.1:6379</span>&gt; keys *</span><br><span class="line"><span class="number">1</span>) <span class="string">&quot;k1&quot;</span></span><br><span class="line"><span class="number">2</span>) <span class="string">&quot;k2&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="number">127.0.0.1:6379</span>&gt; set k3 v3</span><br><span class="line">OK</span><br><span class="line"><span class="number">127.0.0.1:6379</span>&gt; multi</span><br><span class="line">OK</span><br><span class="line"><span class="number">127.0.0.1:6379</span>(TX)&gt; incr k1</span><br><span class="line">QUEUED</span><br><span class="line"><span class="number">127.0.0.1:6379</span>(TX)&gt; set k4 v4</span><br><span class="line">QUEUED</span><br><span class="line"><span class="number">127.0.0.1:6379</span>(TX)&gt; set k5 v5</span><br><span class="line">QUEUED</span><br><span class="line"><span class="number">127.0.0.1:6379</span>(TX)&gt; get k4</span><br><span class="line">QUEUED</span><br><span class="line"><span class="number">127.0.0.1:6379</span>(TX)&gt; exec</span><br><span class="line"><span class="number">1</span>) (error) ERR value is not an integer or out of range</span><br><span class="line"><span class="number">2</span>) OK</span><br><span class="line"><span class="number">3</span>) OK</span><br><span class="line"><span class="number">4</span>) <span class="string">&quot;v4&quot;</span></span><br></pre></td></tr></table></figure>

<hr>
<h4 id="乐观锁"><a href="#乐观锁" class="headerlink" title="乐观锁"></a>乐观锁</h4><blockquote>
<p>1.WATCH命令可以为 Redis 事务提供 check-and-set （CAS）行为。被WATCH的键会被监视，并会发觉这些键是否被改动过。 如果有至少一个被监视的键在 EXEC 执行之前被修改了，那么整个事务都会被取消， EXEC 返回nil-reply来表示事务已经失败。如果在 WATCH执行之后， EXEC 执行之前， 其他客户端修改WATCH监视键的值， 那么当前客户端事务会失败。 程序需要不断重试这个操作，直到没有发生碰撞为止。</p>
<p>2.WATCH 使得 EXEC 命令需要有条件地执行:事务只能在所有被监视键都没有被修改的前提下执行， 如果这个前提不能满足的话，事务就不会被执行。</p>
<p>3.WATCH命令可以被调用多次。</p>
<p>4.对键的监视从 WATCH 执行之后开始生效，直到调用 EXEC为止。当EXEC被调用时， 不管事务是否成功执行，对所有键的监视都会被取消。当客户端断开连接时，该客户端对键的监视也会被取消。</p>
<p>5.单个 WATCH 命令可以监视任意多个键。</p>
<p>6.使用无参数的 UNWATCH 命令可以手动取消对所有键的监视。</p>
</blockquote>
<figure class="highlight accesslog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">127.0.0.1:6379</span>&gt; set money <span class="number">100</span></span><br><span class="line">OK</span><br><span class="line"><span class="number">127.0.0.1:6379</span>&gt; watch money</span><br><span class="line">OK</span><br><span class="line"><span class="number">127.0.0.1:6379</span>&gt; multi</span><br><span class="line">OK</span><br><span class="line"><span class="number">127.0.0.1:6379</span>(TX)&gt; decrby money <span class="number">20</span></span><br><span class="line">QUEUED</span><br><span class="line"><span class="number">127.0.0.1:6379</span>(TX)&gt; exec</span><br><span class="line"><span class="number">1</span>) (integer) <span class="number">80</span></span><br><span class="line"><span class="number">127.0.0.1:6379</span>&gt; get money</span><br><span class="line"><span class="string">&quot;80&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="number">127.0.0.1:6379</span>&gt; watch money</span><br><span class="line">OK</span><br><span class="line"><span class="number">127.0.0.1:6379</span>&gt; multi</span><br><span class="line">OK</span><br><span class="line"><span class="number">127.0.0.1:6379</span>(TX)&gt; decrby money <span class="number">32</span></span><br><span class="line">QUEUED</span><br><span class="line"></span><br><span class="line"># 另一客户端</span><br><span class="line"><span class="number">127.0.0.1:6379</span>&gt; incrby money <span class="number">120</span></span><br><span class="line">(integer) <span class="number">200</span></span><br><span class="line"></span><br><span class="line"><span class="number">127.0.0.1:6379</span>(TX)&gt; exec</span><br><span class="line">(nil)</span><br><span class="line"><span class="number">127.0.0.1:6379</span>&gt; get money</span><br><span class="line"><span class="string">&quot;200&quot;</span></span><br></pre></td></tr></table></figure>

<hr>
<hr>
<h3 id="Jedis"><a href="#Jedis" class="headerlink" title="Jedis"></a>Jedis</h3><img src="https://zerostione.github.io/ImageUp//Image/Blog/Redis/p23.png" style="zoom: 33%;" />

<blockquote>
<p><a target="_blank" rel="noopener" href="https://github.com/redis/jedis">Jedis</a> is a Java client for <a target="_blank" rel="noopener" href="https://github.com/redis/redis">Redis</a> designed for performance and ease of use.</p>
</blockquote>
<hr>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>redis.clients<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jedis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.2.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<hr>
<p>1.连接Redis</p>
<ul>
<li>JedisPool</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">JedisPool pool = <span class="keyword">new</span> JedisPool(url, port,username,password); <span class="comment">/* 无username即为null */</span></span><br><span class="line"><span class="keyword">try</span> (Jedis jedis = pool.getResource()) &#123;</span><br><span class="line">    System.out.println(jedis.ping());</span><br><span class="line">    jedis.set(<span class="string">&quot;name&quot;</span>, <span class="string">&quot;Jedis&quot;</span>);</span><br><span class="line">    System.out.println(jedis.get(<span class="string">&quot;name&quot;</span>) );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>JedisPooled</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">JedisPooled jedis = <span class="keyword">new</span> JedisPooled(url, port,username,password);</span><br><span class="line">jedis.set(<span class="string">&quot;Name&quot;</span>,<span class="string">&quot;RedisTest&quot;</span>);</span><br><span class="line">System.out.println(jedis.get(<span class="string">&quot;Name&quot;</span>));</span><br></pre></td></tr></table></figure>

<ul>
<li>Jedis</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Jedis jedis = <span class="keyword">new</span> Jedis(<span class="string">&quot;106.52.67.217&quot;</span>, <span class="number">6379</span>);</span><br><span class="line">jedis.auth(<span class="string">&quot;ryuT?=0-U623&quot;</span>);</span><br><span class="line">System.out.println(jedis.ping());</span><br><span class="line">jedis.set(<span class="string">&quot;team&quot;</span>,<span class="string">&quot;Gaming&quot;</span>);</span><br><span class="line">System.out.println(jedis.get(<span class="string">&quot;team&quot;</span>));</span><br></pre></td></tr></table></figure>

<hr>
<p>1.Key</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*1.选择数据库*/</span></span><br><span class="line">System.out.println(jedis.select(<span class="number">2</span>));</span><br><span class="line"><span class="comment">/*2.清空该数据库*/</span></span><br><span class="line">System.out.println(jedis.flushDB());</span><br><span class="line"><span class="comment">/*3.查询键存在*/</span></span><br><span class="line">System.out.println(jedis.exists(<span class="string">&quot;name&quot;</span>));</span><br><span class="line"><span class="comment">/*4.设置键值对*/</span></span><br><span class="line">System.out.println(jedis.set(<span class="string">&quot;name&quot;</span>,<span class="string">&quot;Admin&quot;</span>));</span><br><span class="line">System.out.println(jedis.set(<span class="string">&quot;username&quot;</span>,<span class="string">&quot;Jedis&quot;</span>));</span><br><span class="line">System.out.println(jedis.set(<span class="string">&quot;score&quot;</span>,<span class="string">&quot;12&quot;</span>));</span><br><span class="line"><span class="comment">/*5.查询该数据库所有键值对*/</span></span><br><span class="line">Set&lt;String&gt; keys = jedis.keys(<span class="string">&quot;*&quot;</span>);</span><br><span class="line">System.out.println(keys);</span><br><span class="line"><span class="comment">/*6.删除键*/</span></span><br><span class="line">System.out.println(jedis.del(<span class="string">&quot;username&quot;</span>));</span><br><span class="line"><span class="comment">/*7.查看对应键的值类型*/</span></span><br><span class="line">System.out.println(jedis.type(<span class="string">&quot;name&quot;</span>));</span><br><span class="line"><span class="comment">/*8.当前数据库中随机返回一个key*/</span></span><br><span class="line">System.out.println(jedis.randomKey());</span><br><span class="line"><span class="comment">/*9.重命名key*/</span></span><br><span class="line">System.out.println(jedis.rename(<span class="string">&quot;name&quot;</span>,<span class="string">&quot;usr&quot;</span>));</span><br><span class="line"><span class="comment">/*10.返回当前数据库key数目*/</span></span><br><span class="line">System.out.println(jedis.dbSize());</span><br><span class="line"><span class="comment">/*11.清空所有数据库*/</span></span><br><span class="line">System.out.println(jedis.flushAll());</span><br></pre></td></tr></table></figure>

<p>2.String</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*1.设置对应key的值*/</span></span><br><span class="line">System.out.println(jedis.set(<span class="string">&quot;k1&quot;</span>,<span class="string">&quot;v1&quot;</span>));</span><br><span class="line">System.out.println(jedis.set(<span class="string">&quot;k2&quot;</span>,<span class="string">&quot;v2&quot;</span>));</span><br><span class="line">System.out.println(jedis.set(<span class="string">&quot;k3&quot;</span>,<span class="string">&quot;v3&quot;</span>));</span><br><span class="line"><span class="comment">/*2.获取指定key的值*/</span></span><br><span class="line">System.out.println(jedis.get(<span class="string">&quot;k1&quot;</span>));</span><br><span class="line"><span class="comment">/*3.删除指定key*/</span></span><br><span class="line">System.out.println(jedis.del(<span class="string">&quot;k1&quot;</span>));</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">4.为指定的key追加值</span></span><br><span class="line"><span class="comment">key已存在且是字符串，将value追加到key原来值的末尾</span></span><br><span class="line"><span class="comment">key 不存在，给定key设为value</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">System.out.println(jedis.append(<span class="string">&quot;k2&quot;</span>,<span class="string">&quot; is value&quot;</span>));</span><br><span class="line"><span class="comment">/*5.设置多个键值对*/</span></span><br><span class="line">System.out.println(jedis.mset(<span class="string">&quot;k4&quot;</span>,<span class="string">&quot;v4&quot;</span>,<span class="string">&quot;k5&quot;</span>,<span class="string">&quot;v5&quot;</span>));</span><br><span class="line"><span class="comment">/*6.获取多个键值对*/</span></span><br><span class="line">System.out.println(jedis.mget(<span class="string">&quot;k1&quot;</span>,<span class="string">&quot;k2&quot;</span>,<span class="string">&quot;k3&quot;</span>,<span class="string">&quot;k4&quot;</span>,<span class="string">&quot;k5&quot;</span>));</span><br><span class="line"><span class="comment">/*7.删除多个键值对*/</span></span><br><span class="line">System.out.println(jedis.del(<span class="string">&quot;k1,k3&quot;</span>));</span><br><span class="line"><span class="comment">/*8.指定的key不存在时，为key设置指定的值*/</span></span><br><span class="line">System.out.println(jedis.setnx(<span class="string">&quot;k4&quot;</span>,<span class="string">&quot;val1&quot;</span>));</span><br><span class="line">System.out.println(jedis.setnx(<span class="string">&quot;key1&quot;</span>,<span class="string">&quot;value1&quot;</span>));</span><br><span class="line"><span class="comment">/*9.为指定的key设置值及过期时间。key已经存在，将替换旧值*/</span></span><br><span class="line">System.out.println(jedis.setex(<span class="string">&quot;key3&quot;</span>,<span class="number">3</span>,<span class="string">&quot;value3&quot;</span>));</span><br><span class="line">System.out.println(jedis.get(<span class="string">&quot;key3&quot;</span>));</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    TimeUnit.SECONDS.sleep(<span class="number">5</span>);</span><br><span class="line">&#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">    e.printStackTrace();</span><br><span class="line">&#125;</span><br><span class="line">System.out.println(jedis.get(<span class="string">&quot;key3&quot;</span>));</span><br><span class="line"></span><br><span class="line"><span class="comment">/*10.设置指定key的值，返回key的旧值*/</span></span><br><span class="line">System.out.println(jedis.getSet(<span class="string">&quot;key1&quot;</span>,<span class="string">&quot;This is value1&quot;</span>));</span><br><span class="line"></span><br><span class="line"><span class="comment">/*11.获取存储在指定key中字符串的子字符串。字符串截取范围由start和end两个偏移量决定(包括start和end)*/</span></span><br><span class="line">System.out.println(jedis.getrange(<span class="string">&quot;key1&quot;</span>,<span class="number">2</span>,<span class="number">9</span>));</span><br></pre></td></tr></table></figure>

<p>3.List</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*1.将多个值插入列表头部*/</span></span><br><span class="line">jedis.lpush(<span class="string">&quot;techStack&quot;</span>,<span class="string">&quot;Java&quot;</span>,<span class="string">&quot;MySQL&quot;</span>,<span class="string">&quot;SpringBoot&quot;</span>,<span class="string">&quot;MyBatis&quot;</span>);</span><br><span class="line">jedis.lpush(<span class="string">&quot;techStack&quot;</span>,<span class="string">&quot;Redis&quot;</span>,<span class="string">&quot;MongoDB&quot;</span>,<span class="string">&quot;Java&quot;</span>);</span><br><span class="line"><span class="comment">/*2.获取列表指定范围内的元素*/</span></span><br><span class="line">System.out.println(jedis.lrange(<span class="string">&quot;techStack&quot;</span>,<span class="number">0</span>,-<span class="number">1</span>));</span><br><span class="line"><span class="comment">/*3.移除列表中与参数 value 相等指定数量的元素*/</span></span><br><span class="line">System.out.println(jedis.lrem(<span class="string">&quot;techStack&quot;</span>,<span class="number">1</span>,<span class="string">&quot;Java&quot;</span>));</span><br><span class="line"><span class="comment">/*4.保留指定区间内的元素*/</span></span><br><span class="line">System.out.println(jedis.ltrim(<span class="string">&quot;techStack&quot;</span>,<span class="number">0</span>,<span class="number">3</span>));</span><br><span class="line"><span class="comment">/*5.移出并获取列表的第一个元素*/</span></span><br><span class="line">System.out.println(jedis.lpop(<span class="string">&quot;techStack&quot;</span>));</span><br><span class="line"><span class="comment">/*6.在列表尾部添加一个或多个值*/</span></span><br><span class="line">System.out.println(jedis.rpush(<span class="string">&quot;techStack&quot;</span>,<span class="string">&quot;Shiro&quot;</span>,<span class="string">&quot;Kafka&quot;</span>));</span><br><span class="line"><span class="comment">/*7.移除列表的最后一个元素*/</span></span><br><span class="line">System.out.println(jedis.rpop(<span class="string">&quot;techStack&quot;</span>));</span><br><span class="line"><span class="comment">/*8.将列表 key下标为index的元素的值设置为value*/</span></span><br><span class="line">System.out.println(jedis.lset(<span class="string">&quot;techStack&quot;</span>,<span class="number">1</span>,<span class="string">&quot;Docker&quot;</span>));</span><br><span class="line"><span class="comment">/*9.获取列表长度*/</span></span><br><span class="line">System.out.println(jedis.llen(<span class="string">&quot;techStack&quot;</span>));</span><br><span class="line"><span class="comment">/*10.获取列表对应下标的值*/</span></span><br><span class="line">System.out.println(jedis.lindex(<span class="string">&quot;techStack&quot;</span>,<span class="number">1</span>));</span><br><span class="line"><span class="comment">/*11.返回或保存给定列表、集合、有序集合 key 中经过排序的元素。默认以数字作为对象，值被解释为双精度浮点数进行比较*/</span></span><br><span class="line">System.out.println(jedis.lpush(<span class="string">&quot;num&quot;</span>, <span class="string">&quot;3&quot;</span>, <span class="string">&quot;6&quot;</span>, <span class="string">&quot;2&quot;</span>, <span class="string">&quot;4&quot;</span>, <span class="string">&quot;5&quot;</span>, <span class="string">&quot;7&quot;</span>, <span class="string">&quot;9&quot;</span>));</span><br><span class="line">System.out.println(jedis.lrange(<span class="string">&quot;num&quot;</span>,<span class="number">0</span>,-<span class="number">1</span>));</span><br><span class="line">System.out.println(jedis.sort(<span class="string">&quot;num&quot;</span>));</span><br></pre></td></tr></table></figure>

<p>4.Set</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*1.集合中添加元素*/</span></span><br><span class="line">System.out.println(jedis.sadd(<span class="string">&quot;mySet&quot;</span>,<span class="string">&quot;v1&quot;</span>,<span class="string">&quot;v2&quot;</span>,<span class="string">&quot;v3&quot;</span>,<span class="string">&quot;v4&quot;</span>,<span class="string">&quot;v5&quot;</span>));</span><br><span class="line">System.out.println(jedis.sadd(<span class="string">&quot;mySet&quot;</span>,<span class="string">&quot;v7&quot;</span>));</span><br><span class="line">System.out.println(jedis.sadd(<span class="string">&quot;mySet2&quot;</span>,<span class="string">&quot;v3&quot;</span>,<span class="string">&quot;v4&quot;</span>,<span class="string">&quot;v5&quot;</span>,<span class="string">&quot;v8&quot;</span>,<span class="string">&quot;v9&quot;</span>,<span class="string">&quot;v11&quot;</span>));</span><br><span class="line"><span class="comment">/*2.返回集合中的所有成员*/</span></span><br><span class="line">System.out.println(jedis.smembers(<span class="string">&quot;mySet&quot;</span>));</span><br><span class="line"><span class="comment">/*3.移除集合中一个或多个成员*/</span></span><br><span class="line">System.out.println(jedis.srem(<span class="string">&quot;mySet&quot;</span>,<span class="string">&quot;v1&quot;</span>));</span><br><span class="line"><span class="comment">/*4.移除并返回集合中的一个随机元素*/</span></span><br><span class="line">System.out.println(jedis.spop(<span class="string">&quot;mySet&quot;</span>));</span><br><span class="line"><span class="comment">/*5.获取集合的成员数*/</span></span><br><span class="line">System.out.println(jedis.scard(<span class="string">&quot;mySet&quot;</span>));</span><br><span class="line"><span class="comment">/*6.判断元素是否是集合的成员*/</span></span><br><span class="line">System.out.println(jedis.sismember(<span class="string">&quot;mySet&quot;</span>,<span class="string">&quot;v2&quot;</span>));</span><br><span class="line"><span class="comment">/*7.将元素从集合移动到另一集合*/</span></span><br><span class="line">System.out.println(jedis.smove(<span class="string">&quot;mySet2&quot;</span>,<span class="string">&quot;mySet&quot;</span>,<span class="string">&quot;v11&quot;</span>));</span><br><span class="line"><span class="comment">/*8.两集合的交集*/</span></span><br><span class="line">System.out.println(jedis.sinter(<span class="string">&quot;mySet&quot;</span>,<span class="string">&quot;mySet2&quot;</span>));</span><br><span class="line"><span class="comment">/*9.两集合的并集*/</span></span><br><span class="line">System.out.println(jedis.sunion(<span class="string">&quot;mySet&quot;</span>,<span class="string">&quot;mySet2&quot;</span>));</span><br><span class="line"><span class="comment">/*10.两集合的差集*/</span></span><br><span class="line">System.out.println(jedis.sdiff(<span class="string">&quot;mySet&quot;</span>,<span class="string">&quot;mySet2&quot;</span>));</span><br></pre></td></tr></table></figure>

<p>5.Hash</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*1.将多个field-value对设置到哈希表中*/</span></span><br><span class="line">jedis.hmset(<span class="string">&quot;myHash&quot;</span>,map);</span><br><span class="line"><span class="comment">/*2.哈希表中的字段的设值*/</span></span><br><span class="line">jedis.hset(<span class="string">&quot;myHash&quot;</span>,<span class="string">&quot;k4&quot;</span>,<span class="string">&quot;v4&quot;</span>);</span><br><span class="line"><span class="comment">/*3.获取在哈希表中指定 key 的所有字段和值*/</span></span><br><span class="line">System.out.println(jedis.hgetAll(<span class="string">&quot;myHash&quot;</span>));</span><br><span class="line"><span class="comment">/*4.获取所有哈希表中的字段*/</span></span><br><span class="line">System.out.println(jedis.hkeys(<span class="string">&quot;myHash&quot;</span>));</span><br><span class="line"><span class="comment">/*5.获取哈希表中所有值*/</span></span><br><span class="line">System.out.println(jedis.hvals(<span class="string">&quot;myHash&quot;</span>));</span><br><span class="line"><span class="comment">/*6.为哈希表的指定字段的整数值加上增量*/</span></span><br><span class="line">System.out.println(jedis.hincrBy(<span class="string">&quot;myHash&quot;</span>,<span class="string">&quot;k5&quot;</span>,<span class="number">10</span>));</span><br><span class="line"><span class="comment">/*7.为哈希表的指定字段的浮点数值加上增量*/</span></span><br><span class="line">System.out.println(jedis.hincrByFloat(<span class="string">&quot;myHash&quot;</span>,<span class="string">&quot;k6&quot;</span>,<span class="number">1.24</span>));</span><br><span class="line"><span class="comment">/*8.删除一个或多个哈希表字段*/</span></span><br><span class="line">System.out.println(jedis.hdel(<span class="string">&quot;myHash&quot;</span>,<span class="string">&quot;k1&quot;</span>));</span><br><span class="line"><span class="comment">/*9.获取哈希表中字段的数量*/</span></span><br><span class="line">System.out.println(jedis.hlen(<span class="string">&quot;myHash&quot;</span>));</span><br><span class="line"><span class="comment">/*10.查看哈希表中指定的字段是否存在*/</span></span><br><span class="line">System.out.println(jedis.hexists(<span class="string">&quot;myHash&quot;</span>,<span class="string">&quot;k1&quot;</span>));</span><br><span class="line"><span class="comment">/*11.获取所有给定字段的值*/</span></span><br><span class="line">System.out.println(jedis.hmget(<span class="string">&quot;myHash&quot;</span>,<span class="string">&quot;k2&quot;</span>,<span class="string">&quot;k3&quot;</span>));</span><br></pre></td></tr></table></figure>

<p>5.Zset</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*1.向有序集合添加一个或多个成员，或者更新已存在成员的分数*/</span></span><br><span class="line">Map&lt;String, Double&gt; scoreMembers = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">scoreMembers.put(<span class="string">&quot;member1&quot;</span>,<span class="number">1.0</span>);</span><br><span class="line">scoreMembers.put(<span class="string">&quot;member2&quot;</span>,<span class="number">2.0</span>);</span><br><span class="line">scoreMembers.put(<span class="string">&quot;member3&quot;</span>,<span class="number">3.0</span>);</span><br><span class="line">System.out.println(jedis.zadd(<span class="string">&quot;myZest&quot;</span>,scoreMembers));</span><br><span class="line"><span class="comment">/*2.获取有序集合的成员数*/</span></span><br><span class="line">System.out.println(jedis.zcard(<span class="string">&quot;myZest&quot;</span>));</span><br><span class="line"><span class="comment">/*3.计算在有序集合中指定区间分数的成员数*/</span></span><br><span class="line">System.out.println(jedis.zcount(<span class="string">&quot;myZest&quot;</span>,<span class="number">1.0</span>,<span class="number">2.0</span>));</span><br><span class="line"><span class="comment">/*4.有序集合中对指定成员的分数加上增量*/</span></span><br><span class="line">System.out.println(jedis.zincrby(<span class="string">&quot;myZest&quot;</span>,<span class="number">3.6</span>,<span class="string">&quot;member1&quot;</span>));</span><br><span class="line"><span class="comment">/*5.返回有序集合中指定成员的索引*/</span></span><br><span class="line">System.out.println(jedis.zrank(<span class="string">&quot;myZest&quot;</span>,<span class="string">&quot;member1&quot;</span>));</span><br><span class="line"><span class="comment">/*6.移除有序集合中的一个或多个成员*/</span></span><br><span class="line">System.out.println(jedis.zrem(<span class="string">&quot;myZest&quot;</span>,<span class="string">&quot;member1&quot;</span>));</span><br><span class="line"><span class="comment">/*7.返回有序集中指定区间内的成员，通过索引，分数从高到低*/</span></span><br><span class="line">System.out.println(jedis.zrevrange(<span class="string">&quot;myZest&quot;</span>,<span class="number">0</span>,<span class="number">4</span>));</span><br><span class="line"><span class="comment">/*8.用于移除有序集中指定分数（score）区间内的所有成员*/</span></span><br><span class="line">System.out.println(jedis.zremrangeByScore(<span class="string">&quot;myZest&quot;</span>,<span class="number">0</span>,<span class="number">1</span>));</span><br><span class="line"><span class="comment">/*9.返回有序集中，成员的分数值*/</span></span><br><span class="line">System.out.println(jedis.zscore(<span class="string">&quot;myZest&quot;</span>,<span class="string">&quot;member3&quot;</span>));</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<hr>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">Jedis jedis = <span class="keyword">new</span> Jedis(<span class="string">&quot;106.52.67.217&quot;</span>, <span class="number">6379</span>);</span><br><span class="line">jedis.auth(<span class="string">&quot;ryuT?=0-U623&quot;</span>);</span><br><span class="line">Transaction multi = jedis.multi();</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    multi.set(<span class="string">&quot;name&quot;</span>,<span class="string">&quot;admin&quot;</span>);</span><br><span class="line">    multi.set(<span class="string">&quot;phone&quot;</span>,<span class="string">&quot;12458902&quot;</span>);</span><br><span class="line">    <span class="keyword">int</span> num= <span class="number">1</span>/<span class="number">0</span>;</span><br><span class="line">    multi.set(<span class="string">&quot;id&quot;</span>,<span class="string">&quot;10&quot;</span>);</span><br><span class="line">&#125;<span class="keyword">catch</span> (Exception e)&#123;</span><br><span class="line">    <span class="comment">/*multi.discard();*/</span></span><br><span class="line">    e.printStackTrace();</span><br><span class="line">&#125;</span><br><span class="line">multi.exec();</span><br></pre></td></tr></table></figure>

<h3 id="Lettuce"><a href="#Lettuce" class="headerlink" title="Lettuce"></a>Lettuce</h3><img src="https://zerostione.github.io/ImageUp//Image/Blog/Redis/p26.png" style="zoom: 80%;" />

<blockquote>
<p>1.Lettuce是一个高性能基于Java编写的Redis驱动框架，底层集成了Project Reactor提供天然的反应式编程，通信框架集成了Netty使用了非阻塞IO，5.x版本之后融合了JDK1.8的异步编程特性，在保证高性能的同时提供了十分丰富易用的API。</p>
<ol start="2">
<li>Spring Boot 2.X 默认集成了 Lettuce(<code>spring-boot-starter-data-redis</code>) </li>
</ol>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration(</span></span><br><span class="line"><span class="meta">    proxyBeanMethods = false</span></span><br><span class="line"><span class="meta">)</span></span><br><span class="line"><span class="meta">@ConditionalOnClass(&#123;RedisOperations.class&#125;)</span></span><br><span class="line"><span class="meta">@EnableConfigurationProperties(&#123;RedisProperties.class&#125;)</span></span><br><span class="line"><span class="meta">@Import(&#123;LettuceConnectionConfiguration.class, JedisConnectionConfiguration.class&#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RedisAutoConfiguration</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">RedisAutoConfiguration</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="meta">@ConditionalOnMissingBean(</span></span><br><span class="line"><span class="meta">        name = &#123;&quot;redisTemplate&quot;&#125;</span></span><br><span class="line"><span class="meta">    )</span></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">    默认情况下RedisTemplat模板只能支持 RedisTemplate&lt;String,String&gt;只能进行字符串操作，</span></span><br><span class="line"><span class="comment">    需要自定义 RedisTemplate并设置序列化器来操作实例对象,@ConditionalOnMissingBean默认RedisTemlate失效</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    <span class="meta">@ConditionalOnSingleCandidate(RedisConnectionFactory.class)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> RedisTemplate&lt;Object, Object&gt; <span class="title">redisTemplate</span><span class="params">(RedisConnectionFactory redisConnectionFactory)</span> </span>&#123;</span><br><span class="line">        RedisTemplate&lt;Object, Object&gt; template = <span class="keyword">new</span> RedisTemplate();</span><br><span class="line">        template.setConnectionFactory(redisConnectionFactory);</span><br><span class="line">        <span class="keyword">return</span> template;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="meta">@ConditionalOnMissingBean</span></span><br><span class="line">    <span class="meta">@ConditionalOnSingleCandidate(RedisConnectionFactory.class)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> StringRedisTemplate <span class="title">stringRedisTemplate</span><span class="params">(RedisConnectionFactory redisConnectionFactory)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> StringRedisTemplate(redisConnectionFactory);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ConfigurationProperties(</span></span><br><span class="line"><span class="meta">    prefix = &quot;spring.redis&quot;</span></span><br><span class="line"><span class="meta">)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RedisProperties</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> database = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">private</span> String url;</span><br><span class="line">    <span class="keyword">private</span> String host = <span class="string">&quot;localhost&quot;</span>;</span><br><span class="line">    <span class="keyword">private</span> String username;</span><br><span class="line">    <span class="keyword">private</span> String password;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> port = <span class="number">6379</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">boolean</span> ssl;</span><br><span class="line">    <span class="keyword">private</span> Duration timeout;</span><br><span class="line">    <span class="keyword">private</span> Duration connectTimeout;</span><br><span class="line">    <span class="keyword">private</span> String clientName;</span><br><span class="line">    <span class="keyword">private</span> RedisProperties.ClientType clientType;</span><br><span class="line">    <span class="keyword">private</span> RedisProperties.Sentinel sentinel;</span><br><span class="line">    <span class="keyword">private</span> RedisProperties.Cluster cluster;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> RedisProperties.Jedis jedis = <span class="keyword">new</span> RedisProperties.Jedis();</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> RedisProperties.Lettuce lettuce = <span class="keyword">new</span> RedisProperties.Lettuce();</span><br><span class="line"></span><br><span class="line">    ......</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Lettuce</span> </span>&#123;</span><br><span class="line">        <span class="keyword">private</span> Duration shutdownTimeout = Duration.ofMillis(<span class="number">100L</span>);</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">final</span> RedisProperties.Pool pool = <span class="keyword">new</span> RedisProperties.Pool();</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">final</span> RedisProperties.Lettuce.Cluster cluster = <span class="keyword">new</span> RedisProperties.Lettuce.Cluster();</span><br><span class="line"></span><br><span class="line">       .....</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Cluster</span> </span>&#123;</span><br><span class="line">            <span class="keyword">private</span> <span class="keyword">final</span> RedisProperties.Lettuce.Cluster.Refresh refresh = <span class="keyword">new</span> RedisProperties.Lettuce.Cluster.Refresh();</span><br><span class="line"></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="title">Cluster</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">public</span> RedisProperties.Lettuce.Cluster.<span class="function">Refresh <span class="title">getRefresh</span><span class="params">()</span> </span>&#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">this</span>.refresh;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Refresh</span> </span>&#123;</span><br><span class="line">                <span class="keyword">private</span> <span class="keyword">boolean</span> dynamicRefreshSources = <span class="keyword">true</span>;</span><br><span class="line">                <span class="keyword">private</span> Duration period;</span><br><span class="line">                <span class="keyword">private</span> <span class="keyword">boolean</span> adaptive;</span><br><span class="line"></span><br><span class="line">                ......</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Jedis</span> </span>&#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">final</span> RedisProperties.Pool pool = <span class="keyword">new</span> RedisProperties.Pool();</span><br><span class="line">        </span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">Jedis</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> RedisProperties.<span class="function">Pool <span class="title">getPool</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">this</span>.pool;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Sentinel</span> </span>&#123;</span><br><span class="line">        <span class="keyword">private</span> String master;</span><br><span class="line">        <span class="keyword">private</span> List&lt;String&gt; nodes;</span><br><span class="line">        <span class="keyword">private</span> String password;</span><br><span class="line">       ......</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Pool</span> </span>&#123;</span><br><span class="line">        <span class="keyword">private</span> Boolean enabled;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">int</span> maxIdle = <span class="number">8</span>;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">int</span> minIdle = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">int</span> maxActive = <span class="number">8</span>;</span><br><span class="line">        <span class="keyword">private</span> Duration maxWait = Duration.ofMillis(-<span class="number">1L</span>);</span><br><span class="line">        <span class="keyword">private</span> Duration timeBetweenEvictionRuns;</span><br><span class="line">        ......</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">enum</span> <span class="title">ClientType</span> </span>&#123;</span><br><span class="line">        LETTUCE,</span><br><span class="line">        JEDIS;</span><br><span class="line">        <span class="function"><span class="keyword">private</span> <span class="title">ClientType</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">redis:</span></span><br><span class="line">    <span class="attr">host:</span> </span><br><span class="line">    <span class="attr">port:</span> <span class="number">6379</span></span><br><span class="line">    <span class="attr">password:</span> </span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="meta">@Qualifier(&quot;redisTemplate&quot;)</span></span><br><span class="line">RedisTemplate redisTemplate;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    opsForValue String</span></span><br><span class="line"><span class="comment">    opsForList List</span></span><br><span class="line"><span class="comment">    opsForZSet ZSet</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">contextLoads</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">    RedisConnection connection = redisTemplate.getConnectionFactory().getConnection();</span></span><br><span class="line"><span class="comment">    connection.flushDb();</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    redisTemplate.opsForValue().set(<span class="string">&quot;Major&quot;</span>,<span class="string">&quot;Computer Science&quot;</span>);</span><br><span class="line">    System.out.println(redisTemplate.opsForValue().get(<span class="string">&quot;Major&quot;</span>));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>测试后发现虽然值可以获取，但键在数据库中实际为<code>\xAC\xED\x00\x05t\x00\x05major</code>,由于spring-data-redis的<code>RedisTemplate&lt;K,V&gt;</code>模板类在操作redis时默认使用<code>JdkSerializationRedisSerializer</code>来进行序列化</p>
</blockquote>
<ul>
<li>明确redisTemplate类型</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Autowired</span> </span><br><span class="line"><span class="keyword">private</span> RedisTemplate&lt;String,String&gt; redisTemplate</span><br></pre></td></tr></table></figure>

<ul>
<li>编写Redis配置类</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CacheConfig</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> RedisTemplate&lt;String,Object&gt; <span class="title">redisTemplate</span><span class="params">(RedisConnectionFactory cf)</span> </span>&#123;</span><br><span class="line">        RedisTemplate&lt;String, Object&gt; redisTemplate = <span class="keyword">new</span> RedisTemplate&lt;&gt;();</span><br><span class="line"></span><br><span class="line">        <span class="comment">/*String序列化*/</span></span><br><span class="line">        StringRedisSerializer stringRedisSerializer = <span class="keyword">new</span> StringRedisSerializer();</span><br><span class="line">        <span class="comment">/*JSON序列化*/</span></span><br><span class="line">        Jackson2JsonRedisSerializer jackson2JsonRedisSerializer = <span class="keyword">new</span> Jackson2JsonRedisSerializer(Object.class);</span><br><span class="line">        ObjectMapper om = <span class="keyword">new</span> ObjectMapper();</span><br><span class="line">        om.setVisibility(PropertyAccessor.ALL, JsonAutoDetect.Visibility.ANY);</span><br><span class="line">        om.activateDefaultTyping(LaissezFaireSubTypeValidator.instance ,</span><br><span class="line">                ObjectMapper.DefaultTyping.NON_FINAL, JsonTypeInfo.As.PROPERTY);</span><br><span class="line">        jackson2JsonRedisSerializer.setObjectMapper(om);</span><br><span class="line"></span><br><span class="line">        <span class="comment">/*Key采用String序列化*/</span></span><br><span class="line">        redisTemplate.setKeySerializer(stringRedisSerializer);</span><br><span class="line">        <span class="comment">/*Hash Key采用String序列化*/</span></span><br><span class="line">        redisTemplate.setHashKeySerializer(stringRedisSerializer);</span><br><span class="line">        <span class="comment">/*Value采用JSON(JackSon)序列化*/</span></span><br><span class="line">        redisTemplate.setValueSerializer(jackson2JsonRedisSerializer);</span><br><span class="line">        <span class="comment">/*Hash Value采用JSON序列化*/</span></span><br><span class="line">        redisTemplate.setHashValueSerializer(jackson2JsonRedisSerializer);</span><br><span class="line"></span><br><span class="line">        redisTemplate.setConnectionFactory(cf);</span><br><span class="line">        redisTemplate.afterPropertiesSet();</span><br><span class="line">        <span class="keyword">return</span> redisTemplate;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RedisConfig</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> RedisTemplate&lt;Object, Object&gt; <span class="title">redisTemplate</span><span class="params">(RedisConnectionFactory factory)</span> </span>&#123;</span><br><span class="line">        RedisTemplate&lt;Object, Object&gt; template = <span class="keyword">new</span> RedisTemplate&lt;&gt;();</span><br><span class="line">        RedisSerializer&lt;String&gt; redisSerializer = <span class="keyword">new</span> StringRedisSerializer();</span><br><span class="line">        template.setConnectionFactory(factory);</span><br><span class="line">        <span class="comment">/*key序列化*/</span></span><br><span class="line">        template.setKeySerializer(redisSerializer);</span><br><span class="line">        <span class="comment">/*value序列化*/</span></span><br><span class="line">        template.setValueSerializer(redisSerializer);</span><br><span class="line">        <span class="comment">//*value HashMap序列化*/</span></span><br><span class="line">        template.setHashValueSerializer(redisSerializer);</span><br><span class="line">        <span class="comment">/*key HashMap序列化*/</span></span><br><span class="line">        template.setHashKeySerializer(redisSerializer);</span><br><span class="line">        <span class="keyword">return</span> template;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>使用StringRedisTemplate类</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line">StringRedisTemplate redisTemplate;</span><br></pre></td></tr></table></figure>

<hr>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RedisTemplate</span>&lt;<span class="title">K</span>, <span class="title">V</span>&gt; <span class="keyword">extends</span> <span class="title">RedisAccessor</span> <span class="keyword">implements</span> <span class="title">RedisOperations</span>&lt;<span class="title">K</span>, <span class="title">V</span>&gt;, <span class="title">BeanClassLoaderAware</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">boolean</span> enableTransactionSupport = <span class="keyword">false</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">boolean</span> exposeConnection = <span class="keyword">false</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">boolean</span> initialized = <span class="keyword">false</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">boolean</span> enableDefaultSerializer = <span class="keyword">true</span>;</span><br><span class="line">    <span class="meta">@Nullable</span></span><br><span class="line">    <span class="keyword">private</span> RedisSerializer&lt;?&gt; defaultSerializer;</span><br><span class="line">    <span class="meta">@Nullable</span></span><br><span class="line">    <span class="keyword">private</span> ClassLoader classLoader;</span><br><span class="line">    <span class="meta">@Nullable</span></span><br><span class="line">    <span class="keyword">private</span> RedisSerializer keySerializer = <span class="keyword">null</span>;</span><br><span class="line">    <span class="meta">@Nullable</span></span><br><span class="line">    <span class="keyword">private</span> RedisSerializer valueSerializer = <span class="keyword">null</span>;</span><br><span class="line">    <span class="meta">@Nullable</span></span><br><span class="line">    <span class="keyword">private</span> RedisSerializer hashKeySerializer = <span class="keyword">null</span>;</span><br><span class="line">    <span class="meta">@Nullable</span></span><br><span class="line">    <span class="keyword">private</span> RedisSerializer hashValueSerializer = <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">private</span> RedisSerializer&lt;String&gt; stringSerializer = RedisSerializer.string();</span><br><span class="line">    <span class="meta">@Nullable</span></span><br><span class="line">    <span class="keyword">private</span> ScriptExecutor&lt;K&gt; scriptExecutor;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> ValueOperations&lt;K, V&gt; valueOps = <span class="keyword">new</span> DefaultValueOperations(<span class="keyword">this</span>);</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> ListOperations&lt;K, V&gt; listOps = <span class="keyword">new</span> DefaultListOperations(<span class="keyword">this</span>);</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> SetOperations&lt;K, V&gt; setOps = <span class="keyword">new</span> DefaultSetOperations(<span class="keyword">this</span>);</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> StreamOperations&lt;K, ?, ?&gt; streamOps = <span class="keyword">new</span> DefaultStreamOperations(<span class="keyword">this</span>, ObjectHashMapper.getSharedInstance());</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> ZSetOperations&lt;K, V&gt; zSetOps = <span class="keyword">new</span> DefaultZSetOperations(<span class="keyword">this</span>);</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> GeoOperations&lt;K, V&gt; geoOps = <span class="keyword">new</span> DefaultGeoOperations(<span class="keyword">this</span>);</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> HyperLogLogOperations&lt;K, V&gt; hllOps = <span class="keyword">new</span> DefaultHyperLogLogOperations(<span class="keyword">this</span>);</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> ClusterOperations&lt;K, V&gt; clusterOps = <span class="keyword">new</span> DefaultClusterOperations(<span class="keyword">this</span>);</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">RedisTemplate</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">afterPropertiesSet</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.afterPropertiesSet();</span><br><span class="line">        <span class="keyword">boolean</span> defaultUsed = <span class="keyword">false</span>;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">this</span>.defaultSerializer == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">this</span>.defaultSerializer = <span class="keyword">new</span> JdkSerializationRedisSerializer(<span class="keyword">this</span>.classLoader != <span class="keyword">null</span> ? <span class="keyword">this</span>.classLoader : <span class="keyword">this</span>.getClass().getClassLoader());</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">this</span>.enableDefaultSerializer) &#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="keyword">this</span>.keySerializer == <span class="keyword">null</span>) &#123;</span><br><span class="line">                <span class="keyword">this</span>.keySerializer = <span class="keyword">this</span>.defaultSerializer;</span><br><span class="line">                defaultUsed = <span class="keyword">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (<span class="keyword">this</span>.valueSerializer == <span class="keyword">null</span>) &#123;</span><br><span class="line">                <span class="keyword">this</span>.valueSerializer = <span class="keyword">this</span>.defaultSerializer;</span><br><span class="line">                defaultUsed = <span class="keyword">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (<span class="keyword">this</span>.hashKeySerializer == <span class="keyword">null</span>) &#123;</span><br><span class="line">                <span class="keyword">this</span>.hashKeySerializer = <span class="keyword">this</span>.defaultSerializer;</span><br><span class="line">                defaultUsed = <span class="keyword">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (<span class="keyword">this</span>.hashValueSerializer == <span class="keyword">null</span>) &#123;</span><br><span class="line">                <span class="keyword">this</span>.hashValueSerializer = <span class="keyword">this</span>.defaultSerializer;</span><br><span class="line">                defaultUsed = <span class="keyword">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">this</span>.enableDefaultSerializer &amp;&amp; defaultUsed) &#123;</span><br><span class="line">            Assert.notNull(<span class="keyword">this</span>.defaultSerializer, <span class="string">&quot;default serializer null and not all serializers initialized&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">this</span>.scriptExecutor == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">this</span>.scriptExecutor = <span class="keyword">new</span> DefaultScriptExecutor(<span class="keyword">this</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">this</span>.initialized = <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    ...........</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<p>Redis工具类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br><span class="line">494</span><br><span class="line">495</span><br><span class="line">496</span><br><span class="line">497</span><br><span class="line">498</span><br><span class="line">499</span><br><span class="line">500</span><br><span class="line">501</span><br><span class="line">502</span><br><span class="line">503</span><br><span class="line">504</span><br><span class="line">505</span><br><span class="line">506</span><br><span class="line">507</span><br><span class="line">508</span><br><span class="line">509</span><br><span class="line">510</span><br><span class="line">511</span><br><span class="line">512</span><br><span class="line">513</span><br><span class="line">514</span><br><span class="line">515</span><br><span class="line">516</span><br><span class="line">517</span><br><span class="line">518</span><br><span class="line">519</span><br><span class="line">520</span><br><span class="line">521</span><br><span class="line">522</span><br><span class="line">523</span><br><span class="line">524</span><br><span class="line">525</span><br><span class="line">526</span><br><span class="line">527</span><br><span class="line">528</span><br><span class="line">529</span><br><span class="line">530</span><br><span class="line">531</span><br><span class="line">532</span><br><span class="line">533</span><br><span class="line">534</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">RedisUtil</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> RedisTemplate&lt;String, Object&gt; redisTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// =============================common============================</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 指定缓存失效时间</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key 键</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> time 时间(秒)</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">expire</span><span class="params">(String key, <span class="keyword">long</span> time)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (time &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                redisTemplate.expire(key, time, TimeUnit.SECONDS);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据key 获取过期时间</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key 键 不能为null</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 时间(秒) 返回代表为永久有效</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">long</span> <span class="title">getExpire</span><span class="params">(String key)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> redisTemplate.getExpire(key, TimeUnit.SECONDS);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 判断key是否存在</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key 键</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> true 存在 false不存在</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">hasKey</span><span class="params">(String key)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> redisTemplate.hasKey(key);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 删除缓存</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key 可以传一个值 或多个</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@SuppressWarnings(&quot;unchecked&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">del</span><span class="params">(String... key)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (key != <span class="keyword">null</span> &amp;&amp; key.length &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (key.length == <span class="number">1</span>) &#123;</span><br><span class="line">                redisTemplate.delete(key[<span class="number">0</span>]);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                redisTemplate.delete(CollectionUtils.arrayToList(key));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ============================String=============================</span></span><br><span class="line">        </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 普通缓存获取</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key 键</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 值</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">get</span><span class="params">(String key)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> key == <span class="keyword">null</span> ? <span class="keyword">null</span> : redisTemplate.opsForValue().get(key);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 普通缓存放入</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key 键</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> value 值</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> true成功 false失败</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">set</span><span class="params">(String key, Object value)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            redisTemplate.opsForValue().set(key, value);</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 普通缓存放入并设置时间</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key 键</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> value 值</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> time 时间(秒) time要大于 如果time小于等于 将设置无限期</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> true成功 false 失败</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">set</span><span class="params">(String key, Object value, <span class="keyword">long</span> time)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (time &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                redisTemplate.opsForValue().set(key, value, time, TimeUnit.SECONDS);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                set(key, value);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 递增</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key 键</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> delta 要增加几(大于)</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">long</span> <span class="title">incr</span><span class="params">(String key, <span class="keyword">long</span> delta)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (delta &lt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">&quot;递增因子必须大于&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> redisTemplate.opsForValue().increment(key, delta);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 递减</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key 键</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> delta 要减少几(小于)</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">long</span> <span class="title">decr</span><span class="params">(String key, <span class="keyword">long</span> delta)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (delta &lt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">&quot;递减因子必须大于&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> redisTemplate.opsForValue().increment(key, -delta);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ================================Map=================================</span></span><br><span class="line">        </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * HashGet</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key 键 不能为null</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> item 项 不能为null</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 值</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">hget</span><span class="params">(String key, String item)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> redisTemplate.opsForHash().get(key, item);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取hashKey对应的所有键值</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key 键</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 对应的多个键值</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Map&lt;Object, Object&gt; <span class="title">hmget</span><span class="params">(String key)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> redisTemplate.opsForHash().entries(key);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * HashSet</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key 键</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> map 对应多个键值</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> true 成功 false 失败</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">hmset</span><span class="params">(String key, Map&lt;String, Object&gt; map)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            redisTemplate.opsForHash().putAll(key, map);</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * HashSet 并设置时间</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key 键</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> map 对应多个键值</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> time 时间(秒)</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> true成功 false失败</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">hmset</span><span class="params">(String key, Map&lt;String, Object&gt; map, <span class="keyword">long</span> time)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            redisTemplate.opsForHash().putAll(key, map);</span><br><span class="line">            <span class="keyword">if</span> (time &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                expire(key, time);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 向一张hash表中放入数据,如果不存在将创建</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key 键</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> item 项</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> value 值</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> true 成功 false失败</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">hset</span><span class="params">(String key, String item, Object value)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            redisTemplate.opsForHash().put(key, item, value);</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">     * 向一张hash表中放入数据,如果不存在将创建</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key 键</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> item 项</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> value 值</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> time 过期时间(秒) 注意:如果已存在的hash表有时间,这里将会替换原有的时间</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> true 成功 false失败</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">hset</span><span class="params">(String key, String item, Object value, <span class="keyword">long</span> time)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            redisTemplate.opsForHash().put(key, item, value);</span><br><span class="line">            <span class="keyword">if</span> (time &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                expire(key, time);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">        </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 删除hash表中的值</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key 键 不能为null</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> item 项 可以使多个 不能为null</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">hdel</span><span class="params">(String key, Object... item)</span> </span>&#123;</span><br><span class="line">        redisTemplate.opsForHash().delete(key, item);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 判断hash表中是否有该项的值</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key 键 不能为null</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> item 项 不能为null</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> true 存在 false不存在</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">hHasKey</span><span class="params">(String key, String item)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> redisTemplate.opsForHash().hasKey(key, item);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * hash递增 如果不存在,就会创建一个 并把新增后的值返回</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key 键</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> item 项</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> by 要增加几(大于)</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">double</span> <span class="title">hincr</span><span class="params">(String key, String item, <span class="keyword">double</span> by)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> redisTemplate.opsForHash().increment(key, item, by);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * hash递减</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key 键</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> item 项</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> by 要减少记(小于)</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">double</span> <span class="title">hdecr</span><span class="params">(String key, String item, <span class="keyword">double</span> by)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> redisTemplate.opsForHash().increment(key, item, -by);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ============================set=============================</span></span><br><span class="line">        </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据key获取Set中的所有值</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key 键</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Set&lt;Object&gt; <span class="title">sGet</span><span class="params">(String key)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> redisTemplate.opsForSet().members(key);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据value从一个set中查询,是否存在</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key 键</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> value 值</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> true 存在 false不存在</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">sHasKey</span><span class="params">(String key, Object value)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> redisTemplate.opsForSet().isMember(key, value);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">        </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 将数据放入set缓存</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key 键</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> values 值 可以是多个</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 成功个数</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">long</span> <span class="title">sSet</span><span class="params">(String key, Object... values)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> redisTemplate.opsForSet().add(key, values);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 将set数据放入缓存</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key 键</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> time 时间(秒)</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> values 值 可以是多个</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 成功个数</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">long</span> <span class="title">sSetAndTime</span><span class="params">(String key, <span class="keyword">long</span> time, Object... values)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Long count = redisTemplate.opsForSet().add(key, values);</span><br><span class="line">            <span class="keyword">if</span> (time &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                expire(key, time);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> count;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取set缓存的长度</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key 键</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">long</span> <span class="title">sGetSetSize</span><span class="params">(String key)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> redisTemplate.opsForSet().size(key);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 移除值为value的</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key 键</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> values 值 可以是多个</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 移除的个数</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">long</span> <span class="title">setRemove</span><span class="params">(String key, Object... values)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Long count = redisTemplate.opsForSet().remove(key, values);</span><br><span class="line">            <span class="keyword">return</span> count;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ===============================list=================================</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取list缓存的内容</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key 键</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> start 开始</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> end 结束  到 -代表所有值</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;Object&gt; <span class="title">lGet</span><span class="params">(String key, <span class="keyword">long</span> start, <span class="keyword">long</span> end)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> redisTemplate.opsForList().range(key, start, end);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">        </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取list缓存的长度</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key 键</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">long</span> <span class="title">lGetListSize</span><span class="params">(String key)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> redisTemplate.opsForList().size(key);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">        </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 通过索引 获取list中的值</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key 键</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> index 索引 index&gt;=时，  表头， 第二个元素，依次类推；index&lt;时，-，表尾，-倒数第二个元素，依次类推</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">lGetIndex</span><span class="params">(String key, <span class="keyword">long</span> index)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> redisTemplate.opsForList().index(key, index);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">        </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 将list放入缓存</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key 键</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> value 值</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">lSet</span><span class="params">(String key, Object value)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            redisTemplate.opsForList().rightPush(key, value);</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">        </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 将list放入缓存</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key 键</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> value 值</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> time 过期时间(秒)</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">lSet</span><span class="params">(String key, Object value, <span class="keyword">long</span> time)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            redisTemplate.opsForList().rightPush(key, value);</span><br><span class="line">            <span class="keyword">if</span> (time &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                expire(key, time);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">        </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 将list放入缓存</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key 键</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> value 值</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">lSet</span><span class="params">(String key, List&lt;Object&gt; value)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            redisTemplate.opsForList().rightPushAll(key, value);</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">        </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 将list放入缓存，并设置过期时间</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key 键</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> value 值</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> time 过期时间(秒)</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">lSet</span><span class="params">(String key, List&lt;Object&gt; value, <span class="keyword">long</span> time)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            redisTemplate.opsForList().rightPushAll(key, value);</span><br><span class="line">            <span class="keyword">if</span> (time &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                expire(key, time);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">        </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据索引修改list中的某条数据</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key 键</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> index 索引</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> value 值</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">lUpdateIndex</span><span class="params">(String key, <span class="keyword">long</span> index, Object value)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            redisTemplate.opsForList().set(key, index, value);</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">        </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 移除N个值为value</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key 键</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> count 移除多少个</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> value 值</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 移除的个数</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">long</span> <span class="title">lRemove</span><span class="params">(String key, <span class="keyword">long</span> count, Object value)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Long remove = redisTemplate.opsForList().remove(key, count, value);</span><br><span class="line">            <span class="keyword">return</span> remove;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<hr>
<h3 id="Conf"><a href="#Conf" class="headerlink" title="Conf"></a>Conf</h3><table>
<thead>
<tr>
<th align="center">配置</th>
<th align="center">含义</th>
</tr>
</thead>
<tbody><tr>
<td align="center">include <code>/path/to/local</code>.conf</td>
<td align="center">额外载入配置文件</td>
</tr>
<tr>
<td align="center">bind 127.0.0.1</td>
<td align="center">绑定redis服务器访问IP</td>
</tr>
<tr>
<td align="center">protected-mode yes</td>
<td align="center">默认开启，只允许本地客户端连接</td>
</tr>
<tr>
<td align="center">port 6379</td>
<td align="center">监听端口号，默认6379</td>
</tr>
<tr>
<td align="center">tcp-backlog 511</td>
<td align="center">TCP监听最大容纳数量</td>
</tr>
<tr>
<td align="center">timeout 0</td>
<td align="center">client 空闲多少秒关闭连接（0 永不关闭）</td>
</tr>
<tr>
<td align="center">tcp-keepalive 300</td>
<td align="center">单位秒，表示周期性使用SO_KEEPALIVE检测客户端是否还处于健康状态，避免服务器阻塞</td>
</tr>
<tr>
<td align="center">daemonize yes</td>
<td align="center">默认redis不作为守护进程运行，在后台运行改成 yes</td>
</tr>
<tr>
<td align="center">pidfile /var/redis/run/redis_6379.pid</td>
<td align="center">配置PID文件路径，当redis作为守护进程运行会把 pid 默认写到入/var/redis/run/redis_6379.pid 文件</td>
</tr>
<tr>
<td align="center">loglevel notice</td>
<td align="center">定义日志级别 debug（记录大量日志信息，适用于开发、测试阶段 verbose（较多日志信息）notice（适量日志信息，使用于生产环境） warning（仅有部分重要、关键信息才会被记录）</td>
</tr>
<tr>
<td align="center">logfile /var/redis/log/redis_6379.log</td>
<td align="center">日志文件位置，当指定为空字符串时，为标准输出，如果redis已守护进程模式运行，日志将输出到/dev/null</td>
</tr>
<tr>
<td align="center">databases 16</td>
<td align="center">设置数据库的数目 默认的数据库是DB 0</td>
</tr>
<tr>
<td align="center">save 900 1</td>
<td align="center">存DB到磁盘(持久化)<br/>   save &lt;间隔时间（秒）&gt; &lt;写入次数&gt;<br/>  根据时间间隔和写入次数将数据保存到磁盘<br/>  900 秒内如果至少有 1 个 key 的值变化，则保存<br/></td>
</tr>
<tr>
<td align="center">stop-writes-on-bgsave-error yes</td>
<td align="center">如果用户开启RDB快照功能，那么redis持久化数据到磁盘时如果出现失败，默认情况下redis会停止接受所有的写请求，即用户知道内存中的数据和磁盘上的数据已经存在不一致。如果下一次RDB持久化成功，redis会自动恢复接受写请求</td>
</tr>
<tr>
<td align="center">rdbcompression yes</td>
<td align="center">存储到磁盘中的快照设置是否进行压缩存储</td>
</tr>
<tr>
<td align="center">rdbchecksum yes</td>
<td align="center">使用CRC64算法对快照进行数据校验</td>
</tr>
<tr>
<td align="center">dir /var/redis/6379</td>
<td align="center">设置快照文件的存放路径</td>
</tr>
<tr>
<td align="center">requirepass foobared</td>
<td align="center">设置redis连接密码</td>
</tr>
<tr>
<td align="center">rename-command CONFIG “”</td>
<td align="center">将命令重命名，可以将某些重要的、危险的命令重命名。</td>
</tr>
<tr>
<td align="center">maxclients 10000</td>
<td align="center">设置客户端最大并发连接数</td>
</tr>
<tr>
<td align="center">maxmemory <bytes></td>
<td align="center">指定Redis最大内存限制</td>
</tr>
<tr>
<td align="center">maxmemory-policy noeviction</td>
<td align="center">当内存使用达到最大值时，redis使用的清除策略<br/> 1.volatile-lru  LRU算法移除设置过过期时间的key<br/> 2.allkeys-lru  利用LRU算法移除任何key<br/> 3.volatile-random 移除设置过过期时间的随机key<br/> 4.allkeys-random 移除随机key<br/> 5.volatile-ttl  移除即将过期的key(minor TTL)<br/> 6.noeviction noeviction  不移除任何key，只是返回一个写错误 ，默认</td>
</tr>
<tr>
<td align="center">appendonly no</td>
<td align="center">默认redis是RDB方式持久化，这种方式在redis如果中途宕机 会导致可能有几分钟的数据丢失，根据save来策略进行持久化，可使用Append Only File(AOF)持久化方式，Redis会把每次写入的数据在接收后都写入appendonly.aof文件， 每次启动时Redis都会先把这个文件的数据读入内存里。</td>
</tr>
<tr>
<td align="center">appendfilename “appendonly.aof”</td>
<td align="center">aof文件名</td>
</tr>
<tr>
<td align="center">appendfsync always</td>
<td align="center">aof持久化策略的配置<br/> no表示不执行fsync，由操作系统保证数据同步到磁盘，速度最快。<br/> always表示每次写入都执行fsync，以保证数据同步到磁盘。<br/> everysec表示每秒执行一次fsync，可能会导致丢失这1s数据</td>
</tr>
<tr>
<td align="center">cluster-enabled yes</td>
<td align="center">集群开关，默认是不开启集群模式</td>
</tr>
</tbody></table>
<hr>
<h3 id="持久化"><a href="#持久化" class="headerlink" title="持久化"></a>持久化</h3><p><a target="_blank" rel="noopener" href="https://redis.io/docs/manual/persistence/">Redis persistence</a></p>
<blockquote>
<p>1.<strong>RDB</strong> (Redis Database): The RDB persistence performs point-in-time snapshots of your dataset at specified intervals.</p>
<p>2.<strong>AOF</strong> (Append Only File): The AOF persistence logs every write operation received by the server, that will be played again at server startup, reconstructing the original dataset. Commands are logged using the same format as the Redis protocol itself, in an append-only fashion. Redis is able to rewrite the log in the background when it gets too big.</p>
<p>3.<strong>No persistence</strong>: If you wish, you can disable persistence completely, if you want your data to just exist as long as the server is running.</p>
<p>4.<strong>RDB + AOF</strong>: It is possible to combine both AOF and RDB in the same instance. Notice that, in this case, when Redis restarts the AOF file will be used to reconstruct the original dataset since it is guaranteed to be the most complete.</p>
</blockquote>
<hr>
<blockquote>
<p>Redis作为一个键值对内存数据库(NoSQL)，数据都存储在内存当中，在处理客户端请求时，所有操作都在内存当中进行，存储在内存当中的数据，只要服务器宕机，内存中就会数据消失。如果Redis仅仅作为缓存来用影响不大，但如果业务数据存储在Redis，Redis的内存数据丢失影响则是毁灭性的。避免内存数据丢失，Redis提供对持久化操作，可以将数据从内存中保存到硬盘当中，使数据持久化保存。</p>
</blockquote>
<h4 id="RDB"><a href="#RDB" class="headerlink" title="RDB"></a>RDB</h4><blockquote>
<p>1.RDB是一种快照(Snapshot)存储持久化方式，将Redis某一时刻的内存数据快照保存到磁盘中，默认保存文件名为dump.rdb，在Redis服务器启动时，会重新加载dump.rdb文件的数据到内存当中恢复数据。</p>
<p>2，RDB持久化方案是按照指定时间间隔对你的数据集生成的时间点快照，是Redis数据库中数据的内存快照，是一个二进制文件，存储了文件生成时Redis数据库中所有的数据内容。可用于Redis的数据备份、转移与恢复。</p>
</blockquote>
<p>1.save(同步)</p>
<blockquote>
<p>当客户端向服务器发送save命令请求进行持久化时，服务器会阻塞save命令之后的其他客户端的请求，直到数据同步完成。如果数据量太大同步数据会执行很久，这期间Redis服务器也无法接收其他请求，最好不要在生产环境使用save命令。</p>
</blockquote>
<p>2.bgsave(异步)</p>
<img src="https://zerostione.github.io/ImageUp//Image/Blog/Redis/p27.png" style="zoom: 80%;" />

<blockquote>
<p>当客户端发出bgsave命令时，Redis服务器主进程会fork一个子进程来处理持久化，在将数据写入到临时rdb文件后，替换原来的快照文件，子进程会退出。与save命令相比，Redis服务器在处理bgsave采用子线程进行IO写入，而主进程仍然可以接收其他请求，但fork子进程是同步的，所以fork子进程时一样不能接收其他请求，即如果fork一个子进程花费的时间太久(一般很快)，bgsave命令仍然有阻塞其他客户的请求的情况发生。</p>
</blockquote>
<figure class="highlight accesslog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">#redis.conf</span><br><span class="line">save <span class="number">60</span> <span class="number">5</span></span><br><span class="line">dir ./</span><br><span class="line"></span><br><span class="line"><span class="number">127.0.0.1:6379</span>&gt; config get dir # 备份与自动恢复目录</span><br><span class="line"><span class="number">1</span>) <span class="string">&quot;dir&quot;</span></span><br><span class="line"><span class="number">2</span>) <span class="string">&quot;/root&quot;</span></span><br><span class="line"><span class="number">127.0.0.1:6379</span>&gt; save</span><br><span class="line">OK</span><br><span class="line"><span class="number">127.0.0.1:6379</span>&gt; set k1 v1</span><br><span class="line">OK</span><br><span class="line"><span class="number">127.0.0.1:6379</span>&gt; set k2 v2</span><br><span class="line">OK</span><br><span class="line"><span class="number">127.0.0.1:6379</span>&gt; set k3 v3</span><br><span class="line">OK</span><br><span class="line"><span class="number">127.0.0.1:6379</span>&gt; set k4 v4</span><br><span class="line">OK</span><br><span class="line"><span class="number">127.0.0.1:6379</span>&gt; set k5 v5</span><br><span class="line">OK</span><br><span class="line"></span><br><span class="line"><span class="string">[root@VM-8-3-centos ~]</span># ls</span><br><span class="line">dump.rdb</span><br></pre></td></tr></table></figure>

<hr>
<blockquote>
<p>1.RDB文件由主进程生成还是子进程来生成：</p>
<ul>
<li>生成临时rdb文件，并写入数据</li>
<li>完成数据写入，用临时文代替代正式rdb文件</li>
<li>删除原来的db文件</li>
</ul>
<p>2.优点</p>
<ul>
<li>与AOF方式相比，通过rdb文件恢复数据比较快</li>
<li>rdb文件紧凑(二进制文件)，适合于数据备份、全量复制</li>
<li>通过RDB进行数据备份使用子进程生成时对Redis服务器性能影响较小</li>
<li>对灾难恢复、数据迁移非常友好，rdb文件可转移至需要的地方重新加载</li>
</ul>
<p>3.缺点</p>
<ul>
<li>服务器宕机会造成某个时段内数据的丢失（无法实时持久化）</li>
<li>save会造成服务器阻塞，直接数据同步完成才能接收后续请求</li>
<li>bgsave命令在fork子进程时，如果数据量太大forks的过程也会发生阻塞，另外forks进程会耗费内存</li>
</ul>
</blockquote>
<hr>
<h4 id="AOF"><a href="#AOF" class="headerlink" title="AOF"></a>AOF</h4><img src="https://zerostione.github.io/ImageUp//Image/Blog/Redis/p3.jpg" style="zoom:80%;" />

<blockquote>
<p>AOF（Append Only File）持久化功能，AOF持久化会把被执行的写命令写到AOF文件的末尾，记录数据的变化。默认情况下，Redis不开启AOF持久化，开启后每执行一条更改Redis数据命令，都会把该命令追加到AOF文件（appendonly.aof），虽然会降低Redis的性能，但大部分情况下能够接受，使用较快硬盘可以提高AOF的性能。</p>
</blockquote>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># redis.conf</span></span><br><span class="line">appendonly <span class="literal">yes</span></span><br><span class="line"><span class="comment"># The name of the append only file (default: &quot;appendonly.aof&quot;)</span></span><br><span class="line">appendfilename <span class="string">&quot;appendonly.aof&quot;</span></span><br><span class="line"></span><br><span class="line">redis-server /usr/local/redis/etc/redis.conf </span><br><span class="line">&gt; ls</span><br><span class="line">appendonly.aof  dump.rdb</span><br><span class="line"></span><br><span class="line">127.0.0.1:6379&gt; <span class="builtin-name">set</span> k1 v1</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; <span class="builtin-name">set</span> k2 v2</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; <span class="builtin-name">set</span> k3 v3</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; <span class="builtin-name">set</span> k4 v4</span><br><span class="line">OK</span><br><span class="line"></span><br><span class="line"><span class="comment"># appendonly.aof </span></span><br><span class="line"><span class="number">*2</span></span><br><span class="line"><span class="variable">$6</span></span><br><span class="line">SELECT</span><br><span class="line"><span class="variable">$1</span></span><br><span class="line">0</span><br><span class="line"><span class="number">*3</span></span><br><span class="line"><span class="variable">$3</span></span><br><span class="line"><span class="builtin-name">set</span></span><br><span class="line"><span class="variable">$2</span></span><br><span class="line">k1</span><br><span class="line"><span class="variable">$2</span></span><br><span class="line">v1</span><br><span class="line"><span class="number">*3</span></span><br><span class="line"><span class="variable">$3</span></span><br><span class="line"><span class="builtin-name">set</span></span><br><span class="line"><span class="variable">$2</span></span><br><span class="line">k2</span><br><span class="line"><span class="variable">$2</span></span><br><span class="line">v2</span><br><span class="line"><span class="number">*3</span></span><br><span class="line"><span class="variable">$3</span></span><br><span class="line"><span class="builtin-name">set</span></span><br><span class="line"><span class="variable">$2</span></span><br><span class="line">k3</span><br><span class="line"><span class="variable">$2</span></span><br><span class="line">v3</span><br><span class="line"><span class="number">*3</span></span><br><span class="line"><span class="variable">$3</span></span><br><span class="line"><span class="builtin-name">set</span></span><br><span class="line"><span class="variable">$2</span></span><br><span class="line">k4</span><br><span class="line"><span class="variable">$2</span></span><br><span class="line">v4</span><br></pre></td></tr></table></figure>

<blockquote>
<p>1.aof文件出错时会导致Redis无法启动，需要redis-check-aof来修复aof文件。</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">redis-check-aof --fix appendonly.aof</span><br></pre></td></tr></table></figure>

<blockquote>
<p>优点：</p>
<ul>
<li>数据更完整，安全性更高，秒级数据丢失（取决fsync策略）</li>
<li>AOF文件只进行追加，内容可读，适合误删紧急恢复</li>
</ul>
<p>缺点：</p>
<ul>
<li>对于相同的数据集，AOF文件体积大于RDB文件，数据恢复比较慢</li>
<li>根据所使用的fsync策略，AOF的速度可能会慢于RDB</li>
</ul>
</blockquote>
<hr>
<h3 id="订阅"><a href="#订阅" class="headerlink" title="订阅"></a>订阅</h3><img src="https://zerostione.github.io/ImageUp//Image/Blog/Redis/p28.png" style="zoom:80%;" />

<blockquote>
<ol>
<li>发送者（发送信息的客户端）不是将信息直接发送给特定的接收者（接收信息的客户端）， 而是将信息发送给频道（channel）， 然后由频道将信息转发给所有对这个频道感兴趣的订阅者。</li>
</ol>
<p>2.Redis 发布订阅 (pub/sub) 是一种消息通信模式：发送者 (pub) 发送消息，订阅者 (sub) 接收消息。</p>
<p>3.Redis 客户端可以订阅任意数量的频道。</p>
<p>4.底层是通过字典实现的，这个字典就用于保存订阅频道的信息：字典的键为正在被订阅的频道，而字典的值则是一个链表，链表中保存了所有订阅这个频道的客户端。当发送消息时首先根据 channel 定位到字典的键，然后将信息发送给字典值链表中的所有客户端。</p>
</blockquote>
<img src="https://zerostione.github.io/ImageUp//Image/Blog/Redis/p31.png" style="zoom:80%;" />

<table>
<thead>
<tr>
<th align="center">命令</th>
<th align="center">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="center">PSUBSCRIBE pattern [pattern …]</td>
<td align="center">订阅一个或多个符合给定模式的频道</td>
</tr>
<tr>
<td align="center">PUBSUB subcommand [argument [argument …]]</td>
<td align="center">查看订阅与发布系统状态</td>
</tr>
<tr>
<td align="center">PUBLISH channel message</td>
<td align="center">将信息发送到指定的频道</td>
</tr>
<tr>
<td align="center">PUNSUBSCRIBE [pattern [pattern …]]</td>
<td align="center">退订所有给定模式的频道</td>
</tr>
<tr>
<td align="center">SUBSCRIBE channel [channel …]</td>
<td align="center">订阅给定的一个或多个频道的信息</td>
</tr>
<tr>
<td align="center">UNSUBSCRIBE [channel [channel …]]</td>
<td align="center">指退订给定的频道</td>
</tr>
</tbody></table>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 发送端</span></span><br><span class="line"><span class="meta">127.0.0.1:6379&gt;</span> publish Gaming CSGO</span><br><span class="line">(integer) <span class="number">1</span></span><br><span class="line"><span class="meta">127.0.0.1:6379&gt;</span> publish Gaming Apex</span><br><span class="line">(integer) <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 接收端</span></span><br><span class="line"><span class="meta">127.0.0.1:6379&gt;</span> subscribe Gaming</span><br><span class="line">Reading messages... (press Ctrl-C to quit)</span><br><span class="line"><span class="number">1</span>) <span class="string">&quot;subscribe&quot;</span></span><br><span class="line"><span class="number">2</span>) <span class="string">&quot;Gaming&quot;</span></span><br><span class="line"><span class="number">3</span>) (integer) <span class="number">1</span></span><br><span class="line"><span class="number">1</span>) <span class="string">&quot;message&quot;</span></span><br><span class="line"><span class="number">2</span>) <span class="string">&quot;Gaming&quot;</span></span><br><span class="line"><span class="number">3</span>) <span class="string">&quot;CSGO&quot;</span></span><br><span class="line"><span class="number">1</span>) <span class="string">&quot;message&quot;</span></span><br><span class="line"><span class="number">2</span>) <span class="string">&quot;Gaming&quot;</span></span><br><span class="line"><span class="number">3</span>) <span class="string">&quot;Apex&quot;</span></span><br></pre></td></tr></table></figure>

<hr>
<hr>
<h3 id="主从复制"><a href="#主从复制" class="headerlink" title="主从复制"></a>主从复制</h3><img src="https://zerostione.github.io/ImageUp//Image/Blog/Redis/p32.png" style="zoom:80%;" />

<blockquote>
<p>1.主从复制，是指将一台Redis服务器的数据，复制到其他的Redis服务器。前者称为主节点(master/leader)，后者称为从节点(slave/follower)；数据的复制是单向的，只能由主节点到从节点。默认情况下，每台Redis服务器都是主节点；且一个主节点可以有多个从节点(或没有从节点)，但一个从节点只能有一个主节点。</p>
<p>2.作用</p>
<ul>
<li>数据冗余</li>
<li>故障恢复</li>
<li>负载均衡：在主从复制的基础上，配合读写分离，可以由主节点提供写服务，由从节点提供读服务（写Redis数据时应用连接主节点，读Redis数据时应用连接从节点），分担服务器负载，在写少读多的场景下，通过多个从节点分担读负载，可以大大提高Redis服务器的并发量。</li>
<li>高可用基石：主从复制是哨兵和集群能够实施的基础</li>
</ul>
<p>3.保存主节点信息-&gt;主从建立socket连接-&gt;发送ping命令-&gt;权限验证-&gt;同步数据集-&gt;命令持续复制</p>
</blockquote>
<table>
<thead>
<tr>
<th align="center">命令</th>
<th align="center">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="center">SLAVEOF host port</td>
<td align="center">将当前服务器转变为指定服务器的从属服务器或者停止对旧主服务器的同步转而对新主服务器进行同步</td>
</tr>
<tr>
<td align="center">SLAVEOF NO ONE</td>
<td align="center">使得该从属服务器关闭复制功能，并从从属服务器转变回主服务器，原来同步所得的数据集不会被丢弃</td>
</tr>
<tr>
<td align="center">ROLE</td>
<td align="center">返回实例在复制中担任的角色(master 、slave或者sentinel)以及其他信息：主服务器将返回属下从服务器的 IP 地址和端口，从服务器将返回自己正在复制的主服务器的 IP 地址、端口、连接状态以及复制偏移量，Sentinel 将返回自己正在监视的主服务器列表</td>
</tr>
</tbody></table>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ls</span></span><br><span class="line">redis.conf</span><br><span class="line"><span class="comment"># cp redis.conf redis79.conf</span></span><br><span class="line"><span class="comment"># cp redis.conf redis80.conf</span></span><br><span class="line"><span class="comment"># cp redis.conf redis81.conf</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#redis80.conf</span></span><br><span class="line">port 6380</span><br><span class="line">replicaof &lt;masterip&gt; &lt;masterport&gt;</span><br><span class="line">masterauth &lt;master-password&gt;</span><br><span class="line">pidfile /var/run/redis_6380.pid</span><br><span class="line">logfile <span class="string">&quot;redis6380.log&quot;</span></span><br><span class="line">dbfilename dump6380.rdb</span><br><span class="line"></span><br><span class="line">redis-server /usr/local/redis/etc/redis81.conf </span><br><span class="line"></span><br><span class="line"><span class="comment"># ps -ef|grep redis</span></span><br><span class="line">root     32221     1  0 15:15 ?        00:00:00 redis-server *:6380</span><br><span class="line">root     32280     1  0 15:15 ?        00:00:00 redis-server *:6381</span><br><span class="line">root     32531     1  0 15:17 ?        00:00:00 redis-server *:6379</span><br><span class="line">root     32542 31790  0 15:17 pts/1    00:00:00 grep --color=auto redis</span><br><span class="line"></span><br><span class="line"><span class="section">127.0.0.1:6379&gt; info replication</span></span><br><span class="line"><span class="comment"># Replication</span></span><br><span class="line"><span class="section">role:master</span></span><br><span class="line"><span class="section">connected_slaves:0</span></span><br><span class="line"><span class="section">master_failover_state:no-failover</span></span><br><span class="line"><span class="section">master_replid:85958e18b498d2498d7df202f153954361c237f2</span></span><br><span class="line"><span class="section">master_replid2:0000000000000000000000000000000000000000</span></span><br><span class="line"><span class="section">master_repl_offset:0</span></span><br><span class="line"><span class="section">second_repl_offset:-1</span></span><br><span class="line"><span class="section">repl_backlog_active:0</span></span><br><span class="line"><span class="section">repl_backlog_size:1048576</span></span><br><span class="line"><span class="section">repl_backlog_first_byte_offset:0</span></span><br><span class="line"><span class="section">repl_backlog_histlen:0</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># slaveof host port 无密码 一次性</span></span><br><span class="line"><span class="section">127.0.0.1:6380&gt; info replication</span></span><br><span class="line"><span class="comment"># Replication</span></span><br><span class="line"><span class="section">role:slave</span></span><br><span class="line"><span class="section">master_host:127.0.0.1</span></span><br><span class="line"><span class="section">master_port:6379</span></span><br><span class="line"><span class="section">master_link_status:up</span></span><br><span class="line"><span class="section">master_last_io_seconds_ago:2</span></span><br><span class="line"><span class="section">master_sync_in_progress:0</span></span><br><span class="line"><span class="section">slave_repl_offset:42</span></span><br><span class="line"><span class="section">slave_priority:100</span></span><br><span class="line"><span class="section">slave_read_only:1</span></span><br><span class="line"><span class="section">replica_announced:1</span></span><br><span class="line"><span class="section">connected_slaves:0</span></span><br><span class="line"><span class="section">master_failover_state:no-failover</span></span><br><span class="line"><span class="section">master_replid:9e9dcc696ee088ad017f9d8dae3a3cddb6d5b71c</span></span><br><span class="line"><span class="section">master_replid2:0000000000000000000000000000000000000000</span></span><br><span class="line"><span class="section">master_repl_offset:42</span></span><br><span class="line"><span class="section">second_repl_offset:-1</span></span><br><span class="line"><span class="section">repl_backlog_active:1</span></span><br><span class="line"><span class="section">repl_backlog_size:1048576</span></span><br><span class="line"><span class="section">repl_backlog_first_byte_offset:1</span></span><br><span class="line"><span class="section">repl_backlog_histlen:42</span></span><br><span class="line"></span><br><span class="line"><span class="section">127.0.0.1:6379&gt; info replication</span></span><br><span class="line"><span class="comment"># Replication</span></span><br><span class="line"><span class="section">role:master</span></span><br><span class="line"><span class="section">connected_slaves:1</span></span><br><span class="line"><span class="section">slave0:ip=127.0.0.1,port=6380,state=online,offset=56,lag=0</span></span><br><span class="line"><span class="section">master_failover_state:no-failover</span></span><br><span class="line"><span class="section">master_replid:9e9dcc696ee088ad017f9d8dae3a3cddb6d5b71c</span></span><br><span class="line"><span class="section">master_replid2:0000000000000000000000000000000000000000</span></span><br><span class="line"><span class="section">master_repl_offset:56</span></span><br><span class="line"><span class="section">second_repl_offset:-1</span></span><br><span class="line"><span class="section">repl_backlog_active:1</span></span><br><span class="line"><span class="section">repl_backlog_size:1048576</span></span><br><span class="line"><span class="section">repl_backlog_first_byte_offset:1</span></span><br><span class="line"><span class="section">repl_backlog_histlen:56</span></span><br><span class="line"></span><br><span class="line"><span class="section">127.0.0.1:6380&gt; set name admin   #从机无法设值，只能用于读取</span></span><br><span class="line">(error) READONLY You can&#x27;t write against a read only replica.</span><br><span class="line"><span class="section">127.0.0.1:6379&gt; set name admin</span></span><br><span class="line">OK</span><br><span class="line"><span class="section">127.0.0.1:6380&gt; get name</span></span><br><span class="line"><span class="string">&quot;admin&quot;</span></span><br></pre></td></tr></table></figure>
<hr>
<blockquote>
<p>在Redis2.8以前，从节点向主节点发送sync命令请求同步数据，同步方式为全量复制，在Redis2.8及以后，从节点可以发送psync命令请求同步数据，根据主从节点当前状态的不同，同步方式可能是全量复制或部分复制。</p>
</blockquote>
<table>
<thead>
<tr>
<th align="center">类型</th>
<th align="center">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="center">全量复制</td>
<td align="center">用于初次复制场景，把主节点全部数据一次性发送给从节点，当数据量较大时，会对主从节点和网络造成极大开销</td>
</tr>
<tr>
<td align="center">部分复制</td>
<td align="center">用于处理在主从复制中网络中断等原因造成的数据丢失，当从节点再次连上主节点后，如果条件允许，主节点会补发中断期间执行的写命令给从节点，与全量复制相比更加高效</td>
</tr>
</tbody></table>
<hr>
<h3 id="哨兵模式"><a href="#哨兵模式" class="headerlink" title="哨兵模式"></a>哨兵模式</h3><img src="https://zerostione.github.io/ImageUp//Image/Blog/Redis/p4.jpg" style="zoom:80%;" />

<blockquote>
<p>1.哨兵(sentinel)是Redis的一种运行模式，专注于对Redis实例（主节点、从节点）运行状态的监控，并能够在主节点发生故障时通过一系列的机制实现选主及主从切换，实现故障转移，确保整个Redis系统的可用性。未配置哨兵之前，master宕机需要手动选择一个正常的slave成为新的主节点，效率低、故障感知滞后，不具备生产实用性。</p>
<ul>
<li>监控（Monitoring）： Sentinel 会不断地检查你的主服务器和从服务器是否运作正常。</li>
<li>提醒/通知（Notification）： 当被监控的某个 Redis 服务器出现问题时， Sentinel 可以通过 API 向管理员或者其他应用程序发送通知。</li>
<li>自动故障迁移（Automatic failover）： 当一个主服务器不能正常工作时， Sentinel 会开始一次自动故障迁移操作， 它会将失效主服务器的其中一个从服务器升级为新的主服务器， 并让失效主服务器的其他从服务器改为复制新的主服务器； 当客户端试图连接失效的主服务器时， 集群也会向客户端返回新主服务器的地址， 使得集群可以使用新主服务器代替失效服务器。</li>
</ul>
<p>​    Redis Sentinel 是一个分布式系统， 可以在一个架构中运行多个 Sentinel 进程（progress）， 这些进程使用流言协议（gossip protocols)来接收关于主服务器是否下线的信息，并使用投票协议（agreement protocols）来决定是否执行自动故障迁移，以及选择哪个从服务器作为新的主服务器。</p>
<p>2.sentinel可以让redis实现主从复制，当一个集群中的master失效之后，sentinel可以选举出一个新的master用于自动接替master的工作，集群中的其他redis服务器自动指向新的master同步数据。一般建议sentinel采取奇数台，防止某一台sentinel无法连接到master导致误切换。</p>
<p>3.哨兵通过<code>PING</code>命令实现对主从节点的故障检测。哨兵以集群方式工作，官方建议至少要有三个节点，每个节点都以相同的方式对主从节点进行监控与故障检测。单个哨兵对节点的故障检测可能无法代表其真实状态，为了降低误判，哨兵之间需要对节点的故障状态进行协商。</p>
<ul>
<li><p>主观宕机（Subjective Down, SDOWN）：是指一个哨兵实例通过检测发现某个主节点发生故障的一种状态。</p>
</li>
<li><p>客观宕机（Objective Down, ODOWN）：是指哨兵检测到某个主节点发生故障，通过命令<code>SENTINEL is-master-down-by-addr</code>与其他哨兵节点协商，并且在指定时间内接收到指定数量的其他哨兵的确认反馈时的一种状态。</p>
<p> SDOWN是该哨兵认为节点宕机，而ODOWN是不但该哨兵认为节点宕机，而且该哨兵与其他节点沟通后，达到一定数量的哨兵都认为节点宕机。</p>
</li>
</ul>
<p>4.主节点客观宕机后，Sentinel Leader会从该主节点存活的从节点中选出一个新的主节点，之后让其他存活的从节点以该节点为主节点，然后向该节点发起主从复制。</p>
</blockquote>
<hr>
<p>1.配置哨兵配置文件</p>
<blockquote>
<p>sentinel &lt;选项的名字&gt; &lt;主服务器的名字&gt; &lt;选项的值&gt;</p>
</blockquote>
<figure class="highlight smali"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sentinel<span class="built_in"> monitor </span>mymaster 127.0.0.1 6379 2  <span class="comment"># 监视mymaster主服务器， 该主服务器的IP地址为 127.0.0.1 ， 端口为 6379 ，将这个主服务器判断为失效至少需要2个Sentinel同意</span></span><br><span class="line">sentinel down-after-milliseconds mymaster 60000 <span class="comment"># 判断服务器已经断线所需的毫秒数</span></span><br><span class="line">sentinel failover-timeout mymaster 180000 <span class="comment"># 与故障转移超时的判断有关，用来判断其几个子阶段的超时，例如主节点晋升从节点时间超过timeout，或从节点向新的主节点发起复制操作的时间(不包括复制数据的时间)超过timeout，都会导致故障转移超时失败</span></span><br><span class="line">sentinel parallel-syncs mymaster 1  <span class="comment"># 在执行故障转移时，最多可以有多少个从服务器同时对新的主服务器进行同步</span></span><br></pre></td></tr></table></figure>

<figure class="highlight dns"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"># sentinel.conf</span><br><span class="line">sentinel monitor myredis <span class="number">127.0.0.1</span> <span class="number">6379</span> <span class="number">1</span></span><br><span class="line">sentinel auth-pass myredis <span class="number">123456</span>     #连接master密码</span><br><span class="line"></span><br><span class="line">&gt; redis-sentinel  /usr/local/redis/etc/sentinel.conf </span><br><span class="line"></span><br><span class="line"><span class="number">28053</span>:X <span class="number">01</span> May <span class="number">2022 21:33</span>:<span class="number">10</span>.<span class="number">035</span> * +slave slave <span class="number">127.0.0.1</span>:<span class="number">6380 127.0</span>.<span class="number">0.1 6380</span> @ myredis <span class="number">127.0.0.1</span> <span class="number">6381</span></span><br><span class="line"><span class="number">28053</span>:X <span class="number">01</span> May <span class="number">2022 21:33</span>:<span class="number">10</span>.<span class="number">035</span> * +slave slave <span class="number">127.0.0.1</span>:<span class="number">6379 127.0</span>.<span class="number">0.1 6379</span> @ myredis <span class="number">127.0.0.1</span> <span class="number">6381</span></span><br><span class="line"><span class="number">28053</span>:X <span class="number">01</span> May <span class="number">2022 21:33</span>:<span class="number">40</span>.<span class="number">096</span> # +sdown slave <span class="number">127.0.0.1</span>:<span class="number">6379 127.0</span>.<span class="number">0.1 6379</span> @ myredis <span class="number">127.0.0.1</span> <span class="number">6381</span></span><br><span class="line"></span><br><span class="line"><span class="number">127.0.0.1</span>:<span class="number">6379</span>&gt; shutdown</span><br><span class="line"><span class="number">127.0.0.1</span>:<span class="number">6381</span>&gt; info replication</span><br><span class="line"># Replication</span><br><span class="line">role:master</span><br><span class="line">connected_slaves:<span class="number">1</span></span><br><span class="line">slave0:ip=<span class="number">127.0.0.1</span>,port=<span class="number">6380</span>,state=online,offset=<span class="number">9336</span>,lag=<span class="number">0</span></span><br><span class="line">master_failover_state:no-failover</span><br><span class="line">master_replid:<span class="number">5d</span>ed70a045bbdfa227bc4e7f5f98e4f347ba3a54</span><br><span class="line">master_replid2:aed8ad31232bf77921784659206a9a0a<span class="number">682b2367</span></span><br><span class="line">master_repl_offset:<span class="number">9336</span></span><br><span class="line">second_repl_offset:<span class="number">2852</span></span><br><span class="line">repl_backlog_active:<span class="number">1</span></span><br><span class="line">repl_backlog_size:<span class="number">1048576</span></span><br><span class="line">repl_backlog_first_byte_offset:<span class="number">1</span></span><br><span class="line">repl_backlog_histlen:<span class="number">9336</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>优点：</p>
<ol>
<li><p>基于主从复制模式</p>
</li>
<li><p>故障自动转移，高可用</p>
</li>
<li><p>增强了系统的健壮性</p>
</li>
</ol>
<p>缺点：    </p>
<ol>
<li>集群容量一旦到达上限，在线扩容困难</li>
<li>哨兵模式配置繁琐</li>
<li>始终只有一个Redis主机来接收和处理写请求，易受单机瓶颈影响</li>
<li>集群里所有节点保存的都是全量数据，没有实现分布式存储(Redis Sharding)</li>
</ol>
</blockquote>
<p><a href="https://zerostione.github.io/ImageUp/Source/configure/sentinel.conf">sentinel.conf</a></p>
<hr>
<h3 id="Redis缓存"><a href="#Redis缓存" class="headerlink" title="Redis缓存"></a>Redis缓存</h3><h4 id="缓存雪崩"><a href="#缓存雪崩" class="headerlink" title="缓存雪崩"></a>缓存雪崩</h4><blockquote>
<p>1.如果缓存在某一个时刻出现大规模的key失效，那么就会导致大量的请求打在了数据库上面，导致数据库压力巨大，如果在高并发的情况下，可能瞬间就会导致数据库宕机。这时候如果运维马上又重启数据库，马上又会有新的流量把数据库打死。这就是缓存雪崩。</p>
<p>2.应对方法:</p>
<ul>
<li>均匀过期：设置不同的过期时间，让缓存失效的时间尽量均匀</li>
<li>分级缓存：第一级缓存失效的基础上，访问二级缓存，每一级缓存的失效时间都不同</li>
<li>热点数据缓存永远不过期</li>
<li>确保Redis缓存的高可用</li>
<li>使用互斥锁</li>
<li>使用熔断机制，限流降级</li>
</ul>
</blockquote>
<hr>
<h4 id="缓存击穿"><a href="#缓存击穿" class="headerlink" title="缓存击穿"></a>缓存击穿</h4><blockquote>
<p>1.缓存击穿跟缓存雪崩有点类似，缓存雪崩是大规模的key失效，而缓存击穿是某个热点的key失效，大并发集中对其进行请求，就会造成大量请求读缓存没读到数据，从而导致高并发访问数据库，引起数据库压力剧增。</p>
<p>2.应对方法</p>
<ul>
<li><p>在缓存失效后，通过互斥锁或者队列来控制读数据写缓存的线程数量，比如某个key只允许一个线程查询数据和写缓存，其他线程等待。这种方式会阻塞其他的线程，此时系统的吞吐量会下降</p>
</li>
<li><p>热点数据缓存永远不过期</p>
<ul>
<li>物理不过期，针对热点key不设置过期时间</li>
<li>逻辑过期，把过期时间存在key对应的value里，如果发现要过期，通过一个后台的异步线程进行缓存的构建</li>
</ul>
</li>
</ul>
</blockquote>
<hr>
<h4 id="缓存穿透"><a href="#缓存穿透" class="headerlink" title="缓存穿透"></a>缓存穿透</h4><blockquote>
<p>1.缓存穿透是指用户请求的数据在缓存中不存在即没有命中，同时在数据库中也不存在，导致用户每次请求该数据都要去数据库中查询一遍。如果有恶意攻击者不断请求系统中不存在的数据，会导致短时间大量请求落在数据库上，造成数据库压力过大，甚至导致数据库承受不住而宕机崩溃。</p>
<p>2.缓存穿透的关键在于在Redis中查不到key值，它和缓存击穿的根本区别在于传进来的key在Redis中是不存在的。假如有黑客传进大量的不存在的key，那么大量的请求打在数据库上是很致命的问题，所以在日常开发中要对参数做好校验，一些非法的参数，不可能存在的key就直接返回错误提示。</p>
<p>3.应对方法</p>
<ul>
<li>将无效的key存放进Redis中</li>
</ul>
<p>当出现Redis查不到数据，数据库也查不到数据时，将key保存到Redis中，设置value为null，并设置其过期时间极短（无法应对不存在的Key值每次都是随机的情况）</p>
<ul>
<li>使用布隆过滤器（Bloom Filter，1970年由布隆提出的。实际上是一个很长的二进制向量和一系列随机映射函数。布隆过滤器可以用于检索一个元素是否在一个集合中。它的优点是空间效率和查询时间都远远超过一般的算法，缺点是有一定的误识别率和删除困难）</li>
</ul>
<p>如果布隆过滤器判定某个 key 不存在布隆过滤器中，那么就一定不存在，如果判定某个 key 存在，那么很大可能是存在(存在一定的误判率)。在缓存之前再加一个布隆过滤器，将数据库中的所有key都存储在布隆过滤器中，在查询Redis前先去布隆过滤器查询 key 是否存在，如果不存在就直接返回，不让其访问数据库，从而避免了对底层存储系统的查询压力。</p>
</blockquote>
<img src="https://zerostione.github.io/ImageUp//Image/Blog/Redis/p34.png" style="zoom:80%;" />

<img src="https://zerostione.github.io/ImageUp//Image/Blog/Redis/p6.jpg" style="zoom:80%;" />

<hr>
<h4 id="缓存预热"><a href="#缓存预热" class="headerlink" title="缓存预热"></a>缓存预热</h4><blockquote>
<p>缓存预热是指系统上线后，提前将相关的缓存数据加载到缓存系统。避免在用户请求的时候，先查询数据库，然后再将数据缓存的问题，用户直接查询事先被预热的缓存数据。</p>
</blockquote>
<hr>
<h4 id="缓存降级"><a href="#缓存降级" class="headerlink" title="缓存降级"></a>缓存降级</h4><blockquote>
<p>缓存降级是指缓存失效或缓存服务器挂掉的情况下，不去访问数据库，直接返回默认数据或访问服务的内存数据。降级一般是有损的操作，所以尽量减少降级对于业务的影响程度。在项目实战中通常会将部分热点数据缓存到服务的内存中，这样一旦缓存出现异常，可以直接使用服务的内存数据，从而避免数据库遭受巨大压力。</p>
</blockquote>
<hr>
<hr>
<p><a target="_blank" rel="noopener" href="https://support.huaweicloud.com/bestpractice-dcs/dcs-bp-191113001.html">Redis使用规范</a></p>
<blockquote>
<p>Key名称规范：</p>
<ol>
<li><p>使用统一的命名规范。</p>
<p>一般使用业务名(或数据库名)为前缀，用冒号分隔，如<code>业务名:表名:id</code>。</p>
</li>
<li><p>控制key名称的长度。</p>
<p>保证语义清晰的情况下，尽量减少Key的长度。常用单词可使用缩写，如user缩写为u，messages缩写为msg。</p>
</li>
<li><p>名称中不要包含特殊字符。</p>
</li>
</ol>
<p>Value值规范：</p>
<ol>
<li><p>避免大Key。</p>
<p>大Key会带来网卡流量风暴和慢查询，一般string类型控制在10KB以内，hash、list、set、zset元素个数不要超过5000。</p>
</li>
<li><p>选择合适的数据类型。</p>
<p>比如存储用户的信息，可用使用多个key，使用<code>set u:1:name &quot;X&quot;</code>、<code>set u:1:age 20</code>这样存储，也可以使用hash数据结构，存储成1个key，设置用户属性时使用hmset一次设置多个，同时这样存储也能节省内存。</p>
</li>
<li><p>设置合理的过期时间。</p>
<p>最好是过期时间打散，不要集中在某个时间点过期。</p>
</li>
</ol>
</blockquote>

    </div>

    
    
    

    <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/Redis/" rel="tag"># Redis</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2022/03/06/MyBatisPlus%E5%85%A5%E9%97%A8/" rel="prev" title="MyBatisPlus入门">
                  <i class="fa fa-chevron-left"></i> MyBatisPlus入门
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/2022/03/12/AliYun%E4%BD%BF%E7%94%A8%E7%AC%94%E8%AE%B0/" rel="next" title="ECS使用笔记">
                  ECS使用笔记 <i class="fa fa-chevron-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Zero</span>
</div>
 <!-- <div class="powered-by">由 <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/pisces/" rel="noopener" target="_blank">NexT.Pisces</a> 强力驱动
  </div>
  -->

    </div>
  </footer>

  
  <script src="https://cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/next-boot.js"></script>

  





  





</body>
</html>
